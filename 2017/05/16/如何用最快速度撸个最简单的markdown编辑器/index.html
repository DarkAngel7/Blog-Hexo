<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
  <title>å¦‚ä½•ç”¨æœ€å¿«é€Ÿåº¦æ’¸ä¸ªæœ€ç®€å•çš„markdownç¼–è¾‘å™¨ | Dark Angel</title>
  <meta name="description" content="" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="MobileOptimized" content="320" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" /> 
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
  <link rel="stylesheet" type="text/css" href="/css/screen.css" />
  <link rel="stylesheet" type="text/css" href="/css/style.css" />
  <link rel="stylesheet" href="//cdn.bootcss.com/highlight.js/8.5/styles/github.min.css">
  <meta name="generator" content="Dark Angel">

  
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
  
  
  <link rel="alternate" type="application/atom+xml" title="Atom 0.3" href="atom.xml">
  
  

  
</head>

<!--
<body class="post-template">
-->
<body class="home-template">
<div id="perspective" class="perspective effect-movedown">
  <div class="container">
    <!-- wrapper -->
    <div class="wrapper">

      <header class="site-head"  style="background: #24282b url(/img/img-bg.jpg) center; background-size: cover" >
    <div class="vertical">
        <div class="site-head-content inner">
             <a class="blog-logo" href="/"><img src="/img/avatar.jpg" alt="Blog Logo"/></a> 
            <h1 class="blog-title">Dark Angel</h1>
            <h2 class="blog-description"><button id="showMenu">Show Menu</button></h2>
        </div>
    </div>
</header>

      

<main class="content" role="main">
  <article class="post">
    <span class="post-meta">
      <time datetime="2017-05-16T07:29:38.000Z" itemprop="datePublished">
          2017-05-16
      </time>
    
    
    | 
    <a href='/tags/iOSæŠ€æœ¯åˆ†äº«/'>iOSæŠ€æœ¯åˆ†äº«</a>
    
    
</span>
    <h1 class="post-title">å¦‚ä½•ç”¨æœ€å¿«é€Ÿåº¦æ’¸ä¸ªæœ€ç®€å•çš„markdownç¼–è¾‘å™¨</h1>
    <span id="busuanzi_value_page_pv"></span>æ¬¡é˜…è¯»
    <span class="ds-thread-count" data-thread-key="2017/05/16/å¦‚ä½•ç”¨æœ€å¿«é€Ÿåº¦æ’¸ä¸ªæœ€ç®€å•çš„markdownç¼–è¾‘å™¨/"></span>
    <section class="post-content">
     	
              <div id="toc" class="toc-article">
                <strong class="toc-title">æœ¬æ–‡ç›®å½•</strong>
                <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#å‰è¨€"><span class="toc-text">å‰è¨€</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#åˆ†æ"><span class="toc-text">åˆ†æ</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#æ–¹æ¡ˆ"><span class="toc-text">æ–¹æ¡ˆ</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#å®ç°"><span class="toc-text">å®ç°</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#æ­å»ºUI"><span class="toc-text">æ­å»ºUI</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#é€»è¾‘å¤„ç†"><span class="toc-text">é€»è¾‘å¤„ç†</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#åˆå§‹åŒ–"><span class="toc-text">åˆå§‹åŒ–</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#æ·»åŠ å·¥å…·æ "><span class="toc-text">æ·»åŠ å·¥å…·æ </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#é¢„è§ˆ"><span class="toc-text">é¢„è§ˆ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ä¿å­˜"><span class="toc-text">ä¿å­˜</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ç¾åŒ–æ ·å¼"><span class="toc-text">ç¾åŒ–æ ·å¼</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#æ€»ç»“"><span class="toc-text">æ€»ç»“</span></a></li></ol>
              </div>
            
	 <p><img src="http://ww2.sinaimg.cn/large/006tNc79ly1ffprjqeqhbj313k0iwgrw.jpg" alt="44281095-7821-49F2-9D89-82460D6263DB"></p>
<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>ç›¸ä¿¡ä¸å°‘å°ä¼™ä¼´çœ‹è¿‡ç¬”è€…å‰é¢å‘çš„ã€Š<strong>iOSä¸­UIWebViewä¸WKWebViewã€JavaScriptä¸OCäº¤äº’ã€Cookieç®¡ç†çœ‹æˆ‘å°±å¤Ÿ</strong>ã€‹ç³»åˆ—äº†å§ï¼Œæ–‡ç« ä¸­ç¬”è€…ä»‹ç»è¿‡å¾ˆå¤šå…³äºNativeä¸JSäº¤äº’çš„ä½¿ç”¨ã€‚ä»Šå¤©å‘¢ï¼Œç¬”è€…æ¥ç”¨æœ€å¿«é€Ÿåº¦æ’¸ä¸ªæœ€ç®€å•çš„<code>Markdown</code>ç¼–è¾‘å™¨ã€‚</p>
<p>å…¶å®iOSåŸç”ŸMarkdownç¼–è¾‘å™¨çš„å®ç°æ–¹å¼æœ‰å¾ˆå¤šï¼ŒGithubä¸Šé¢ä¹Ÿæœ‰ä¸€äº›æ¯”è¾ƒå‰å®³çš„åº“ï¼Œæœ¬ç€ä¸é‡å¤é€ è½®å­çš„åŸåˆ™ï¼Œ<code>markdown</code>çº¯æ–‡æœ¬è½¬<code>html</code>å­—ç¬¦ä¸²è¿™éƒ¨åˆ†å°±ä¸è‡ªå·±å®ç°äº†ï¼Œå…¶ä»–éƒ¨åˆ†ç¬”è€…ç”¨<code>JavaScriptCore</code>ç»“åˆJSå’ŒOCï¼ˆSwiftå…¶å®ä¹Ÿä¸€æ ·ï¼‰ï¼Œæ¥å®ç°ä¸€ä¸ªç®€å•çš„<code>Markdown</code>ç¼–è¾‘å™¨ã€‚</p>
<p>è¿™ç¯‡æ–‡ç« ä¸æ˜¯ä¸ºäº†æ•™å¤§å®¶å¦‚ä½•å¼€å‘<code>Markdown</code>ç¼–è¾‘å™¨ï¼Œè€Œæ˜¯ä¸ºå¹¿å¤§iOSå¼€å‘è€…æ‰“å¼€ä¸€ä¸ªæ–°çš„æ€è·¯ï¼Œæˆ‘ä»¬èƒ½ä½¿ç”¨çš„ä¸åªæ˜¯iOSå¼€æºåº“ï¼Œæœ‰äº†<code>JavaScriptCore</code>ï¼Œå³ä¾¿è„±ç¦»å¼€<code>WebView</code>ï¼Œæˆ‘ä»¬ä¹Ÿæ˜¯å¯ä»¥ä½¿ç”¨<code>JavaScript</code>å¼€æºåº“çš„~ğŸ˜Š</p>
<p>ä¸‹é¢ä¸ºå°ä¼™ä¼´ä»‹ç»ä¸‹å…·ä½“çš„å®ç°ç»†èŠ‚ï¼Œ<a href="https://github.com/DarkAngel7/DAMarkdownEditor" target="_blank" rel="external">æºç å·²ä¸Šä¼ Github</a>ï¼Œå¸Œæœ›å°ä¼™ä¼´ä»¬å–œæ¬¢çš„ç»™ä¸ªStarã€‚</p>
<h1 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h1><p>å¦‚ä½•åœ¨iOSä¸Šå®ç°ä¸€ä¸ª<code>markdown</code>ç¼–è¾‘å™¨å‘¢ï¼Ÿè®©æˆ‘ä»¬æ¥åˆ†æä¸‹ã€‚</p>
<ul>
<li>é¦–å…ˆï¼Œæ—¢ç„¶æ˜¯ç¼–è¾‘å™¨ï¼Œé‚£åº”è¯¥ä¼šç”¨åˆ°<code>UITextView</code>æ§ä»¶ã€‚</li>
<li>å…¶æ¬¡ï¼Œç”¨æˆ·æ˜¯åœ¨<code>UITextView</code>ä¸Šè¾“å…¥çš„æ–‡æœ¬ï¼Œé‚£ä½œä¸ºä¸€ä¸ªç¼–è¾‘å™¨ï¼Œåº”è¯¥ä¼šæœ‰é¢„è§ˆåŠŸèƒ½ï¼Œç‚¹å‡»é¢„è§ˆåˆ™å¯ä»¥çœ‹åˆ°htmlé¡µé¢ã€‚</li>
<li>å†æ¬¡ï¼Œç‚¹å‡»é¢„è§ˆå®ç°çš„æ˜¯<code>markdown</code>çº¯æ–‡æœ¬è½¬<code>html</code>å­—ç¬¦ä¸²ï¼Œæ€ä¹ˆå®ç°å‘¢ï¼Ÿ</li>
<li>æœ€åï¼Œè€ƒè™‘ç»™<code>UITextView</code>çš„<code>inputAccessoryView</code>æ·»åŠ ä¸€äº›ç”¨æˆ·å¸¸ç”¨çš„æŒ‰é’®ï¼Œæ¯”å¦‚â€œ#ã€linkã€imgâ€ç­‰ï¼Œä¾¿äºç”¨æˆ·æ“ä½œã€‚</li>
</ul>
<h1 id="æ–¹æ¡ˆ"><a href="#æ–¹æ¡ˆ" class="headerlink" title="æ–¹æ¡ˆ"></a>æ–¹æ¡ˆ</h1><p>ä¸Šé¢æåˆ°çš„æ˜¯ç¬”è€…åœ¨åšä¸€ä¸ª<code>markdown</code>ç¼–è¾‘å™¨æ—¶çš„æ€è·¯ï¼Œå…¶å®è¿™ä¸ªå¾ˆé‡è¦ï¼Œå°ä¼™ä¼´ä»¬åœ¨é‡åˆ°é—®é¢˜å’Œå¤„ç†é—®é¢˜æ—¶ï¼Œä¹Ÿåº”è¯¥å…ˆæ•´ä½“æ€è€ƒï¼Œåˆ†æä¸€ä¸‹ï¼Œç„¶åå¾—å‡ºå®ç°æ–¹æ¡ˆï¼Œæœ€åå†å»è½å®ï¼Œå…»æˆä¸€ä¸ªå¥½çš„ä¹ æƒ¯ã€‚</p>
<p>ç¬”è€…çš„æ–¹æ¡ˆå¦‚ä¸‹ï¼š</p>
<ul>
<li>é¡µé¢ç»“æ„ï¼šä¸€ä¸ª<code>UIViewController</code>ä¸Šé¢æ”¾ä¸€ä¸ª<code>UITextView</code>ï¼Œé¡¶éƒ¨<code>NavigationBar</code>ä¸Šé¢æ”¾ä¸ª<strong>é¢„è§ˆ</strong>æŒ‰é’®å’Œ<strong>ä¿å­˜</strong>æŒ‰é’®ã€‚ç‚¹å‡»é¢„è§ˆï¼ŒæŸ¥çœ‹ç¼–è¾‘å¥½çš„é¢„è§ˆé¡µï¼›ç‚¹å‡»ä¿å­˜ï¼Œä¿å­˜å½“å‰æ–‡ç« åˆ°æ²™ç›’ç›®å½•ï¼ˆçœŸçš„ä¸šåŠ¡éœ€æ±‚çš„è¯å¯èƒ½æ˜¯å‘é€ï¼‰ã€‚</li>
<li><code>UITextView</code>çš„<code>markdown</code>çº¯æ–‡æœ¬è½¬<code>html</code>å­—ç¬¦ä¸²ï¼Œ<a href="https://github.com/showdownjs/showdown" target="_blank" rel="external">é€šè¿‡æˆç†Ÿçš„<code>js</code>æ¥å®ç°</a>ï¼Œè‡³äºäº¤äº’ï¼Œä½¿ç”¨<code>JavaScriptCore</code>ï¼ˆä¸é‡å¤é€ è½®å­ï¼Œå°±ä¸è‡ªå·±å†™æ­£åˆ™å¤„ç†äº†ï¼‰ã€‚</li>
<li>é¢„è§ˆé¡µç›´æ¥ç”¨<code>WebView</code>åŠ è½½<code>html</code>å­—ç¬¦ä¸²å³å¯ã€‚</li>
</ul>
<h1 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h1><h2 id="æ­å»ºUI"><a href="#æ­å»ºUI" class="headerlink" title="æ­å»ºUI"></a>æ­å»ºUI</h2><p>è¿™ä¸ªSo easyï¼Œåˆ†åˆ†é’Ÿ~å¦‚ä¸‹å›¾</p>
<p><img src="http://ww1.sinaimg.cn/large/006tNc79ly1ffpljo5k99j31kw0wlh03.jpg" alt="63DAF661-7D46-42D2-BDAC-935FDEA66532"></p>
<p>ä¸Šé¢çš„å›¾è¶³å¤Ÿæ˜ç¡®äº†å§~</p>
<p>ç¼–è¾‘é¡µä¸­æŒæœ‰ä¸€ä¸ª<code>JSContext</code>å¯¹è±¡ï¼ŒåŒæ—¶æŒæœ‰ä¸€ä¸ª<code>inputBar</code>ï¼Œä¸€ä¸ª<code>TextView</code>ï¼ˆæ­£æ–‡ï¼‰ï¼Œä¸€ä¸ª<code>UITextField</code>ï¼ˆæ ‡é¢˜ï¼‰ã€‚</p>
<p>é¢„è§ˆé¡µä¸­æ˜¯ä¸€ä¸ª<code>UIWebView</code>ï¼ˆä¹Ÿå¯ä»¥æ˜¯<code>WKWebView</code>ï¼‰ã€‚</p>
<h2 id="é€»è¾‘å¤„ç†"><a href="#é€»è¾‘å¤„ç†" class="headerlink" title="é€»è¾‘å¤„ç†"></a>é€»è¾‘å¤„ç†</h2><h3 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h3><p><code>EditViewController</code>ä¸­é¦–å…ˆå®ç°åˆå§‹åŒ–æ–¹æ³•ã€‚</p>
<pre><code class="objective-c">- (void)initialize
{
    self.textView.textContainerInset = UIEdgeInsetsMake(10, 5, 10, 5);
    //é”™è¯¯å›è°ƒ
    [self.jsContext setExceptionHandler:^(JSContext *context, JSValue *exception){
        NSLog(@&quot;%@&quot;, exception.toString);
    }];

    //markdown -&gt; html  jså‚è€ƒ https://github.com/showdownjs/showdown
    static NSString *js;
    static dispatch_once_t onceToken;
    dispatch_once(&amp;onceToken, ^{
        js = [NSString stringWithContentsOfFile:[[NSBundle mainBundle] pathForResource:@&quot;showdown&quot; ofType:@&quot;js&quot;] encoding:NSUTF8StringEncoding error:nil];
    });
    //åŠ è½½js
    [self.jsContext evaluateScript:js];

    //æ³¨å…¥function  markdown -&gt; htmlï¼Œä½¿ç”¨æ—¶ï¼Œå¯ä»¥é€šè¿‡ convert(&#39;xxx&#39;); è°ƒç”¨
    NSString *jsFunction = @&quot;\
                            function convert(md) { \
                                return (new showdown.Converter()).makeHtml(md);\
                            }&quot;;
    [self.jsContext evaluateScript:jsFunction];
}
</code></pre>
<p>ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬æå‰ç»™<code>jsContext</code>æ³¨å…¥<code>showdown.js</code>æ–‡ä»¶ï¼Œç„¶åå¯ä»¥ä½¿ç”¨<code>(new showdown.Converter()).makeHtml(md);</code>çš„æ–¹æ³•æ¥å°†<code>markdown</code>å­—ç¬¦ä¸²è½¬æ¢ä¸º<code>html</code>å­—ç¬¦ä¸²ã€‚é‚£ä¹ˆæˆ‘ä»¬ä¹Ÿæå‰æ³¨å…¥äº†ä¸€ä¸ªæ–¹æ³•<code>convert</code> <code>function</code>æ¥ä¾›æˆ‘ä»¬è‡ªå·±è°ƒç”¨ã€‚</p>
<h3 id="æ·»åŠ å·¥å…·æ "><a href="#æ·»åŠ å·¥å…·æ " class="headerlink" title="æ·»åŠ å·¥å…·æ "></a>æ·»åŠ å·¥å…·æ </h3><p>æœ‰ä¸€äº›å­—ç¬¦ï¼Œæ¯”å¦‚â€*ã€-â€œç­‰éƒ½æ˜¯å¾ˆå¸¸ç”¨çš„ï¼Œè¿™é‡Œæˆ‘ä»¬æ·»åŠ ä¸€ä¸ªå·¥å…·æ ï¼Œä¾¿äºç”¨æˆ·å¿«æ·æ“ä½œã€‚æˆ‘ä»¬åœ¨åˆå§‹åŒ–æ–¹æ³•<code>initialize</code>ä¸­æ·»åŠ å¦‚ä¸‹çš„æ–¹æ³•ã€‚</p>
<pre><code class="objective-c">self.textView.inputAccessoryView = self.inputBar;
</code></pre>
<p>å½“ç”¨æˆ·ç‚¹å‡»inputBarä¸Šçš„æŒ‰é’®æ—¶ï¼Œè§¦å‘äº‹ä»¶ï¼š</p>
<pre><code class="objective-c">/**
 ç‚¹å‡»äº†toolBarä¸Šé¢çš„item

 @param item item
 */
- (IBAction)inputBarItemClicked:(UIBarButtonItem *)item
{
    NSString *title = item.title;
    //æ’å…¥çš„æ–‡æœ¬å†…å®¹
    NSString *insertText;
    //æ’å…¥æ–‡æœ¬å†…å®¹åï¼Œç§»åŠ¨å…‰æ ‡åˆ°æŒ‡å®šä½ç½®
    NSRange selectedRange = self.textView.selectedRange;
    if ([title isEqualToString:@&quot;link&quot;]) {
        insertText = @&quot;[]()&quot;;
        selectedRange.location += 1;    //ç§»åŠ¨åˆ° [ åé¢
    } else if ([title isEqualToString:@&quot;img&quot;]) {
        insertText = @&quot;![]()&quot;;
        selectedRange.location += 4;    //ç§»åŠ¨åˆ° ( åé¢
    } else {
        insertText = title;
        selectedRange.location += title.length; //ç§»åŠ¨åˆ°æ’å…¥æ–‡æœ¬çš„æœ€å
    }
    //æ’å…¥æ–‡æœ¬
    [self.textView insertText:insertText];
    //ç§»åŠ¨å…‰æ ‡
    self.textView.selectedRange = selectedRange;
}
</code></pre>
<p>æ•ˆæœå¦‚ä¸‹</p>
<p><img src="http://ww2.sinaimg.cn/large/006tNc79ly1ffpqjn9wngg30aa0iahdt.gif" alt="å·¥å…·æ è¾“å…¥"></p>
<h3 id="é¢„è§ˆ"><a href="#é¢„è§ˆ" class="headerlink" title="é¢„è§ˆ"></a>é¢„è§ˆ</h3><p>æ­¤æ—¶ç”¨æˆ·å¯ä»¥æ„‰æ‚¦åœ°ç¼–è¾‘å†…å®¹ï¼Œå½“ç”¨æˆ·ç¼–è¾‘å®Œæˆæ—¶ï¼Œå¯ä»¥ç‚¹å‡»é¢„è§ˆã€‚é¢„è§ˆçš„æ–¹æ³•å®ç°ï¼š</p>
<pre><code class="objective-c">/**
 é¢„è§ˆ

 @param sender item
 */
- (IBAction)preview:(id)sender
{
    //æ ‡é¢˜ä¸èƒ½ä¸ºç©º
    if (!self.titleTextField.text.length) {
        [self showMessage:@&quot;è¯·å…ˆå¡«å†™æ–‡ç« æ ‡é¢˜&quot;];
        return;
    }
    //è·³è½¬åˆ°é¢„è§ˆé¡µ
    [self performSegueWithIdentifier:kShowPreviewSegueId sender:self];
}

#pragma mark - Setters and Getters

- (NSString *)htmlString
{
    //markdown -&gt; html
    JSValue *jsFunctionValue = self.jsContext[@&quot;convert&quot;];
    JSValue *htmlValue = [jsFunctionValue callWithArguments:@[self.textView.text]];
    return [NSString stringWithFormat:@&quot;\
            &lt;html&gt;\
                &lt;head&gt;\
                    &lt;title&gt;%@&lt;/title&gt;\
                &lt;/head&gt;\
                &lt;body&gt;\
                    %@\
                &lt;/body&gt;\
            &lt;/html&gt;\
            &quot;, self.titleTextField.text, htmlValue.toString];
}

#pragma mark - Navigation

- (void)prepareForSegue:(UIStoryboardSegue *)segue sender:(id)sender
{
    //è·³è½¬åˆ°é¢„è§ˆé¡µ
    if ([segue.identifier isEqualToString:kShowPreviewSegueId]) {
        PreviewViewController *vc = segue.destinationViewController;
        vc.htmlString = [self htmlString];
        vc.title = self.titleTextField.text;
    }
}
</code></pre>
<p>ç‚¹å‡»é¢„è§ˆï¼Œè·³è½¬åˆ°<code>PreviewViewController</code>é¡µé¢ï¼ŒåŒæ—¶ä¼ é€’<code>htmlString</code>ã€‚è¿™é‡Œå¦‚ä½•è·å–<code>htmlString</code>å‘¢ï¼Ÿä¹‹å‰æˆ‘ä»¬åœ¨<code>initialize</code>æ–¹æ³•é‡Œï¼Œæå‰æ³¨å…¥äº†åä¸º<code>convert</code>çš„æ–¹æ³•ï¼Œç°åœ¨æˆ‘ä»¬æ¥è°ƒç”¨å®ƒ</p>
<pre><code class="objective-c">JSValue *jsFunctionValue = self.jsContext[@&quot;convert&quot;];
JSValue *htmlValue = [jsFunctionValue callWithArguments:@[self.textView.text]];
</code></pre>
<p>é‚£æˆ‘ä»¬å¾ˆå®¹æ˜“è·å–åˆ°äº†<code>markdown</code>æ–‡æœ¬è½¬æ¢æˆ<code>html</code>çš„å­—ç¬¦ä¸²äº†ï¼Œç„¶åæˆ‘ä»¬ç»™è¿™ä¸ªå­—ç¬¦ä¸²å®Œå–„ä¸‹ï¼Œæ·»åŠ ä¸Š<code>html</code>æ ‡ç­¾ã€<code>head</code>æ ‡ç­¾ä»¥åŠé¡µé¢çš„<code>title</code>ï¼Œç„¶åä¼ é€’ç»™é¢„è§ˆé¡µï¼Œç›´æ¥å±•ç¤ºå°±OKäº†ã€‚</p>
<p>æ•ˆæœå¦‚ä¸‹å›¾</p>
<p><img src="http://ww2.sinaimg.cn/large/006tNc79ly1ffpqvmwpzfg30ac0ir49m.gif" alt="ç‚¹å‡»é¢„è§ˆ"></p>
<h3 id="ä¿å­˜"><a href="#ä¿å­˜" class="headerlink" title="ä¿å­˜"></a>ä¿å­˜</h3><p>å…¶å®ä¿å­˜ï¼Œè¿™é‡Œåªæ˜¯ç®€å•å®ç°ï¼Œä¿å­˜åˆ°æ²™ç›’ã€‚å®é™…ä¸šåŠ¡éœ€æ±‚ï¼Œå¾ˆå¯èƒ½æ˜¯ä¸€ä¸ªå‘é€æŒ‰é’®ï¼Œä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œæˆ–è€…æ˜¯åˆ†äº«åˆ°å…¶ä»–çš„Appã€‚è¿™é‡Œç®€å•ä»‹ç»ä¸‹ä¿å­˜åˆ°æ²™ç›’ã€‚ä¸‹é¢ä¸Šä»£ç </p>
<pre><code class="objective-c">/**
 ä¿å­˜åˆ°æ²™ç›’ç›®å½•

 @param sender item
 */
- (IBAction)save:(id)sender
{
    //æ ‡é¢˜ä¸èƒ½ä¸ºç©º
    if (!self.titleTextField.text.length) {
        [self showMessage:@&quot;è¯·å…ˆå¡«å†™æ–‡ç« æ ‡é¢˜&quot;];
        return;
    }
    NSData *data = [self.textView.text dataUsingEncoding:NSUTF8StringEncoding];
    NSString *documentPath = NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES).firstObject;
    NSString *filePath = [documentPath stringByAppendingPathComponent:[NSString stringWithFormat:@&quot;%@.md&quot;, self.titleTextField.text]];
    //å†™å…¥æ–‡ä»¶
    [data writeToFile:filePath atomically:YES];
    NSLog(@&quot;mdæˆåŠŸä¿å­˜ï¼Œåœ°å€%@&quot;, filePath);
    [self showMessage:@&quot;ä¿å­˜æˆåŠŸ&quot;];
}
</code></pre>
<p>ä¿å­˜çš„æ—¶å€™ï¼Œç›´æ¥ä¿å­˜æºç åˆ°æœ¬åœ°ï¼Œå°±å¥½äº†ï¼Œæ–‡ä»¶å‘½åä¸º<code>æ ‡é¢˜.md</code>ã€‚</p>
<p>å½“æˆ‘ç‚¹å‡»ä¿å­˜æ—¶ï¼Œä¿å­˜åˆ°æœ¬åœ°ï¼ŒåŒæ—¶è¾“å‡º</p>
<pre><code>DAMarkdownEditor[9717:192504] mdæˆåŠŸä¿å­˜ï¼Œåœ°å€/Users/DarkAngel/Library/Developer/CoreSimulator/Devices/CF831783-E4A6-4EC2-AB99-E04304331C3A/data/Containers/Data/Application/A7837233-9EC3-4E4C-94CB-252329746176/Documents/A test title.md
</code></pre><p>æˆ‘ä»¬ç”¨Safariï¼ŒCmd+Shift+Gï¼Œæ‰“å¼€ä¸Šé¢çš„åœ°å€å¯ä»¥çœ‹åˆ°</p>
<p><img src="http://ww3.sinaimg.cn/large/006tNc79ly1ffpqsm8tfjj316s0o8jyj.jpg" alt="FC42EBA3-1996-4266-A7BC-9B2363F40E04"></p>
<p>æ‰“å¼€è¿™ä¸ªæ–‡ä»¶ï¼Œå¯ä»¥æŸ¥çœ‹ä¸‹ï¼Œæºç å°±æ˜¯æˆ‘ä»¬è¾“å…¥çš„å†…å®¹ã€‚</p>
<p>å…¶å®åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å·²ç»å®Œæˆä¸€ä¸ªç®€å•çš„<code>Markdown</code>ç¼–è¾‘å™¨ã€‚ä½†æ˜¯å°ä¼™ä¼´ä»¬å¯èƒ½ä¼šè¯´ï¼Œé¢„è§ˆçš„<code>html</code>å¤ªä¸‘äº†ï¼Œä¸­é—´çš„ä»£ç å—éƒ½æ²¡æœ‰é«˜äº®ã€‚é‚£å¦‚ä½•è§£å†³å‘¢ï¼Ÿ</p>
<h2 id="ç¾åŒ–æ ·å¼"><a href="#ç¾åŒ–æ ·å¼" class="headerlink" title="ç¾åŒ–æ ·å¼"></a>ç¾åŒ–æ ·å¼</h2><p>å¦‚æœä½ æ‹¥æœ‰ä¸€ç‚¹ç‚¹å‰ç«¯çŸ¥è¯†ï¼Œä½ ä¼šç«‹åˆ»æƒ³åˆ°ï¼Œå°‘äº†ä¸€ä¸ªå¥½çœ‹çš„<code>css</code>æ ·å¼ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ç»™<code>html</code>æ·»åŠ <code>css</code>ï¼Œæ¥ä½¿é¡µé¢çœ‹èµ·æ¥æ›´å¥½çœ‹ã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬åœ¨<code>- (NSString *)htmlString</code>æ–¹æ³•ä¸­ï¼Œç»™htmlæ·»åŠ cssï¼Œè¿™é‡Œæˆ‘æœ¬åœ°æ·»åŠ äº†ä¸€ä¸ª<code>css</code>æ–‡ä»¶ï¼Œç›´æ¥è¯»å–å¹¶æ‹¼æ¥åˆ°<code>head</code>æ ‡ç­¾ä¸­</p>
<pre><code class="objective-c">- (NSString *)htmlString
{
    //markdown -&gt; html
    JSValue *jsFunctionValue = self.jsContext[@&quot;convert&quot;];
    JSValue *htmlValue = [jsFunctionValue callWithArguments:@[self.textView.text]];
    //åŠ è½½cssæ ·å¼
    static NSString *css;
    static dispatch_once_t onceToken;
    dispatch_once(&amp;onceToken, ^{
        css = [NSString stringWithContentsOfFile:[[NSBundle mainBundle] pathForResource:@&quot;markdown&quot; ofType:@&quot;css&quot;] encoding:NSUTF8StringEncoding error:nil];
    });
    return [NSString stringWithFormat:@&quot;\
            &lt;html&gt;\
                &lt;head&gt;\
                    &lt;title&gt;%@&lt;/title&gt;\
                    &lt;style&gt;%@&lt;/style&gt;\
                &lt;/head&gt;\
                &lt;body&gt;\
                    %@\
                &lt;/body&gt;\
            &lt;/html&gt;\
            &quot;, self.titleTextField.text, css, htmlValue.toString];
}
</code></pre>
<p>å¥½å•¦ï¼Œè®©æˆ‘ä»¬å†ç‚¹å‡»é¢„è§ˆä¸€ä¸‹</p>
<p><img src="http://ww4.sinaimg.cn/large/006tNc79ly1ffpr28i2xlg30ac0ir7f7.gif" alt="æ·»åŠ cssåï¼Œç‚¹å‡»é¢„è§ˆ"></p>
<p>è¿™ä¸‹å¥½çœ‹å¤šäº†ï¼Œå¦‚æœå°ä¼™ä¼´ä»¬æƒ³è¦è‡ªå®šä¹‰æ ·å¼ï¼Œåªéœ€è¦ä¿®æ”¹cssæ–‡ä»¶å°±OKå•¦ï¼Œå½“ç„¶Githubä¸Šæœ‰å¾ˆå¤šå¥½çœ‹çš„æ ·å¼å“¦~å¯ä»¥æ‰¾æ‰¾çœ‹ï¼Œä¹Ÿå¯ä»¥è‡ªå·±ä¿®æ”¹ä¸‹cssã€‚</p>
<p>è‡³æ­¤ï¼Œæˆ‘ä»¬çš„<code>Markdown</code>ç¼–è¾‘å™¨å°±å®Œæˆäº†ï¼Œ<code>EditViewController</code>ä¸€å…±181è¡Œï¼Œ<code>PreviewViewController</code>ä¸€å…±38è¡Œï¼ŒåŠ ä¸Šä¸€ä¸ªç®€å•çš„<code>Storyboard</code>ï¼Œæˆ‘ä»¬çš„ç¼–è¾‘å™¨éå¸¸æ¸…çˆ½ã€‚åç»­ï¼Œå†å¯ä»¥ä¼˜åŒ–ä¸‹é¡µé¢çš„UIã€InputBarä¸­å¤šæ·»åŠ ä¸€äº›å¿«æ·æŒ‰é’®ï¼Œä¼˜åŒ–ä¸‹UEï¼Œæˆ‘ä»¬å°±å¯ä»¥ä¸Šä¼ AppStoreå•¦~</p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>ä¸Šé¢æˆ‘ä»¬ç”¨å¾ˆå°‘çš„ä»£ç ï¼Œå¾ˆå°‘çš„æ—¶é—´å®Œæˆäº†ä¸€ä¸ªç®€å•çš„<code>Markdown</code>ç¼–è¾‘å™¨ï¼Œåˆä¸€æ¬¡è¯æ˜äº†<code>JavaScriptCore</code>çš„å¼ºå¤§ï¼ŒåŒæ—¶ä¹Ÿè¯æ˜äº†å‰ç«¯å¦‚æ­¤ç«çƒ­çš„ä»Šå¤©ï¼ŒNativeå¼€å‘ä¾ç„¶æ˜¯ç‹é“ã€‚<code>Github</code>å‰åçš„å¼€æºé¡¹ç›®ä¸­ï¼Œæœ‰<strong>å…­</strong>æ¬¾æ˜¯åŸºäº<code>JavaScript</code>è¯­è¨€çš„ã€‚å¯èƒ½æœ‰äº›å°ä¼™ä¼´ä½œä¸ºä¸€ä¸ªNativeç«¯å¼€å‘ï¼Œä¼šå¾ˆæ–¹ï¼Œå¾ˆå¤šå°ä¼™ä¼´å¼€å§‹å­¦ä¹ å‰ç«¯ï¼Œå­¦ä¹ jsã€‚å½“ç„¶ï¼Œå­¦ä¹ æ–°çš„ä¸œè¥¿æœ¬å°±æ— å¯åšéã€‚ä½†æˆ‘ç›¸ä¿¡ï¼Œè¢«åŠ¨å­¦ä¹ çš„ä¸åœ¨å°‘æ•°ã€‚</p>
<p>é‚£ä¹ˆï¼Œæˆ‘ä»¬å¯ä¸å¯ä»¥åˆ©ç”¨å®ƒï¼Œç»“åˆNativeæ‰“é€ æ›´å¥½çš„Appå‘¢ï¼Ÿç­”æ¡ˆæ˜¯ï¼šä¸€å®šå¯ä»¥ã€‚</p>

    </section>
    <footer class="post-footer">
      <section class="author">
    <h4>Dark Angel</h4>
    <p>iOSç•Œçš„ä½è°ƒæ¢ç´¢è€…</p>
</section>
    <div class="bdsharebuttonbox"><a href="#" class="bds_more" data-cmd="more"></a><a href="#" class="bds_qzone" data-cmd="qzone"></a><a href="#" class="bds_tsina" data-cmd="tsina"></a><a href="#" class="bds_tqq" data-cmd="tqq"></a><a href="#" class="bds_renren" data-cmd="renren"></a><a href="#" class="bds_weixin" data-cmd="weixin"></a></div>
<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdPic":"","bdStyle":"0","bdSize":"16"},"share":{},"image":{"viewList":["qzone","tsina","tqq","renren","weixin"],"viewText":"åˆ†äº«åˆ°ï¼š","viewSize":"16"},"selectShare":{"bdContainerClass":null,"bdSelectMiniList":["qzone","tsina","tqq","renren","weixin"]}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>
    </footer>
  </article>
  <nav class="pagination" role="pagination">
    
    <span class="icon-logo">â€¢</span>
    
    <a class="older-posts" href="/2017/05/11/iOSä¸­UIWebViewä¸WKWebViewã€JavaScriptä¸OCäº¤äº’ã€Cookieç®¡ç†çœ‹æˆ‘å°±å¤Ÿï¼ˆä¸‹ï¼‰/">
        iOSä¸­UIWebViewä¸WKWebViewã€JavaScriptä¸OCäº¤äº’ã€Cookieç®¡ç†çœ‹æˆ‘å°±å¤Ÿï¼ˆä¸‹ï¼‰ â†’
    </a>
    
</nav>

  <div id="comment" class="comments-area">
    
    	<!-- å¤šè¯´è¯„è®ºæ¡† start -->
ã€€	<div class="ds-thread" data-thread-key="2017/05/16/å¦‚ä½•ç”¨æœ€å¿«é€Ÿåº¦æ’¸ä¸ªæœ€ç®€å•çš„markdownç¼–è¾‘å™¨/" data-title="å¦‚ä½•ç”¨æœ€å¿«é€Ÿåº¦æ’¸ä¸ªæœ€ç®€å•çš„markdownç¼–è¾‘å™¨" data-url="http://blog.darkangel7.com/2017/05/16/å¦‚ä½•ç”¨æœ€å¿«é€Ÿåº¦æ’¸ä¸ªæœ€ç®€å•çš„markdownç¼–è¾‘å™¨/" data-auth-key="1"</div>	
	<!-- å¤šè¯´è¯„è®ºæ¡† end -->
	<!-- å¤šè¯´å…¬å…±JSä»£ç  start (ä¸€ä¸ªç½‘é¡µåªéœ€æ’å…¥ä¸€æ¬¡) -->
	<script type="text/javascript">
		var duoshuoQuery = {short_name:"darkangel"};
		(function() {
			var ds = document.createElement('script');
			ds.type = 'text/javascript';ds.async = true;
			ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
			ds.charset = 'UTF-8';
			(document.getElementsByTagName('head')[0] 
		 	|| document.getElementsByTagName('body')[0]).appendChild(ds);
		})();
	</script>
	<!-- å¤šè¯´å…¬å…±JSä»£ç  end -->
    
</div>

</main>


      
<footer class="site-footer">
  
  <a class="subscribe icon-feed" href="/atom.xml"><span class="tooltip">Subscribe!</span></a>
  
  <div class="inner">
     <section class="copyright">åŸåˆ›æ–‡ç« ï¼Œç‰ˆæƒå£°æ˜ï¼šç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 2.5</section>
     <section class="copyright"><a href="/">Dark Angel</a> &copy; 2016 &bull; All Rights Reserved.</section>
     <section class="poweredby">Powered By Hexo</section>
  </div>
</footer>

      <script src="//apps.bdimg.com/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="//cdn.bootcss.com/highlight.js/8.5/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https'){
   bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else{
  bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>

<script type="text/javascript" src="/js/jquery.fitvids.js"></script>
<script type="text/javascript" src="/js/index.js"></script>
<script type="text/javascript" src="/js/menu.js"></script>





  </div>
</div>

<nav  class="outer-nav top horizontal">

          <a class="icon-home"  href="/"><span>Home</span></a>

          <a class="icon-news"  href="/archives"><span>Archive</span></a>

          <a class="icon-wiki"  href="https://github.com/DarkAngel7"><span>Github</span></a>

          <a class="icon-Favorites"  href="/atom.xml"><span>Rss</span></a>

</nav>

</div>
</body>
</html>
