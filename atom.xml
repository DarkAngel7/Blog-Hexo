<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Dark Angel</title>
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://blog.darkangel7.com/"/>
  <updated>2017-05-10T12:14:16.000Z</updated>
  <id>http://blog.darkangel7.com/</id>
  
  <author>
    <name>Dark Angel</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>iOSä¸­UIWebViewä¸WKWebViewã€JavaScriptä¸OCäº¤äº’ã€Cookieç®¡ç†çœ‹æˆ‘å°±å¤Ÿï¼ˆä¸­ï¼‰</title>
    <link href="http://blog.darkangel7.com/2017/05/10/iOS%E4%B8%ADUIWebView%E4%B8%8EWKWebView%E3%80%81JavaScript%E4%B8%8EOC%E4%BA%A4%E4%BA%92%E3%80%81Cookie%E7%AE%A1%E7%90%86%E7%9C%8B%E6%88%91%E5%B0%B1%E5%A4%9F%EF%BC%88%E4%B8%AD%EF%BC%89/"/>
    <id>http://blog.darkangel7.com/2017/05/10/iOSä¸­UIWebViewä¸WKWebViewã€JavaScriptä¸OCäº¤äº’ã€Cookieç®¡ç†çœ‹æˆ‘å°±å¤Ÿï¼ˆä¸­ï¼‰/</id>
    <published>2017-05-10T02:10:09.000Z</published>
    <updated>2017-05-10T12:14:16.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://ww4.sinaimg.cn/large/006tNc79ly1fff1sa06wrj30sg0iwwi9.jpg" alt=""></p>
<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å…³äº<code>UIWebView</code>çš„ä»‹ç»ï¼Œç›¸ä¿¡çœ‹è¿‡<a href="http://blog.darkangel7.com/2016/09/01/iOSä¸­UIWebViewä¸WKWebViewã€JavaScriptä¸OCäº¤äº’ã€Cookieç®¡ç†çœ‹æˆ‘å°±å¤Ÿï¼ˆä¸Šï¼‰/">ä¸Šæ–‡</a>çš„å°ä¼™ä¼´ä»¬ï¼Œå·²ç»å¤§æ¦‚æ¸…æ¥šäº†å§ï¼Œå¦‚æœæœ‰é—®é¢˜ï¼Œæ¬¢è¿æé—®ã€‚</p>
<p>æœ¬æ–‡æ˜¯æœ¬ç³»åˆ—æ–‡ç« çš„ç¬¬äºŒç¯‡ï¼Œä¸»è¦ä¸ºå°ä¼™ä¼´ä»¬åˆ†äº«ä¸‹<code>WKWebView</code>ç›¸å…³çš„å†…å®¹ï¼š</p>
<ul>
<li><a href="http://blog.darkangel7.com/2016/09/01/iOSä¸­UIWebViewä¸WKWebViewã€JavaScriptä¸OCäº¤äº’ã€Cookieç®¡ç†çœ‹æˆ‘å°±å¤Ÿï¼ˆä¸Šï¼‰/">iOSä¸­UIWebViewä¸WKWebViewã€JavaScriptä¸OCäº¤äº’ã€Cookieç®¡ç†çœ‹æˆ‘å°±å¤Ÿï¼ˆä¸Šï¼‰</a></li>
<li>iOSä¸­UIWebViewä¸WKWebViewã€JavaScriptä¸OCäº¤äº’ã€Cookieç®¡ç†çœ‹æˆ‘å°±å¤Ÿï¼ˆä¸­ï¼‰</li>
<li><a href="">iOSä¸­UIWebViewä¸WKWebViewã€JavaScriptä¸OCäº¤äº’ã€Cookieç®¡ç†çœ‹æˆ‘å°±å¤Ÿï¼ˆä¸‹ï¼‰</a>ï¼ˆå¾…å¡«å‘â€¦ï¼‰</li>
</ul>
<p>å…³äºæ–‡ä¸­æåˆ°çš„ä¸€äº›å†…å®¹ï¼Œè¿™é‡Œæˆ‘å‡†å¤‡äº†ä¸ª<a href="https://github.com/DarkAngel7/Demos-WebViewDemo" target="_blank" rel="external">Demo</a>ï¼Œæœ‰éœ€è¦çš„å°ä¼™ä¼´å¯ä»¥ä¸‹è½½ã€‚</p>
<h1 id="WKWebView"><a href="#WKWebView" class="headerlink" title="WKWebView"></a>WKWebView</h1><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p><code>WKWebView</code>æ˜¯AppleäºiOS 8.0æ¨å‡ºçš„<code>WebKit</code>ä¸­çš„æ ¸å¿ƒæ§ä»¶ï¼Œç”¨æ¥æ›¿ä»£<code>UIWebView</code>ã€‚<code>WKWebView</code>æ¯”<code>UIWebView</code>çš„ä¼˜åŠ¿åœ¨äºï¼š</p>
<ul>
<li><p>æ›´å¤šçš„æ”¯æŒHTML5çš„ç‰¹æ€§</p>
</li>
<li><p>é«˜è¾¾60fpsçš„æ»šåŠ¨åˆ·æ–°ç‡ä»¥åŠå†…ç½®æ‰‹åŠ¿</p>
</li>
<li>ä¸Safariç›¸åŒçš„JavaScriptå¼•æ“</li>
<li>å°†UIWebViewDelegateä¸UIWebViewæ‹†åˆ†æˆäº†14ç±»ä¸3ä¸ªåè®®ï¼ˆ<a href="https://developer.apple.com/library/mac/documentation/Cocoa/Reference/WebKit/ObjC_classic/index.html" target="_blank" rel="external">å®˜æ–¹æ–‡æ¡£è¯´æ˜</a>ï¼‰</li>
<li>å¯ä»¥è·å–åŠ è½½è¿›åº¦ï¼š<code>estimatedProgress</code>ï¼ˆUIWebViewéœ€è¦è°ƒç”¨ç§æœ‰Apiï¼‰</li>
</ul>
<p>ä½œè€…æœ¬äººåœ¨é¡¹ç›®ä¸­ä½¿ç”¨<code>WKWebView</code>ä¹Ÿ1å¹´å¤šäº†ï¼Œç¡®ç¡®å®å®æ„Ÿå—åˆ°äº†å®ƒçš„ä¼˜åŠ¿ï¼Œä½†æ˜¯åŒæ ·ä¹Ÿæ„Ÿå—åˆ°äº†å®ƒå¸¦æ¥çš„ä¸€äº›å‘ã€‚ä¸‹é¢æ¥å…·ä½“çš„ä»‹ç»ä¸‹<code>WKWebView</code>ã€‚å…¶å®Appleå¼€æºäº†<a href="https://opensource.apple.com/source/WebKit2/" target="_blank" rel="external">WebKit</a>ï¼Œæœ‰å…´è¶£çš„å°ä¼™ä¼´å¯ä»¥ç ”ç©¶ä¸‹å®ƒçš„å®ç°ã€‚</p>
<h2 id="åŸºæœ¬ç”¨æ³•"><a href="#åŸºæœ¬ç”¨æ³•" class="headerlink" title="åŸºæœ¬ç”¨æ³•"></a>åŸºæœ¬ç”¨æ³•</h2><h4 id="åˆ›å»º"><a href="#åˆ›å»º" class="headerlink" title="åˆ›å»º"></a>åˆ›å»º</h4><p><code>WKWebView</code>çš„åˆ›å»ºæ–¹æ³•æœ‰è¿™ä¸¤ç§</p>
<pre><code class="objective-c">/*-initWithFrame: to initialize an instance with the default configuration. å¦‚æœä½¿ç”¨initWithFrameæ–¹æ³•å°†ä½¿ç”¨é»˜è®¤çš„configuration
The initializer copies the specified configuration, so mutating the configuration after invoking the initializer has no effect on the web view. æˆ‘ä»¬éœ€è¦å…ˆè®¾ç½®configurationï¼Œå†è°ƒç”¨initï¼Œåœ¨initä¹‹åä¿®æ”¹configurationåˆ™æ— æ•ˆ
*/
- (instancetype)initWithFrame:(CGRect)frame configuration:(WKWebViewConfiguration *)configuration NS_DESIGNATED_INITIALIZER;
- (nullable instancetype)initWithCoder:(NSCoder *)coder NS_DESIGNATED_INITIALIZER;
</code></pre>
<p>ä»”ç»†çœ‹ç¬¬ä¸€ä¸ªæ–¹æ³•ï¼Œæ¯”<code>UIWebView</code>å¤šäº†ä¸ª<code>configuration</code>ï¼Œè¿™ä¸ªé…ç½®å¯ä»¥è®¾ç½®å¾ˆå¤šä¸œè¥¿ã€‚å…·ä½“æŸ¥çœ‹<code>WKWebViewConfiguration.h</code>ï¼Œå¯ä»¥é…ç½®jsæ˜¯å¦æ”¯æŒï¼Œç”»ä¸­ç”»æ˜¯å¦å¼€å¯ç­‰ï¼Œè¿™é‡Œä¸»è¦è®²ä¸¤ä¸ªæ¯”è¾ƒå¸¸ç”¨çš„å±æ€§ã€‚</p>
<p>ç¬¬ä¸€ä¸ªå±æ€§æ˜¯<code>websiteDataStore</code>ã€‚</p>
<pre><code class="objective-c">/*! @abstract The website data store to be used by the web view.
 */
@property (nonatomic, strong) WKWebsiteDataStore *websiteDataStore API_AVAILABLE(macosx(10.11), ios(9.0));
</code></pre>
<p>ä¸šç•Œæ™®éè®¤ä¸º <code>WKWebView</code> æ‹¥æœ‰è‡ªå·±çš„ç§æœ‰å­˜å‚¨ï¼Œå®ƒçš„ä¸€äº›ç¼“å­˜ç­‰æ•°æ®éƒ½å­˜åœ¨<code>websiteDataStore</code>ä¸­ï¼Œå…·ä½“å¢åˆ æ”¹æŸ¥å°±å¯ä»¥é€šè¿‡<code>WKWebsiteDataStore.h</code>ä¸­æä¾›çš„æ–¹æ³•ï¼Œè¿™é‡Œä¸å¤šè¯´ï¼Œä¸€èˆ¬ç”¨çš„æ—¶å€™æ¯”è¾ƒå°‘ï¼ŒçœŸçš„è¦æ¸…é™¤ç¼“å­˜ï¼Œç®€å•ç²—æš´çš„æ–¹æ³•æ˜¯åˆ é™¤æ²™ç›’ç›®å½•ä¸­çš„Cacheæ–‡ä»¶å¤¹ã€‚</p>
<p>ç¬¬äºŒä¸ªå±æ€§æ˜¯<code>userContentController</code>ã€‚</p>
<pre><code class="objective-c">/*! @abstract The user content controller to associate with the web view.
*/
@property (nonatomic, strong) WKUserContentController *userContentController;
</code></pre>
<p>è¿™ä¸ªå±æ€§å¾ˆé‡è¦ï¼Œåé¢è®²çš„js-&gt;ocçš„äº¤äº’ï¼Œä»¥åŠæ³¨å…¥jsä»£ç éƒ½ä¼šç”¨åˆ°å®ƒã€‚æŸ¥çœ‹<code>WKUserContentController</code>çš„å¤´æ–‡ä»¶ï¼Œä½ ä¼šå‘ç°å®ƒæœ‰å¦‚ä¸‹å‡ ä¸ªæ–¹æ³•ï¼š</p>
<pre><code class="objective-c">@interface WKUserContentController : NSObject &lt;NSCoding&gt;
//è¯»å–æ·»åŠ è¿‡çš„è„šæœ¬
@property (nonatomic, readonly, copy) NSArray&lt;WKUserScript *&gt; *userScripts;
//æ·»åŠ è„šæœ¬
- (void)addUserScript:(WKUserScript *)userScript;
//åˆ é™¤æ‰€æœ‰æ·»åŠ çš„è„šæœ¬
- (void)removeAllUserScripts;
//é€šè¿‡window.webkit.messageHandlers.&lt;name&gt;.postMessage(&lt;messageBody&gt;) æ¥å®ç°js-&gt;ocä¼ é€’æ¶ˆæ¯ï¼Œå¹¶æ·»åŠ handler
- (void)addScriptMessageHandler:(id &lt;WKScriptMessageHandler&gt;)scriptMessageHandler name:(NSString *)name;
//åˆ é™¤handler
- (void)removeScriptMessageHandlerForName:(NSString *)name;
@end
</code></pre>
<p>é‚£ä¹ˆæ•´ä½“æˆ‘åˆ›å»ºä¸€ä¸ª<code>WKWebView</code>çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="objective-c">WKWebViewConfiguration *configuration = [[WKWebViewConfiguration alloc] init];
WKUserContentController *controller = [[WKUserContentController alloc] init];
configuration.userContentController = controller;
self.webView = [[WKWebView alloc] initWithFrame:self.view.bounds configuration:configuration];
self.webView.allowsBackForwardNavigationGestures = YES;    //å…è®¸å³æ»‘è¿”å›ä¸Šä¸ªé“¾æ¥ï¼Œå·¦æ»‘å‰è¿›
self.webView.allowsLinkPreview = YES; //å…è®¸é“¾æ¥3D Touch
self.webView.customUserAgent = @&quot;WebViewDemo/1.0.0&quot;; //è‡ªå®šä¹‰UAï¼ŒUIWebViewå°±æ²¡æœ‰æ­¤åŠŸèƒ½ï¼Œåé¢ä¼šè®²åˆ°é€šè¿‡å…¶ä»–æ–¹å¼å®ç°
self.webView.UIDelegate = self;
self.webView.navigationDelegate = self;
[self.view addSubview:self.webView];
</code></pre>
<h4 id="åŠ¨æ€æ³¨å…¥js"><a href="#åŠ¨æ€æ³¨å…¥js" class="headerlink" title="åŠ¨æ€æ³¨å…¥js"></a>åŠ¨æ€æ³¨å…¥js</h4><p>é€šè¿‡ç»™<code>userContentController</code>æ·»åŠ <code>WKUserScript</code>ï¼Œå¯ä»¥å®ç°åŠ¨æ€æ³¨å…¥jsã€‚æ¯”å¦‚æˆ‘å…ˆæ³¨å…¥ä¸€ä¸ªè„šæœ¬ï¼Œç»™æ¯ä¸ªé¡µé¢æ·»åŠ ä¸€ä¸ªCookie</p>
<pre><code class="objective-c">//æ³¨å…¥ä¸€ä¸ªCookie
WKUserScript *newCookieScript = [[WKUserScript alloc] initWithSource:@&quot;document.cookie = &#39;DarkAngelCookie=DarkAngel;&#39;&quot; injectionTime:WKUserScriptInjectionTimeAtDocumentStart forMainFrameOnly:NO];
[controller addUserScript:newCookieScript];
</code></pre>
<p>ç„¶åå†æ³¨å…¥ä¸€ä¸ªè„šæœ¬ï¼Œæ¯å½“é¡µé¢åŠ è½½ï¼Œå°±ä¼šalertå½“å‰é¡µé¢cookieï¼Œåœ¨OCä¸­çš„å®ç°</p>
<pre><code class="objective-c">//åˆ›å»ºè„šæœ¬
WKUserScript *cookieScript = [[WKUserScript alloc] initWithSource:@&quot;alert(document.cookie);&quot; injectionTime:WKUserScriptInjectionTimeAtDocumentEnd forMainFrameOnly:NO];
//æ·»åŠ è„šæœ¬
[controller addUserScript:script];
</code></pre>
<p>è¿™æ ·æ¯å½“é¡µé¢å‡ºç°çš„æ—¶å€™ï¼Œä¼šaletå¼¹å‡ºå½“å‰é¡µé¢æ‰€æœ‰çš„cookieå­—ç¬¦ä¸²ã€‚<img src="http://ww1.sinaimg.cn/large/006tNc79ly1ffgc3n3b8fj30ku12aq38.jpg" width="200px;"></p>
<p>æ³¨å…¥çš„js sourceå¯ä»¥æ˜¯ä»»ä½•jså­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥jsæ–‡ä»¶ã€‚æ¯”å¦‚ä½ æœ‰å¾ˆå¤šæä¾›ç»™h5ä½¿ç”¨çš„jsæ–¹æ³•ï¼Œé‚£ä¹ˆä½ æœ¬åœ°å¯èƒ½å°±ä¼šæœ‰ä¸€ä¸ª<code>native_functions.js</code>ï¼Œä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹çš„æ–¹å¼æ·»åŠ </p>
<pre><code class="objective-c">//é˜²æ­¢é¢‘ç¹IOæ“ä½œï¼Œé€ æˆæ€§èƒ½å½±å“
static NSString *jsSource;
static dispatch_once_t onceToken;
  dispatch_once(&amp;onceToken, ^{
      jsSource = [NSString stringWithContentsOfFile:[[NSBundle mainBundle] pathForResource:@&quot;native_functions&quot; ofType:@&quot;js&quot;] encoding:NSUTF8StringEncoding error:nil];
});
//æ·»åŠ è‡ªå®šä¹‰çš„è„šæœ¬
WKUserScript *js = [[WKUserScript alloc] initWithSource:jsSource injectionTime:WKUserScriptInjectionTimeAtDocumentEnd forMainFrameOnly:NO];
[self.configuration.userContentController addUserScript:js];
</code></pre>
<h4 id="åŠ è½½"><a href="#åŠ è½½" class="headerlink" title="åŠ è½½"></a>åŠ è½½</h4><p>åŠ è½½ä¸€ä¸ªè¯·æ±‚æˆ–è€…é¡µé¢ä¹Ÿå¾ˆç®€å•</p>
<pre><code class="objective-c">- (nullable WKNavigation *)loadRequest:(NSURLRequest *)request;
- (nullable WKNavigation *)loadFileURL:(NSURL *)URL allowingReadAccessToURL:(NSURL *)readAccessURL API_AVAILABLE(macosx(10.11), ios(9.0));
- (nullable WKNavigation *)loadHTMLString:(NSString *)string baseURL:(nullable NSURL *)baseURL;
- (nullable WKNavigation *)loadData:(NSData *)data MIMEType:(NSString *)MIMEType characterEncodingName:(NSString *)characterEncodingName baseURL:(NSURL *)baseURL API_AVAILABLE(macosx(10.11), ios(9.0));
</code></pre>
<p>åŸºæœ¬ä¸<code>UIWebView</code>çš„å¾ˆç›¸ä¼¼ï¼Œä½†æ˜¯éœ€è¦è¯´æ˜çš„æ˜¯ï¼ŒåŠ è½½æœ¬åœ°çš„ä¸€ä¸ªhtmléœ€è¦ä½¿ç”¨<code>loadRequest:</code>æ–¹æ³•ï¼Œä½¿ç”¨<code>loadHTMLString:baseURL:</code>æ–¹æ³•ä¼šæœ‰é—®é¢˜ã€‚</p>
<pre><code class="objective-c">[self.webView loadRequest:[NSURLRequest requestWithURL:[NSURL fileURLWithPath:[[NSBundle mainBundle] pathForResource:@&quot;test&quot; ofType:@&quot;html&quot;]]]];
</code></pre>
<h4 id="ä»£ç†"><a href="#ä»£ç†" class="headerlink" title="ä»£ç†"></a>ä»£ç†</h4><p>åœ¨<code>WKWebView</code>çš„å¤´æ–‡ä»¶ï¼Œä½ ä¼šå‘ç°</p>
<pre><code class="objective-c">@protocol WKNavigationDelegate;    //ç±»ä¼¼äºUIWebViewçš„åŠ è½½æˆåŠŸã€å¤±è´¥ã€æ˜¯å¦å…è®¸è·³è½¬ç­‰
@protocol WKUIDelegate;    //ä¸»è¦æ˜¯ä¸€äº›alertã€æ‰“å¼€æ–°çª—å£ä¹‹ç±»çš„
</code></pre>
<p>æœ‰ä¸¤ä¸ªåè®®ï¼Œå®ƒå°†<code>UIWebView</code>çš„ä»£ç†åè®®æ‹†æˆäº†ä¸€ä¸ªè·³è½¬çš„åè®®å’Œä¸€ä¸ªå…³äºUIçš„åè®®ã€‚è™½è¯´è¿™ä¸¤ä¸ªåè®®ä¸­çš„æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯Optionalï¼Œä½†æ˜¯å…³äº<code>WKUIDelegate</code>åè®®æ˜¯æœ‰å‘çš„ï¼Œåé¢çš„<strong>å„ç§å‘</strong>ä¸­ä¼šæåˆ°ã€‚ç®€å•è¯´ä¸‹<code>WKNavigationDelegate</code>ä¸­æ¯”è¾ƒå¸¸ç”¨çš„æ–¹æ³•</p>
<pre><code class="objective-c">//ä¸‹é¢è¿™2ä¸ªæ–¹æ³•å…±åŒå¯¹åº”äº†UIWebViewçš„ - (BOOL)webView:(UIWebView *)webView shouldStartLoadWithRequest:(NSURLRequest *)request navigationType:(UIWebViewNavigationType)navigationType;
//å…ˆï¼šé’ˆå¯¹ä¸€æ¬¡actionæ¥å†³å®šæ˜¯å¦å…è®¸è·³è½¬ï¼Œactionä¸­å¯ä»¥è·å–requestï¼Œå…è®¸ä¸å¦éƒ½éœ€è¦è°ƒç”¨decisionHandlerï¼Œæ¯”å¦‚decisionHandler(WKNavigationActionPolicyCancel);
- (void)webView:(WKWebView *)webView decidePolicyForNavigationAction:(WKNavigationAction *)navigationAction decisionHandler:(void (^)(WKNavigationActionPolicy))decisionHandlerï¼›
//åï¼šæ ¹æ®responseæ¥å†³å®šï¼Œæ˜¯å¦å…è®¸è·³è½¬ï¼Œå…è®¸ä¸å¦éƒ½éœ€è¦è°ƒç”¨decisionHandlerï¼Œå¦‚decisionHandler(WKNavigationResponsePolicyAllow);
- (void)webView:(WKWebView *)webView decidePolicyForNavigationResponse:(WKNavigationResponse *)navigationResponse decisionHandler:(void (^)(WKNavigationResponsePolicy))decisionHandler;

//å¼€å§‹åŠ è½½ï¼Œå¯¹åº”UIWebViewçš„- (void)webViewDidStartLoad:(UIWebView *)webView;
- (void)webView:(WKWebView *)webView didStartProvisionalNavigation:(null_unspecified WKNavigation *)navigation;

//åŠ è½½æˆåŠŸï¼Œå¯¹åº”UIWebViewçš„- (void)webViewDidFinishLoad:(UIWebView *)webView;
- (void)webView:(WKWebView *)webView didFinishNavigation:(null_unspecified WKNavigation *)navigation;

//åŠ è½½å¤±è´¥ï¼Œå¯¹åº”UIWebViewçš„- (void)webView:(UIWebView *)webView didFailLoadWithError:(NSError *)error;
- (void)webView:(WKWebView *)webView didFailNavigation:(null_unspecified WKNavigation *)navigation withError:(NSError *)error;
</code></pre>
<p><code>WKUIDelegate</code>è¿™é‡Œå…ˆä¸æäº†ï¼Œå°ä¼™ä¼´ä»¬å¯ä»¥å‚è€ƒæˆ‘<a href="https://github.com/DarkAngel7/Demos-WebViewDemo" target="_blank" rel="external">Demo</a>ä¸­çš„å®ç°ã€‚</p>
<h4 id="æ–°å±æ€§"><a href="#æ–°å±æ€§" class="headerlink" title="æ–°å±æ€§"></a>æ–°å±æ€§</h4><p><code>WKWebView.h</code>å®šä¹‰äº†å¦‚ä¸‹å‡ ä¸ªå¸¸ç”¨çš„<code>readonly</code>å±æ€§ï¼š</p>
<pre><code class="objective-c">@property (nullable, nonatomic, readonly, copy) NSString *title;    //é¡µé¢çš„titleï¼Œç»ˆäºå¯ä»¥ç›´æ¥è·å–äº†
@property (nullable, nonatomic, readonly, copy) NSURL *URL;        //å½“å‰webViewçš„URL
@property (nonatomic, readonly, getter=isLoading) BOOL loading;    //æ˜¯å¦æ­£åœ¨åŠ è½½
@property (nonatomic, readonly) double estimatedProgress;    //åŠ è½½çš„è¿›åº¦
@property (nonatomic, readonly) BOOL canGoBack;    //æ˜¯å¦å¯ä»¥åé€€ï¼Œè·ŸUIWebViewç›¸åŒ
@property (nonatomic, readonly) BOOL canGoForward;    //æ˜¯å¦å¯ä»¥å‰è¿›ï¼Œè·ŸUIWebViewç›¸åŒ
</code></pre>
<p>è¿™äº›å±æ€§éƒ½å¾ˆæœ‰ç”¨ï¼Œè€Œä¸”æ”¯æŒKVOï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡KVOè§‚å¯Ÿè¿™äº›å€¼çš„å˜åŒ–ï¼Œä»¥ä¾¿äºæˆ‘ä»¬åšå‡ºæœ€å‹å¥½çš„äº¤äº’ã€‚</p>
<h2 id="JavaScriptä¸Objective-Cçš„äº¤äº’"><a href="#JavaScriptä¸Objective-Cçš„äº¤äº’" class="headerlink" title="JavaScriptä¸Objective-Cçš„äº¤äº’"></a>JavaScriptä¸Objective-Cçš„äº¤äº’</h2><p>ä»‹ç»å®Œ<code>WKWebView</code>çš„åŸºæœ¬ç”¨æ³•ï¼Œè®©æˆ‘ä»¬æ¥ç ”ç©¶ä¸‹åŸºäºå®ƒçš„jsä¸ocçš„äº¤äº’ã€‚</p>
<h3 id="OC-gt-JS"><a href="#OC-gt-JS" class="headerlink" title="OC -&gt; JS"></a>OC -&gt; JS</h3><p>è¿™ä¸ªæ¯”è¾ƒç®€å•ï¼Œ<code>WKWebView</code>æä¾›äº†ä¸€ä¸ªç±»ä¼¼<code>JavaScriptCore</code>çš„æ–¹æ³•</p>
<pre><code class="objective-c">//æ‰§è¡Œä¸€æ®µjsï¼Œå¹¶å°†ç»“æœè¿”å›ï¼Œå¦‚æœå‡ºé”™ï¼Œerroråˆ™ä¸ä¸ºç©º
- (void)evaluateJavaScript:(NSString *)javaScriptString completionHandler:(void (^ _Nullable)(_Nullable id result, NSError * _Nullable error))completionHandler;
</code></pre>
<p>è¯¥æ–¹æ³•å¾ˆå¥½çš„è§£å†³äº†ä¹‹å‰æ–‡ç« ä¸­æåˆ°çš„<code>UIWebView</code>ä½¿ç”¨<code>stringByEvaluatingJavaScriptFromString:</code>æ–¹æ³•çš„ä¸¤ä¸ªç¼ºç‚¹ï¼ˆ1. è¿”å›å€¼åªèƒ½æ˜¯NSStringã€‚2. æŠ¥é”™æ— æ³•æ•è·ï¼‰ã€‚æ¯”å¦‚æˆ‘æƒ³è·å–é¡µé¢ä¸­çš„<code>title</code>ï¼Œé™¤äº†ç›´æ¥<code>self.webView.title</code>å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡è¿™ä¸ªæ–¹æ³•ï¼š</p>
<pre><code class="objective-c">[self.webView evaluateJavaScript:@&quot;document.title&quot; completionHandler:^(id _Nullable title, NSError * _Nullable error) {
        NSLog(@&quot;è°ƒç”¨evaluateJavaScriptå¼‚æ­¥è·å–titleï¼š%@&quot;, title);
}];
</code></pre>
<h3 id="JS-gt-OC"><a href="#JS-gt-OC" class="headerlink" title="JS -&gt; OC"></a>JS -&gt; OC</h3><h4 id="URLæ‹¦æˆª"><a href="#URLæ‹¦æˆª" class="headerlink" title="URLæ‹¦æˆª"></a>URLæ‹¦æˆª</h4><p>æ­¤æ–¹æ³•ä¸ä¸Šç¯‡æ–‡ç« ä¸­<code>UIWebView</code>ä»‹ç»åˆ°çš„URLæ‹¦æˆªæ–¹æ³•ä¸€è‡´ï¼Œéƒ½æ˜¯é€šè¿‡è‡ªå®šä¹‰Schemeï¼Œåœ¨é“¾æ¥æ¿€æ´»æ—¶ï¼Œæ‹¦æˆªè¯¥URLï¼Œæ‹¿åˆ°å‚æ•°ï¼Œè°ƒç”¨OCæ–¹æ³•ï¼Œç¼ºç‚¹ä¾ç„¶æ˜æ˜¾ã€‚<code>WKWebView</code>å®ç°èµ·æ¥å¦‚ä¸‹ï¼š</p>
<p>æ¯”å¦‚æˆ‘çš„é“¾æ¥ä¾ç„¶æ˜¯</p>
<pre><code class="html">&lt;a href=&quot;darkangel://smsLogin?username=12323123&amp;code=892845&quot;&gt;çŸ­ä¿¡éªŒè¯ç™»å½•&lt;/a&gt;
</code></pre>
<p>å½“ç”¨æˆ·ç‚¹å‡»è¿™ä¸ªaæ ‡ç­¾æ—¶ï¼Œä¼šè¢«æ‹¦æˆª</p>
<pre><code class="objective-c">- (void)webView:(WKWebView *)webView decidePolicyForNavigationAction:(WKNavigationAction *)navigationAction decisionHandler:(void (^)(WKNavigationActionPolicy))decisionHandler {
    //å¯ä»¥é€šè¿‡navigationAction.navigationTypeè·å–è·³è½¬ç±»å‹ï¼Œå¦‚æ–°é“¾æ¥ã€åé€€ç­‰
    NSURL *URL = navigationAction.request.URL;
    //åˆ¤æ–­URLæ˜¯å¦ç¬¦åˆè‡ªå®šä¹‰çš„URL Scheme
    if ([URL.scheme isEqualToString:@&quot;darkangel&quot;]) {
        //æ ¹æ®ä¸åŒçš„ä¸šåŠ¡ï¼Œæ¥æ‰§è¡Œå¯¹åº”çš„æ“ä½œï¼Œä¸”è·å–å‚æ•°
        if ([URL.host isEqualToString:@&quot;smsLogin&quot;]) {
            NSString *param = URL.query;
            NSLog(@&quot;çŸ­ä¿¡éªŒè¯ç ç™»å½•, å‚æ•°ä¸º%@&quot;, param);
            decisionHandler(WKNavigationActionPolicyCancel);
            return;
        }
    }
    decisionHandler(WKNavigationActionPolicyAllow);
    NSLog(@&quot;%@&quot;, NSStringFromSelector(_cmd));
}
</code></pre>
<p>æ•´ä½“å®ç°æ˜¯ä¸<code>UIWebView</code>ååˆ†ç›¸ä¼¼çš„ï¼Œè¿™é‡Œå°±ä¸å¤šè¯´äº†ã€‚</p>
<p>è¿™é‡Œå†æ¬¡æä¸€ä¸‹<a href="https://github.com/marcuswestin/WebViewJavascriptBridge" target="_blank" rel="external">WebViewJavascriptBridge</a>ï¼Œå®ƒåœ¨æœ€è¿‘çš„æ–°ç‰ˆæœ¬ä¸­æ”¯æŒäº†<code>WKWebView</code>ã€‚ä½¿ç”¨çš„æ–¹æ¡ˆåŒæ ·æ˜¯<strong>æ‹¦æˆªURL</strong>ï¼Œå…·ä½“åŸç†åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­ç®€å•æè¿°è¿‡ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚ä¸‹é¢è¯´ä¸‹Appleçš„æ–°æ–¹æ³•ã€‚</p>
<h4 id="scriptMessageHandler"><a href="#scriptMessageHandler" class="headerlink" title="scriptMessageHandler"></a>scriptMessageHandler</h4><p>è¿™æ˜¯Appleåœ¨<code>WebKit</code>é‡Œæ–°å¢åŠ çš„æ–¹æ³•ï¼Œä½äº<code>WKUserContentController.h</code>ã€‚</p>
<pre><code class="objective-c">/*! @abstract Adds a script message handler.
 @param scriptMessageHandler The message handler to add.
 @param name The name of the message handler.
 @discussion Adding a scriptMessageHandler adds a function
 window.webkit.messageHandlers.&lt;name&gt;.postMessage(&lt;messageBody&gt;) for all
 frames.
 */
- (void)addScriptMessageHandler:(id &lt;WKScriptMessageHandler&gt;)scriptMessageHandler name:(NSString *)name;

/*! @abstract Removes a script message handler.
 @param name The name of the message handler to remove.
 */
- (void)removeScriptMessageHandlerForName:(NSString *)name;
</code></pre>
<p>å…¶å®Appleçš„æ³¨é‡Šå·²ç»å¾ˆæ¸…æ¥šäº†ï¼Œåœ¨OCä¸­æ·»åŠ ä¸€ä¸ªscriptMessageHandlerï¼Œåˆ™ä¼šåœ¨<code>all frames</code>ä¸­æ·»åŠ ä¸€ä¸ªjsçš„functionï¼š <code>window.webkit.messageHandlers.&lt;name&gt;.postMessage(&lt;messageBody&gt;)</code> ã€‚é‚£ä¹ˆå½“æˆ‘åœ¨OCä¸­é€šè¿‡å¦‚ä¸‹çš„æ–¹æ³•æ·»åŠ äº†ä¸€ä¸ªhandlerï¼Œå¦‚</p>
<pre><code class="objective-c">[controller addScriptMessageHandler:self name:@&quot;currentCookies&quot;]; //è¿™é‡Œselfè¦éµå¾ªå WKScriptMessageHandler
</code></pre>
<p>åˆ™å½“æˆ‘åœ¨jsä¸­è°ƒç”¨ä¸‹é¢çš„æ–¹æ³•æ—¶</p>
<pre><code class="javascript">window.webkit.messageHandlers.currentCookies.postMessage(document.cookie);
</code></pre>
<p>æˆ‘åœ¨OCä¸­å°†ä¼šæ”¶åˆ°<code>WKScriptMessageHandler</code>çš„å›è°ƒ</p>
<pre><code class="objective-c">- (void)userContentController:(WKUserContentController *)userContentController didReceiveScriptMessage:(WKScriptMessage *)message {
    if ([message.name isEqualToString:@&quot;currentCookies&quot;]) {
        NSString *cookiesStr = message.body;    //message.bodyè¿”å›çš„æ˜¯ä¸€ä¸ªidç±»å‹çš„å¯¹è±¡ï¼Œæ‰€ä»¥å¯ä»¥æ”¯æŒå¾ˆå¤šç§jsçš„å‚æ•°ç±»å‹(jsçš„functioné™¤å¤–)
        NSLog(@&quot;å½“å‰çš„cookieä¸ºï¼š %@&quot;, cookiesStr);
    }
}
</code></pre>
<p>å½“ç„¶ï¼Œè®°å¾—åœ¨é€‚å½“çš„åœ°æ–¹è°ƒç”¨removeScriptMessageHandler</p>
<pre><code class="objective-c">- (void)dealloc {
    //è®°å¾—ç§»é™¤
    [self.webView.configuration.userContentController removeScriptMessageHandlerForName:@&quot;currentCookies&quot;];
}
</code></pre>
<p>è¿™æ ·å°±å®Œæˆäº†ä¸€æ¬¡å®Œæ•´çš„JS -&gt; OCçš„äº¤äº’ã€‚</p>
<p><strong>é—®é¢˜</strong>ï¼š</p>
<ol>
<li>è¯¥æ–¹æ³•è¿˜æ˜¯<strong>æ²¡æœ‰åŠæ³•ç›´æ¥è·å–è¿”å›å€¼</strong>ã€‚</li>
<li>é€šè¿‡<code>window.webkit.messageHandlers.&lt;name&gt;.postMessage(&lt;messageBody&gt;)</code>ä¼ é€’çš„messageBodyä¸­ä¸èƒ½åŒ…å«jsçš„functionï¼Œ<strong>å¦‚æœåŒ…å«äº†functionï¼Œé‚£ä¹ˆ OCç«¯å°†ä¸ä¼šæ”¶åˆ°å›è°ƒ</strong>ã€‚</li>
</ol>
<p>å¯¹äºé—®é¢˜1ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨å¼‚æ­¥å›è°ƒçš„æ–¹å¼ï¼Œå°†è¿”å›å€¼è¿”å›ç»™jsã€‚å¯¹äºé—®é¢˜2ï¼Œä¸€èˆ¬jsçš„å‚æ•°ä¸­åŒ…å«functionæ˜¯ä¸ºäº†å¼‚æ­¥å›è°ƒï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥æŠŠjsçš„functionè½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œå†ä¼ é€’ç»™OCã€‚</p>
<h3 id="å®é™…è¿ç”¨"><a href="#å®é™…è¿ç”¨" class="headerlink" title="å®é™…è¿ç”¨"></a>å®é™…è¿ç”¨</h3><p>å…³äºä¸Šè¿°é—®é¢˜1å’Œé—®é¢˜2çš„ç»“åˆåˆ©ç”¨ï¼Œå®ç°JS -&gt; OCçš„è°ƒç”¨ï¼Œå¹¶ä¸”OC -&gt; JS å¼‚æ­¥å›è°ƒç»“æœï¼Œè¿™é‡Œè¿˜æ˜¯æ‹¿åˆ†äº«æ¥ä¸¾ä¸ªä¾‹å­ã€‚</p>
<p>æ¯”å¦‚jsç«¯å®ç°äº†å¦‚ä¸‹çš„æ–¹æ³•ï¼ˆè¿™æ®µjsçš„å°è£…å‰é¢çš„æ–‡ç« é‡Œä¹Ÿæœ‰æåŠï¼Œå°ä¼™ä¼´æœ‰é—®é¢˜å¯ä»¥çœ‹ä¸‹ä¹‹å‰çš„ï¼‰ï¼š</p>
<pre><code class="javascript">  /**
   * åˆ†äº«æ–¹æ³•ï¼Œå¹¶ä¸”ä¼šå¼‚æ­¥å›è°ƒåˆ†äº«ç»“æœ
   * @param  {å¯¹è±¡ç±»å‹} shareData ä¸€ä¸ªåˆ†äº«æ•°æ®çš„å¯¹è±¡ï¼ŒåŒ…å«title,imgUrl,linkä»¥åŠä¸€ä¸ªå›è°ƒfunction
   * @return {void}     æ— åŒæ­¥è¿”å›å€¼
   */
  function shareNew(shareData) {

    //è¿™æ˜¯è¯¥æ–¹æ³•çš„é»˜è®¤å®ç°ï¼Œä¸Šç¯‡æ–‡ç« ä¸­æœ‰æ‰€æåŠ
      var title = shareData.title;
      var imgUrl = shareData.imgUrl;
      var link = shareData.link;
      var result = shareData.result;
      //do something
      //è¿™é‡Œæ¨¡æ‹Ÿå¼‚æ­¥æ“ä½œ
      setTimeout(function() {
          //2sä¹‹åï¼Œå›è°ƒtrueåˆ†äº«æˆåŠŸ
          result(true);
      }, 2000);

      //ç”¨äºWKWebViewï¼Œå› ä¸ºWKWebViewå¹¶æ²¡æœ‰åŠæ³•æŠŠjs functionä¼ é€’è¿‡å»ï¼Œå› æ­¤éœ€è¦ç‰¹æ®Šå¤„ç†ä¸€ä¸‹
      //æŠŠjs functionè½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œocç«¯è°ƒç”¨æ—¶ (&lt;js function string&gt;)(true); å³å¯
      shareData.result = result.toString();
      window.webkit.messageHandlers.shareNew.postMessage(shareData);
  }

  function test() {
     //æ¸…ç©ºåˆ†äº«ç»“æœ
    shareResult.innerHTML = &quot;&quot;;

      //è°ƒç”¨æ—¶ï¼Œåº”è¯¥
      shareNew({
          title: &quot;title&quot;,
          imgUrl: &quot;http://img.dd.com/xxx.png&quot;,
          link: location.href,
          result: function(res) {
              //è¿™é‡ŒshareResult ç­‰åŒäº document.getElementById(&quot;shareResult&quot;)
              shareResult.innerHTML = res ? &quot;success&quot; : &quot;failure&quot;;
          }
      });
  }
</code></pre>
<p>åœ¨htmlé¡µé¢ä¸­æˆ‘å®šä¹‰äº†ä¸€ä¸ªaæ ‡ç­¾æ¥è§¦å‘test()å‡½æ•°</p>
<pre><code class="html">&lt;a href=&quot;javascript:void(0);&quot; onClick=&quot;test()&quot;&gt;æµ‹è¯•æ–°åˆ†äº«&lt;/a&gt;
</code></pre>
<p>åœ¨OCç«¯ï¼Œå®ç°å¦‚ä¸‹</p>
<pre><code class="objective-c">//é¦–å…ˆåˆ«å¿˜äº†ï¼Œåœ¨configurationä¸­çš„userContentControllerä¸­æ·»åŠ scriptMessageHandler
[controller addScriptMessageHandler:self name:@&quot;shareNew&quot;];    //è®°å¾—é€‚å½“æ—¶å€™removeå“¦


//ç‚¹å‡»aæ ‡ç­¾æ—¶ï¼Œåˆ™ä¼šè°ƒç”¨ä¸‹é¢çš„æ–¹æ³•
#pragma mark - WKScriptMessageHandler 

- (void)userContentController:(WKUserContentController *)userContentController didReceiveScriptMessage:(WKScriptMessage *)message {
    if ([message.name isEqualToString:@&quot;shareNew&quot;]) {
        NSDictionary *shareData = message.body;
        NSLog(@&quot;shareNewåˆ†äº«çš„æ•°æ®ä¸ºï¼š %@&quot;, shareData);
        //æ¨¡æ‹Ÿå¼‚æ­¥å›è°ƒ
        dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(4 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^{
            //è¯»å–js functionçš„å­—ç¬¦ä¸²
            NSString *jsFunctionString = shareData[@&quot;result&quot;];
            //æ‹¼æ¥è°ƒç”¨è¯¥æ–¹æ³•çš„jså­—ç¬¦ä¸²
            NSString *callbackJs = [NSString stringWithFormat:@&quot;(%@)(%d);&quot;, jsFunctionString, NO];    //åé¢çš„å‚æ•°NOä¸ºæ¨¡æ‹Ÿåˆ†äº«å¤±è´¥
            //æ‰§è¡Œå›è°ƒ
            [self.webView evaluateJavaScript:callbackJs completionHandler:^(id _Nullable result, NSError * _Nullable error) {
                if (!error) {
                    NSLog(@&quot;æ¨¡æ‹Ÿå›è°ƒï¼Œåˆ†äº«å¤±è´¥&quot;);
                }
            }];
        });
    }
}
</code></pre>
<p>é‚£ä¹ˆå½“æˆ‘ç‚¹å‡»aæ ‡ç­¾æ—¶ï¼Œhtmlé¡µé¢ä¸Šè¿‡2sï¼Œä¼šæ˜¾ç¤º<strong>success</strong>ï¼Œç„¶åå†è¿‡2sï¼Œä¼šæ˜¾ç¤º<strong>failure</strong>ã€‚<img src="http://ww2.sinaimg.cn/large/006tNc79ly1ffgcsdc7m3g309w0i776l.gif" alt="new"></p>
<p>æˆ‘ä»¬æ¥ç®€å•åˆ†æä¸€ä¸‹ï¼Œç‚¹å‡»ä¹‹åï¼Œè§¦å‘äº†<code>test()</code>å‡½æ•°ï¼Œ<code>test()</code>ä¸­å°è£…äº†å¯¹<code>share()</code>å‡½æ•°çš„è°ƒç”¨ï¼Œä¸”ä¼ äº†ä¸€ä¸ªå¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œå¯¹è±¡ä¸­<code>result</code>å­—æ®µå¯¹åº”çš„æ˜¯ä¸ªåŒ¿åå‡½æ•°ï¼Œç´§æ¥ç€<code>share()</code>å‡½æ•°è°ƒç”¨ï¼Œå…¶ä¸­çš„å®ç°æ˜¯2sè¿‡åï¼Œ<code>result(true);</code>æ¨¡æ‹Ÿjså¼‚æ­¥å®ç°å¼‚æ­¥å›è°ƒç»“æœï¼Œåˆ†äº«æˆåŠŸã€‚åŒæ—¶<code>share()</code>å‡½æ•°ä¸­ï¼Œå› ä¸ºé€šè¿‡<code>scriptMessageHandler</code>æ— æ³•ä¼ é€’<code>function</code>ï¼Œæ‰€ä»¥å…ˆæŠŠ<code>shareData</code>å¯¹è±¡ä¸­çš„resultè¿™ä¸ªåŒ¿å<code>function</code>è½¬æˆ<code>String</code>ï¼Œç„¶åæ›¿æ¢<code>shareData</code>å¯¹è±¡çš„<code>result</code>å±æ€§ä¸ºè¿™ä¸ª<code>String</code>ï¼Œå¹¶å›ä¼ ç»™OCï¼ŒOCè¿™è¾¹å¯¹åº”JSå¯¹è±¡çš„æ•°æ®ç±»å‹æ˜¯<code>NSDictionary</code>ï¼Œæˆ‘ä»¬æ‰“å°å¹¶å¾—åˆ°äº†æ‰€æœ‰å‚æ•°ï¼ŒåŒæ—¶ï¼ŒæŠŠ<code>result</code>å­—æ®µå¯¹åº”çš„js <code>function String</code>å–å‡ºæ¥ã€‚è¿™é‡Œæˆ‘ä»¬å»¶è¿Ÿ4så›è°ƒï¼Œæ¨¡æ‹ŸNativeåˆ†äº«çš„å¼‚æ­¥è¿‡ç¨‹ï¼Œåœ¨4såï¼Œä¹Ÿå°±æ˜¯jsä¸­æ˜¾ç¤º<strong>success</strong>çš„2sè¿‡åï¼Œè°ƒç”¨jsçš„åŒ¿å<code>function</code>ï¼Œå¹¶ä¼ é€’å‚æ•°ï¼ˆåˆ†äº«ç»“æœï¼‰ã€‚è°ƒç”¨ä¸€ä¸ªjs functionçš„æ–¹æ³•æ˜¯ <code>functionName(argument);</code> ï¼Œè¿™é‡Œç”±äºè¿™ä¸ªjsçš„functionå·²ç»æ˜¯ä¸€ä¸ªStringäº†ï¼Œæ‰€ä»¥æˆ‘ä»¬è°ƒç”¨æ—¶ï¼Œéœ€è¦åŠ ä¸Š<code>()</code>ï¼Œå¦‚ <code>(functionString)(argument);</code>å› æ­¤ï¼Œæœ€ç»ˆæˆ‘ä»¬é€šè¿‡OC -&gt; JS çš„<code>evaluateJavaScript:completionHandler:</code>æ–¹æ³•ï¼ŒæˆåŠŸå®Œæˆäº†å¼‚æ­¥å›è°ƒï¼Œå¹¶ä¼ é€’ç»™jsä¸€ä¸ªåˆ†äº«å¤±è´¥çš„ç»“æœã€‚</p>
<p>ä¸Šé¢çš„æè¿°çœ‹èµ·æ¥å¾ˆå¤æ‚ï¼Œå…¶å®å°±æ˜¯å…ˆæ‰§è¡Œäº†JSçš„é»˜è®¤å®ç°ï¼Œåæ‰§è¡Œäº†OCçš„å®ç°ã€‚ä¸Šé¢çš„ä»£ç å±•ç¤ºäº†å¦‚ä½•è§£å†³<code>scriptMessageHandler</code>çš„ä¸¤ä¸ªé—®é¢˜ï¼Œå¹¶ä¸”å®ç°äº†ä¸€ä¸ª JS -&gt; OCã€OC -&gt; JS å®Œæ•´çš„äº¤äº’æµç¨‹ã€‚</p>
<h2 id="Cookieç®¡ç†"><a href="#Cookieç®¡ç†" class="headerlink" title="Cookieç®¡ç†"></a>Cookieç®¡ç†</h2><p>æ¯”èµ·<code>UIWebView</code>çš„è‡ªåŠ¨ç®¡ç†ï¼Œ<code>WKWebView</code>å‘çˆ¹çš„<code>Cookie</code>ç®¡ç†ï¼Œç›¸ä¿¡é˜»æ­¢äº†å¾ˆå¤šçš„å°è¯•è€…ã€‚è®¸å¤šå°ä¼™ä¼´ä¹Ÿè®¸æ›¾ç»éƒ½æƒ³ä»<code>UIWebView</code>è½¬åˆ°<code>WKWebView</code>ï¼Œä½†ä¼°è®¡å› ä¸º<code>Cookie</code>çš„é—®é¢˜ï¼Œæœ€ç»ˆéƒ½æ”¾å¼ƒäº†ï¼Œç¬”è€…æŠ˜è…¾<code>WKWebView</code>çš„<code>Cookie</code>é•¿è¾¾å¤šåŠå¹´ä¹‹ä¹…ï¼Œä¹Ÿæ›¾æƒ³æ”¾å¼ƒï¼Œä½†æœ€ç»ˆè¿˜æ˜¯åšæŒä¸‹æ¥äº†ï¼Œè™½è¯´ç°åœ¨ä¸æ•¢è¯´å®Œå…¨æŒæ¡ï¼Œè‡³å°‘ä¹Ÿä¸å½±å“æ­£å¸¸ä½¿ç”¨äº†ã€‚</p>
<p>ä¸‹é¢æ¥è¯´å‡ ç‚¹æ³¨æ„äº‹é¡¹ï¼š</p>
<ol>
<li><code>WKWebView</code>åŠ è½½ç½‘é¡µå¾—åˆ°çš„<code>Cookie</code>ä¼šåŒæ­¥åˆ°<code>NSHTTPCookieStorage</code>ä¸­ï¼ˆä¹Ÿè®¸ä½ çœ‹è¿‡ä¸€äº›æ–‡ç« è¯´ä¸èƒ½åŒæ­¥ï¼Œä½†ç¬”è€…è¿™é‡Œè¯´ä¸‹ï¼Œå®ƒçœŸçš„ä¼šï¼Œå¤§å®¶å¯ä»¥å°è¯•ä¸‹ï¼Œå®è·µå‡ºçœŸçŸ¥ï¼‰ã€‚</li>
<li><code>WKWebView</code>åŠ è½½è¯·æ±‚æ—¶ï¼Œä¸ä¼šåŒæ­¥<code>NSHTTPCookieStorage</code>ä¸­å·²æœ‰çš„<code>Cookie</code>ï¼ˆæ˜¯çš„ï¼Œ<strong>æœ€å‘çš„åœ°æ–¹</strong>ï¼‰ã€‚</li>
<li>é€šè¿‡å…±ç”¨ä¸€ä¸ª<code>WKProcessPool</code>å¹¶ä¸èƒ½è§£å†³2ä¸­<code>Cookie</code>åŒæ­¥é—®é¢˜ï¼Œä¸”å¯èƒ½ä¼šé€ æˆ<code>Cookie</code>ä¸¢å¤±ã€‚</li>
</ol>
<p>ç»“åˆè‡ªå·±çš„å®è·µå’Œå‚è€ƒä¸€äº›èµ„æ–™ï¼Œç¬”è€…å¾—åˆ°ä¸Šé¢çš„ç»“è®ºã€‚</p>
<p>å…³äºå¦‚ä½•æ“ä½œ<code>NSHTTPCookieStorage</code>ï¼Œå‰é¢çš„æ–‡ç« ä¸­æåˆ°è¿‡äº†ï¼Œæœ¬æ–‡ä¸å†èµ˜è¿°ã€‚å¯¹äºé—®é¢˜2ï¼Œ<a href="http://stackoverflow.com/questions/26573137/can-i-set-the-cookies-to-be-used-by-a-wkwebview" target="_blank" rel="external">StackOverFlowä¸Šæœ‰äº›è§£ç­”</a>ï¼Œä½†ç»è¿‡å®é™…å°è¯•ï¼Œå‘ç°è¿˜æ˜¯æˆ–å¤šæˆ–å°‘æœ‰ä¸€äº›é—®é¢˜ã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªæœ€ä¸ºè‡´å‘½çš„Cookieé—®é¢˜ï¼Œéœ€è¦çš„åšçš„æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<h3 id="è§£å†³é¦–æ¬¡åŠ è½½Cookieå¸¦ä¸ä¸Šé—®é¢˜"><a href="#è§£å†³é¦–æ¬¡åŠ è½½Cookieå¸¦ä¸ä¸Šé—®é¢˜" class="headerlink" title="è§£å†³é¦–æ¬¡åŠ è½½Cookieå¸¦ä¸ä¸Šé—®é¢˜"></a>è§£å†³é¦–æ¬¡åŠ è½½Cookieå¸¦ä¸ä¸Šé—®é¢˜</h3><p>åœ¨requestçš„requestHeaderä¸­æ·»åŠ Cookieï¼š</p>
<pre><code class="objective-c">NSMutableURLRequest *request = [NSMutableURLRequest requestWithURL:[NSURL URLWithString:@&quot;http://www.baidu.com&quot;]];
NSArray *cookies = [NSHTTPCookieStorage sharedHTTPCookieStorage].cookies;
//Cookiesæ•°ç»„è½¬æ¢ä¸ºrequestHeaderFields
NSDictionary *requestHeaderFields = [NSHTTPCookie requestHeaderFieldsWithCookies:cookies];
//è®¾ç½®è¯·æ±‚å¤´
request.allHTTPHeaderFields = requestHeaderFields;
[self.webView loadRequest:request];
</code></pre>
<p>è¿™æ ·ï¼Œåªè¦ä½ <strong>ä¿è¯<code>sharedHTTPCookieStorage</code>ä¸­ä½ çš„Cookieå­˜åœ¨</strong>ï¼Œé¦–æ¬¡è®¿é—®ä¸€ä¸ªé¡µé¢ï¼Œå°±ä¸ä¼šæœ‰é—®é¢˜ã€‚</p>
<h3 id="è§£å†³åç»­Ajaxè¯·æ±‚Cookieä¸¢å¤±é—®é¢˜"><a href="#è§£å†³åç»­Ajaxè¯·æ±‚Cookieä¸¢å¤±é—®é¢˜" class="headerlink" title="è§£å†³åç»­Ajaxè¯·æ±‚Cookieä¸¢å¤±é—®é¢˜"></a>è§£å†³åç»­Ajaxè¯·æ±‚Cookieä¸¢å¤±é—®é¢˜</h3><p>è§£å†³æ­¤é—®é¢˜ï¼Œä¹Ÿæ¯”è¾ƒç®€å•ï¼Œæ·»åŠ <code>WKUserScript</code>ã€‚</p>
<pre><code class="objective-c">/*!
 *  æ›´æ–°webViewçš„cookie
 */
- (void)updateWebViewCookie
{
    WKUserScript * cookieScript = [[WKUserScript alloc] initWithSource:[self cookieString] injectionTime:WKUserScriptInjectionTimeAtDocumentStart forMainFrameOnly:NO];
    //æ·»åŠ Cookie
    [self.configuration.userContentController addUserScript:cookieScript];
}

- (NSString *)cookieString
{
    NSMutableString *script = [NSMutableString string];
    for (NSHTTPCookie *cookie in [[NSHTTPCookieStorage sharedHTTPCookieStorage] cookies]) {
        // Skip cookies that will break our script
        if ([cookie.value rangeOfString:@&quot;&#39;&quot;].location != NSNotFound) {
            continue;
        }
        // Create a line that appends this cookie to the web view&#39;s document&#39;s cookies
        [script appendFormat:@&quot;document.cookie=&#39;%@&#39;; \n&quot;, cookie.da_javascriptString];
    }
    return script;
}

@interface NSHTTPCookie (Utils)

- (NSString *)da_javascriptString;

@end

@implementation NSHTTPCookie (Utils)

- (NSString *)da_javascriptString
{
    NSString *string = [NSString stringWithFormat:@&quot;%@=%@;domain=%@;path=%@&quot;,
                        self.name,
                        self.value,
                        self.domain,
                        self.path ?: @&quot;/&quot;];
    if (self.secure) {
        string = [string stringByAppendingString:@&quot;;secure=true&quot;];
    }
    return string;
}

@end
</code></pre>
<p>åŒæ ·åªè¦ä½ <strong>ä¿è¯<code>sharedHTTPCookieStorage</code>ä¸­ä½ çš„Cookieå­˜åœ¨</strong>ï¼Œåç»­Ajaxè¯·æ±‚å°±ä¸ä¼šæœ‰é—®é¢˜ã€‚</p>
<h3 id="è§£å†³è·³è½¬æ–°é¡µé¢æ—¶Cookieå¸¦ä¸è¿‡å»é—®é¢˜"><a href="#è§£å†³è·³è½¬æ–°é¡µé¢æ—¶Cookieå¸¦ä¸è¿‡å»é—®é¢˜" class="headerlink" title="è§£å†³è·³è½¬æ–°é¡µé¢æ—¶Cookieå¸¦ä¸è¿‡å»é—®é¢˜"></a>è§£å†³è·³è½¬æ–°é¡µé¢æ—¶Cookieå¸¦ä¸è¿‡å»é—®é¢˜</h3><p>å³ä¾¿ä½ åšåˆ°äº†ä¸Šé¢ä¸¤ç‚¹ï¼Œä½ ä¼šå‘ç°ï¼Œå½“ä½ ç‚¹å‡»é¡µé¢ä¸Šçš„æŸä¸ªé“¾æ¥ï¼Œè·³è½¬åˆ°æ–°çš„é¡µé¢ï¼Œ<code>Cookie</code>åˆä¸¢äº†ğŸ˜³ï¼Œæ­¤æ—¶ä½ æ˜¯æƒ³ç‹—å¸¦çš„~æ€ä¹ˆè§£å†³å‘¢ï¼Ÿ</p>
<pre><code class="objective-c">//æ ¸å¿ƒæ–¹æ³•ï¼š
/**
 ä¿®å¤æ‰“å¼€é“¾æ¥Cookieä¸¢å¤±é—®é¢˜

 @param request è¯·æ±‚
 @return ä¸€ä¸ªfixedRequest
 */
- (NSURLRequest *)fixRequest:(NSURLRequest *)request
{
    NSMutableURLRequest *fixedRequest;
    if ([request isKindOfClass:[NSMutableURLRequest class]]) {
        fixedRequest = (NSMutableURLRequest *)request;
    } else {
        fixedRequest = request.mutableCopy;
    }
    //é˜²æ­¢Cookieä¸¢å¤±
    NSDictionary *dict = [NSHTTPCookie requestHeaderFieldsWithCookies:[NSHTTPCookieStorage sharedHTTPCookieStorage].cookies];
    if (dict.count) {
        NSMutableDictionary *mDict = request.allHTTPHeaderFields.mutableCopy;
        [mDict setValuesForKeysWithDictionary:dict];
        fixedRequest.allHTTPHeaderFields = mDict;
    }
    return fixedRequest;
}

#pragma mark - WKNavigationDelegate 

- (void)webView:(WKWebView *)webView decidePolicyForNavigationAction:(WKNavigationAction *)navigationAction decisionHandler:(void (^)(WKNavigationActionPolicy))decisionHandler {

#warning important è¿™é‡Œå¾ˆé‡è¦
    //è§£å†³Cookieä¸¢å¤±é—®é¢˜
    NSURLRequest *originalRequest = navigationAction.request;
    [self fixRequest:originalRequest];
    //å¦‚æœoriginalRequestå°±æ˜¯NSMutableURLRequest, originalRequestä¸­å·²æ·»åŠ å¿…è¦çš„Cookieï¼Œå¯ä»¥è·³è½¬
    //å…è®¸è·³è½¬
    decisionHandler(WKNavigationActionPolicyAllow);
    //å¯èƒ½æœ‰å°ä¼™ä¼´ï¼Œä¼šè¯´å¦‚æœoriginalRequestæ˜¯NSURLRequestï¼Œä¸å¯å˜ï¼Œé‚£ä¸å°±æ·»åŠ ä¸äº†Cookieäº†ï¼Œæ˜¯çš„ï¼Œæˆ‘ä»¬ä¸èƒ½å› ä¸ºè¿™ä¸ªé—®é¢˜ï¼Œä¸å…è®¸è·³è½¬ï¼Œä¹Ÿä¸èƒ½åœ¨ä¸å…è®¸è·³è½¬ä¹‹åç”¨loadRequeståŠ è½½fixedRequestï¼Œå¦åˆ™ä¼šå‡ºç°æ­»å¾ªç¯ï¼Œå…·ä½“çš„ï¼Œå°ä¼™ä¼´ä»¬å¯ä»¥ç”¨æœ¬åœ°çš„htmlæµ‹è¯•ä¸‹ã€‚

    NSLog(@&quot;%@&quot;, NSStringFromSelector(_cmd));
}

#pragma mark - WKUIDelegate

- (WKWebView *)webView:(WKWebView *)webView createWebViewWithConfiguration:(WKWebViewConfiguration *)configuration forNavigationAction:(WKNavigationAction *)navigationAction windowFeatures:(WKWindowFeatures *)windowFeatures {

#warning important è¿™é‡Œä¹Ÿå¾ˆé‡è¦
    //è¿™é‡Œä¸æ‰“å¼€æ–°çª—å£
    [self.webView loadRequest:[self fixRequest:navigationAction.request]];
    return nil;
}
</code></pre>
<p>æœ€ç»ˆçš„æ–¹æ³•ï¼Œå·²ç»é™„ä¸Šã€‚å°ä¼™ä¼´ä»¬è‡ªè¡Œå‚è€ƒã€‚åŒæ ·éœ€è¦ä½ <strong>ä¿è¯<code>sharedHTTPCookieStorage</code>ä¸­ä½ çš„Cookieå­˜åœ¨</strong>ã€‚</p>
<h3 id="è§£å†³ä¸Šé¢3æ­¥éƒ½åšäº†Cookieä¾ç„¶ä¸¢å¤±"><a href="#è§£å†³ä¸Šé¢3æ­¥éƒ½åšäº†Cookieä¾ç„¶ä¸¢å¤±" class="headerlink" title="è§£å†³ä¸Šé¢3æ­¥éƒ½åšäº†Cookieä¾ç„¶ä¸¢å¤±"></a>è§£å†³ä¸Šé¢3æ­¥éƒ½åšäº†Cookieä¾ç„¶ä¸¢å¤±</h3><p>çœ‹è¿‡ä¸Šé¢çš„æ–¹æ³•è¿‡åï¼Œå°ä¼™ä¼´ä»¬åº”è¯¥è®°å¾—æœ€æ¸…æ¥šçš„æ˜¯<strong>ä¿è¯<code>sharedHTTPCookieStorage</code>ä¸­ä½ çš„Cookieå­˜åœ¨</strong>ã€‚æ€ä¹ˆä¿è¯å‘¢ï¼Ÿç”±äº<strong><code>WKWebView</code>åŠ è½½ç½‘é¡µå¾—åˆ°çš„<code>Cookie</code>ä¼šåŒæ­¥åˆ°<code>NSHTTPCookieStorage</code>ä¸­</strong>çš„ç‰¹ç‚¹ï¼Œæœ‰æ—¶å€™ä½ å¼ºè¡Œæ·»åŠ çš„<code>Cookie</code>ä¼šåœ¨åŒæ­¥è¿‡ç¨‹ä¸­ä¸¢å¤±ã€‚æŠ“åŒ…ï¼ˆ<a href="https://www.charlesproxy.com" target="_blank" rel="external">Macæ¨èCharles</a>ï¼‰ä½ å°±ä¼šå‘ç°ï¼Œç‚¹å‡»ä¸€ä¸ªé“¾æ¥æ—¶ï¼Œ<code>Request</code>çš„<code>header</code>ä¸­å¤šäº†<code>Set-Cookie</code>å­—æ®µï¼Œå…¶å®Cookieå·²ç»ä¸¢äº†ã€‚ä¸‹é¢æ¨èç¬”è€…çš„è§£å†³æ–¹æ¡ˆï¼Œé‚£å°±æ˜¯æŠŠè‡ªå·±éœ€è¦çš„<code>Cookie</code>ä¸»åŠ¨ä¿å­˜èµ·æ¥ï¼Œæ¯æ¬¡è°ƒç”¨<code>[NSHTTPCookieStorage sharedHTTPCookieStorage].cookies</code>æ–¹æ³•æ—¶ï¼Œä¿è¯è¿”å›çš„æ•°ç»„ä¸­æœ‰è‡ªå·±éœ€è¦çš„<code>Cookie</code>ã€‚ä¸‹é¢ä¸Šä»£ç ï¼Œç”¨äº†<code>runtime</code>çš„<code>Method Swizzling</code>ï¼Œè¯¦ç»†ä»£ç ï¼Œè¯·å‚è€ƒ<a href="https://github.com/DarkAngel7/Demos-WebViewDemo" target="_blank" rel="external">Demo</a>ã€‚</p>
<p>é¦–å…ˆæ˜¯åœ¨é€‚å½“çš„æ—¶å€™ï¼Œä¿å­˜</p>
<pre><code class="objective-c">//æ¯”å¦‚ç™»å½•æˆåŠŸï¼Œä¿å­˜Cookie
NSArray *allCookies = [[NSHTTPCookieStorage sharedHTTPCookieStorage] cookies];
for (NSHTTPCookie *cookie in allCookies) {
    if ([cookie.name isEqualToString:DAServerSessionCookieName]) {
        NSDictionary *dict = [[NSUserDefaults standardUserDefaults] dictionaryForKey:DAUserDefaultsCookieStorageKey];
        if (dict) {
            NSHTTPCookie *localCookie = [NSHTTPCookie cookieWithProperties:dict];
            if (![cookie.value isEqual:localCookie.value]) {
                NSLog(@&quot;æœ¬åœ°Cookieæœ‰æ›´æ–°&quot;);
            }
        }
        [[NSUserDefaults standardUserDefaults] setObject:cookie.properties forKey:DAUserDefaultsCookieStorageKey];
        [[NSUserDefaults standardUserDefaults] synchronize];
        break;
    }
}
</code></pre>
<p>åœ¨è¯»å–æ—¶ï¼Œå¦‚æœæ²¡æœ‰åˆ™æ·»åŠ </p>
<pre><code class="objective-c">@implementation NSHTTPCookieStorage (Utils)

+ (void)load
{
    class_methodSwizzling(self, @selector(cookies), @selector(da_cookies));
}

- (NSArray&lt;NSHTTPCookie *&gt; *)da_cookies
{
    NSArray *cookies = [self da_cookies];
    BOOL isExist = NO;
    for (NSHTTPCookie *cookie in cookies) {
        if ([cookie.name isEqualToString:DAServerSessionCookieName]) {
            isExist = YES;
            break;
        }
    }
    if (!isExist) {
        //CookieStroageä¸­æ·»åŠ 
        NSDictionary *dict = [[NSUserDefaults standardUserDefaults] dictionaryForKey:DAUserDefaultsCookieStorageKey];
        if (dict) {
            NSHTTPCookie *cookie = [NSHTTPCookie cookieWithProperties:dict];
            [[NSHTTPCookieStorage sharedHTTPCookieStorage] setCookie:cookie];
            NSMutableArray *mCookies = cookies.mutableCopy;
            [mCookies addObject:cookie];
            cookies = mCookies.copy;
        }
    }
    return cookies;
}

@end
</code></pre>
<p>å½“æ‰“å¼€æ‰‹æœºç™¾åº¦é¦–é¡µåï¼Œæˆ‘ä»¬æŸ¥çœ‹é¡µé¢ä¸­çš„Cookie<img src="http://ww4.sinaimg.cn/large/006tNc79ly1ffgge4xfiqj31jk104tj9.jpg" alt="DB6E63BA-868D-4CD2-9B1B-AC4BD1368437"></p>
<p>å…¶ä¸­ç¬¬ä¸€ä¸ªï¼Œæ˜¯ä¹‹å‰æµ‹è¯•æ·»åŠ çš„ï¼Œç”¨æ¥åŠ¨æ€æ³¨å…¥jsã€‚</p>
<pre><code class="objective-c">WKUserScript *newCookieScript = [[WKUserScript alloc] initWithSource:@&quot;document.cookie = &#39;DarkAngelCookie=DarkAngel;&#39;&quot; injectionTime:WKUserScriptInjectionTimeAtDocumentStart forMainFrameOnly:NO];
[controller addUserScript:newCookieScript];
</code></pre>
<p>ç¬¬äºŒä¸ªï¼Œå°±æ˜¯çœŸæ­£æœ‰ç”¨çš„Cookieå•¦ï¼Œè¿™å¹…å›¾ç”¨åˆ°äº†<code>Safari</code>è°ƒè¯•ï¼Œåé¢ä¼šè®²åˆ°ã€‚é€šè¿‡ä¸Šé¢çš„æŠ˜è…¾ï¼Œä¸€èˆ¬ï¼Œå°±èƒ½å¤Ÿæœ‰æ•ˆå‡å°‘Cookieçš„ä¸¢å¤±äº†ã€‚</p>
<h2 id="æ€§èƒ½å¯¹æ¯”"><a href="#æ€§èƒ½å¯¹æ¯”" class="headerlink" title="æ€§èƒ½å¯¹æ¯”"></a>æ€§èƒ½å¯¹æ¯”</h2><p>åŠ è½½ä¸€èˆ¬çš„é¡µé¢ï¼Œå¯¹æ¯”ä¸å‡ºä»€ä¹ˆï¼Œè¿™é‡Œæˆ‘å°±æµ‹è¯•ä¸‹å†…å­˜å ç”¨å§ï¼ŒåŒæ ·ä¸€ä¸ªhtmlï¼Œåˆ†å¸ƒçœ‹ä¸‹å†…å­˜å ç”¨ã€‚</p>
<p>UIWebView<img src="http://ww4.sinaimg.cn/large/006tNc79ly1ffggxn9b71j318q0gowhc.jpg" alt="C9A288B5-77EE-4FAF-8BAE-1F3E3AD7C86C"></p>
<p>WKWebView<img src="http://ww4.sinaimg.cn/large/006tNc79ly1ffggyx4o9wj31880gqgon.jpg" alt="A8AC12E1-DCDB-453A-AC24-30434485B287"></p>
<p>ä»é¡µé¢UIå…ƒç´ ä¸Šçœ‹ï¼Œ<code>WKWebView</code>è¿˜å¤šä¸ª<code>barButtonItem</code>å‘¢ï¼Œè¿™ä¹ˆç®€å•ä¸ªé¡µï¼Œå†…å­˜å ç”¨ä¹Ÿå°äº†3Mï¼Œå¤æ‚çš„é¡µé¢å¯æƒ³è€ŒçŸ¥ã€‚</p>
<h2 id="å„ç§å‘"><a href="#å„ç§å‘" class="headerlink" title="å„ç§å‘"></a>å„ç§å‘</h2><p>è™½ç„¶<code>WKWebView</code>çœŸçš„å¾ˆä¸é”™ï¼Œä½†æ˜¯å®ƒçš„å‘ï¼Œè¿˜æ˜¯æœ‰å¾ˆå¤šçš„ï¼Œä¸‹é¢ç®€å•è¯´ä¸‹ã€‚</p>
<h3 id="js-alertæ–¹æ³•ä¸å¼¹çª—"><a href="#js-alertæ–¹æ³•ä¸å¼¹çª—" class="headerlink" title="js alertæ–¹æ³•ä¸å¼¹çª—"></a>js alertæ–¹æ³•ä¸å¼¹çª—</h3><p>ä¹‹å‰æè¿‡<code>WKUIDelegate</code>æ‰€æœ‰çš„æ–¹æ³•éƒ½æ˜¯<code>Optional</code>ï¼Œä½†å¦‚æœä½ ä¸å®ç°ï¼Œå®ƒå°±ä¼š</p>
<blockquote>
<p> If you do not implement this method, the web view will behave as if the user selected the OK button.</p>
<pre><code class="objective-c">- (void)webView:(WKWebView *)webView runJavaScriptAlertPanelWithMessage:(NSString *)message initiatedByFrame:(WKFrameInfo *)frame completionHandler:(void (^)(void))completionHandler;
</code></pre>
</blockquote>
<p>OKï¼Œæ„æ€å°±æ˜¯è¯´ï¼Œå¦‚æœä¸å®ç°ï¼Œå°±ä»€ä¹ˆéƒ½ä¸å‘ç”Ÿï¼Œå¥½å§ï¼Œä¹–ä¹–å®ç°å§ï¼Œå®ç°äº†å°±èƒ½å¼¹çª—äº†ã€‚</p>
<h3 id="ç™½å±é—®é¢˜"><a href="#ç™½å±é—®é¢˜" class="headerlink" title="ç™½å±é—®é¢˜"></a>ç™½å±é—®é¢˜</h3><p>å½“WKWebViewåŠ è½½çš„ç½‘é¡µå ç”¨å†…å­˜è¿‡å¤§æ—¶ï¼Œä¼šå‡ºç°ç™½å±ç°è±¡ã€‚è§£å†³æ–¹æ¡ˆæ˜¯</p>
<pre><code class="objective-c">/*! @abstract Invoked when the web view&#39;s web content process is terminated.
 @param webView The web view whose underlying web content process was terminated.
 */
- (void)webViewWebContentProcessDidTerminate:(WKWebView *)webView {
    [webView reload];    //åˆ·æ–°å°±å¥½äº†
}
</code></pre>
<p>æœ‰æ—¶ç™½å±ï¼Œä¸ä¼šè°ƒç”¨è¯¥æ–¹æ³•ï¼Œå…·ä½“çš„è§£å†³æ–¹æ¡ˆæ˜¯</p>
<blockquote>
<p>æ¯”å¦‚ï¼Œæœ€è¿‘é‡åˆ°åœ¨ä¸€ä¸ªé«˜å†…å­˜æ¶ˆè€—çš„H5é¡µé¢ä¸Š present ç³»ç»Ÿç›¸æœºï¼Œæ‹ç…§å®Œæ¯•åè¿”å›åŸæ¥é¡µé¢çš„æ—¶å€™å‡ºç°ç™½å±ç°è±¡ï¼ˆæ‹ç…§è¿‡ç¨‹æ¶ˆè€—äº†å¤§é‡å†…å­˜ï¼Œå¯¼è‡´å†…å­˜ç´§å¼ ï¼ŒWebContent Process è¢«ç³»ç»ŸæŒ‚èµ·ï¼‰ï¼Œä½†ä¸Šé¢çš„å›è°ƒå‡½æ•°å¹¶æ²¡æœ‰è¢«è°ƒç”¨ã€‚åœ¨WKWebViewç™½å±çš„æ—¶å€™ï¼Œå¦ä¸€ç§ç°è±¡æ˜¯ webView.titile ä¼šè¢«ç½®ç©º, å› æ­¤ï¼Œå¯ä»¥åœ¨ viewWillAppear çš„æ—¶å€™æ£€æµ‹ webView.title æ˜¯å¦ä¸ºç©ºæ¥ reload é¡µé¢ã€‚ï¼ˆå‡ºè‡ª<a href="http://mp.weixin.qq.com/s/rhYKLIbXOsUJC_n6dt9UfA" target="_blank" rel="external">WKWebView é‚£äº›å‘</a>ï¼‰</p>
</blockquote>
<h3 id="Cookieä¸¢å¤±"><a href="#Cookieä¸¢å¤±" class="headerlink" title="Cookieä¸¢å¤±"></a>Cookieä¸¢å¤±</h3><p>ä»ä¸€ä¸ªç™»å½•çŠ¶æ€çš„é¡µé¢è·³è½¬åˆ°å¦ä¸€ä¸ªé¡µé¢ï¼ŒWTFï¼Œç™»å½•çŠ¶æ€ä¸¢å¤±äº†ï¼Ÿä»€ä¹ˆé¬¼ï¼Ÿå…¶å®ä¸Šæ–‡ä¸­çš„<strong>Cookieç®¡ç†</strong>ä¸€èŠ‚ï¼Œå·²ç»ä»‹ç»è¿‡è§£å†³æ–¹æ¡ˆäº†ï¼ŒåŸå› ä¹Ÿå°±æ˜¯<strong><code>WKWebView</code>åŠ è½½è¯·æ±‚æ—¶ï¼Œä¸ä¼šåŒæ­¥<code>NSHTTPCookieStorage</code>ä¸­å·²æœ‰çš„<code>Cookie</code></strong>ã€‚å¦‚æœå¶å°”è¿˜æ˜¯ä¼šå‡ºç°ä¸¢å¤±ç™»å½•çŠ¶æ€çš„æƒ…å†µï¼Œé‚£ç¬”è€…åªèƒ½è¯´ï¼Œå†æ£€æŸ¥ä¸‹è‡ªå·±çš„ä»£ç ï¼Œæ‰¾æ‰¾åŸå› ï¼Œæœ‰å¥½çš„è§£å†³æ–¹æ¡ˆï¼Œæ¬¢è¿å‘ŠçŸ¥ç¬”è€…ã€‚</p>
<h3 id="evaluateJavaScript-completionHandler-å¼‚æ­¥"><a href="#evaluateJavaScript-completionHandler-å¼‚æ­¥" class="headerlink" title="evaluateJavaScript:completionHandler:å¼‚æ­¥"></a>evaluateJavaScript:completionHandler:å¼‚æ­¥</h3><p>è¯¥æ–¹æ³•æ˜¯å¼‚æ­¥å›è°ƒï¼Œè¿™ä¸ªä¸€çœ‹æ–¹æ³•çš„å£°æ˜ä¾¿çŸ¥ã€‚å¯èƒ½æœ‰å°ä¼™ä¼´å°±æ˜¯éœ€è¦åŒæ­¥è·å–è¿”å›å€¼ï¼Œæœ‰æ²¡æœ‰åŠæ³•å‘¢ï¼Ÿç­”æ¡ˆæ˜¯<strong>æ²¡æœ‰</strong>ã€‚</p>
<p>å¯èƒ½ä½ ä¼šè¯´ç”¨ä¿¡å·é‡<code>dispatch_semaphore_t</code>ã€‚å¥½å§ï¼Œå¯èƒ½ä½ ä¼šè¿™ä¹ˆå†™~</p>
<pre><code class="objective-c">__block id cookies;
dispatch_semaphore_t semaphore = dispatch_semaphore_create(0);
[self.webView evaluateJavaScript:@&quot;document.cookie&quot; completionHandler:^(id _Nullable result, NSError * _Nullable error) {
    cookies = result;
    dispatch_semaphore_signal(semaphore);
}];
//ç­‰å¾…ä¸‰ç§’ï¼Œæ¥æ”¶å‚æ•°
dispatch_semaphore_wait(semaphore, dispatch_time(DISPATCH_TIME_NOW, 3 * NSEC_PER_SEC));
//æ‰“å°cookieï¼Œè‚¯å®šä¸ºç©ºï¼Œå› ä¸ºè¶³è¶³ç­‰äº†3sï¼Œdispatch_semaphore_signaléƒ½æ²¡æœ‰èµ·ä½œç”¨
NSLog(@&quot;cookieçš„å€¼ä¸ºï¼š%@&quot;, cookies);
</code></pre>
<p>ç¬”è€…æ•…æ„åªç­‰å¾…äº†3sï¼Œå¦‚æœä½ ç­‰å¾…<code>DISPATCH_TIME_FOREVER</code>ï¼Œæ­å–œä½ ï¼Œç¨‹åºä¸ä¼šCrashï¼Œä½†ç•Œé¢å¡æ­»äº†ã€‚ç¬”è€…æµ‹è¯•çš„ç»“æœæ˜¯ï¼Œ<code>NSLog</code>çš„è§¦å‘æ—¶é—´è¦æ—©äº<code>completionHandler</code>å›è°ƒï¼Œä¸è®ºä½ ç­‰å¤šä¹…ï¼Œå®ƒéƒ½ä¼šæ‰“å°nullã€‚æ‰€ä»¥å½“ä½ æ°¸ä¹…ç­‰å¾…æ—¶ï¼Œå°±å¡æ­»äº†ã€‚è¿™é‡Œçš„ç¼˜ç”±ï¼Œç¬”è€…ä¸å¤ªæ¸…æ¥šï¼Œæœ‰ææ¸…æ¥šçš„å°ä¼™ä¼´å¯ä»¥å¸®å¿™æŒ‡ç‚¹ä¸€ä¸‹ï¼Œè°¢è°¢~</p>
<p>æ‰€ä»¥è¿˜æ˜¯è€å®çš„æ¥å—å¼‚æ­¥å›è°ƒå§ï¼Œä¸è¦ç”¨ä¿¡å·æ¥ææˆåŒæ­¥ï¼Œä¼šå¡æ­»çš„ã€‚</p>
<h3 id="è‡ªå®šä¹‰contentInsetåˆ·æ–°æ—¶é¡µé¢è·³åŠ¨çš„bug"><a href="#è‡ªå®šä¹‰contentInsetåˆ·æ–°æ—¶é¡µé¢è·³åŠ¨çš„bug" class="headerlink" title="è‡ªå®šä¹‰contentInsetåˆ·æ–°æ—¶é¡µé¢è·³åŠ¨çš„bug"></a>è‡ªå®šä¹‰contentInsetåˆ·æ–°æ—¶é¡µé¢è·³åŠ¨çš„bug</h3><p>PMè¯´æ¯›ç»ç’ƒå¥½çœ‹ï¼ŒğŸ‘Œï¼Œso easyï¼Œäºæ˜¯æˆ‘ä»¬åœ¨ä»£ç å¦‚æ•²ä¸‹</p>
<pre><code class="objective-c">self.webView.scrollView.contentInset = UIEdgeInsetsMake(64, 0, 49, 0);
</code></pre>
<p>ç„¶åé»˜é»˜çš„å¾®ç¬‘ç€ç‚¹å‡»äº†cmd + Rï¼Œå¤ªç®€å•äº†ã€‚ç„¶åçœ‹åˆ°äº†è¿™æ ·çš„ç”»é¢</p>
<p><img src="http://ww1.sinaimg.cn/large/006tNc79ly1ffgi7f2g9qg30ck0n9anq.gif" alt="new"></p>
<p><img src="http://ww1.sinaimg.cn/large/006tNc79ly1ffghw4zwopj3068061wed.jpg" alt="timg"></p>
<p>æ˜¯çš„ï¼Œä¸Šé¢çš„æ–¹æ³•åœ¨<code>UIWebView</code>ä¸­æ²¡æ¯›ç—…ï¼Œå¯æ˜¯åœ¨<code>WKWebView</code>ä¸­ï¼Œå°±äº§ç”Ÿäº†åˆ·æ–°æ—¶é¡µé¢è·³åŠ¨çš„bugã€‚</p>
<p>è¿™ä¸ªå‘ï¼Œå‘äº†æˆ‘å¤§åŠå¹´ä¹‹ä¹…ï¼ŒAppleçš„<a href="https://developer.apple.com/library/mac/documentation/Cocoa/Reference/WebKit/ObjC_classic/index.html" target="_blank" rel="external">Document</a>ä¸­æ²¡æœ‰è®°å½•ï¼Œæœ€ç»ˆç¬”è€…åœ¨Appleå¼€æºçš„<a href="https://opensource.apple.com/source/WebKit2/" target="_blank" rel="external">WebKit2</a>çš„<a href="[https://opensource.apple.com/source/WebKit2/WebKit2-7603.1.30.0.34/ChangeLog-2014-10-07.auto.html](https://opensource.apple.com/source/WebKit2/WebKit2-7603.1.30.0.34/ChangeLog-2014-10-07.auto.html">ChangeLog</a>)ä¸­æ‰¾åˆ°äº†ç­”æ¡ˆã€‚ä¸‹é¢æ˜¯å®˜æ–¹äººå‘˜çš„å›ç­”ï¼š</p>
<p><img src="http://ww4.sinaimg.cn/large/006tNc79ly1ffghllqjz6j310w0ewagc.jpg" alt="A9018C2C-BB21-41A1-9A67-E6CCE2D75A0E"></p>
<p>å‰å®³äº†ï¼Œwordå“¥ï¼Œæˆ‘é€‰æ‹©ç‹—å¸¦ï¼Œå±…ç„¶è¿˜æ˜¯ç§æœ‰Apiã€‚æ€ä¹ˆæ•´å‘¢ï¼Ÿ</p>
<pre><code class="objective-c">self.webView.scrollView.contentInset = UIEdgeInsetsMake(64, 0, 49, 0);
//å²è¯—çº§ç¥å‘ï¼Œä¸ºä½•å¦‚æ­¤å†™å‘¢ï¼Ÿå‚è€ƒhttps://opensource.apple.com/source/WebKit2/WebKit2-7600.1.4.11.10/ChangeLog  
[self.webView setValue:[NSValue valueWithUIEdgeInsets:self.webView.scrollView.contentInset] forKey:@&quot;_obscuredInsets&quot;];    //kvcç»™WKWebViewçš„ç§æœ‰å˜é‡_obscuredInsetsè®¾ç½®å€¼
</code></pre>
<p>è¿™ä¹ˆå†™å°±OKäº†ï¼Œé€šè¿‡KVCè®¾ç½®ç§æœ‰å˜é‡çš„å€¼ï¼Œç¬”è€…ç”¨äº†åŠå¹´äº†ï¼Œè¿‡Appleå®¡æ ¸æ²¡é—®é¢˜ï¼Œä¸ç”¨æ‹…å¿ƒã€‚å¦‚æœè¿™ä¸ªèƒ½å¸®åŠ©åˆ°å¤§å®¶ï¼Œä¸ç”¨æ„Ÿè°¢æˆ‘~</p>
<h3 id="åŠ è½½POSTè¯·æ±‚ä¸¢å¤±RequestBody"><a href="#åŠ è½½POSTè¯·æ±‚ä¸¢å¤±RequestBody" class="headerlink" title="åŠ è½½POSTè¯·æ±‚ä¸¢å¤±RequestBody"></a>åŠ è½½POSTè¯·æ±‚ä¸¢å¤±RequestBody</h3><p>è¿™ä¸ªé—®é¢˜ï¼Œæ²¡æœ‰ç›´æ¥çš„è§£å†³åŠæ³•ã€‚é—®é¢˜çš„æ ¹æºåœ¨äºï¼š</p>
<blockquote>
<p>åœ¨ webkit2 çš„è®¾è®¡é‡Œä½¿ç”¨ MessageQueue è¿›è¡Œè¿›ç¨‹ä¹‹é—´çš„é€šä¿¡ï¼ŒNetwork Process ä¼šå°†è¯·æ±‚ encode æˆä¸€ä¸ª Message,ç„¶åé€šè¿‡ IPC å‘é€ç»™ App Processã€‚å‡ºäºæ€§èƒ½çš„åŸå› ï¼Œencode çš„æ—¶å€™ HTTPBody å’Œ HTTPBodyStream è¿™ä¸¤ä¸ªå­—æ®µè¢«ä¸¢å¼ƒæ‰äº†ã€‚</p>
<p>å› æ­¤ï¼Œ<strong>å¦‚æœé€šè¿‡ registerSchemeForCustomProtocol æ³¨å†Œäº† http(s) scheme, é‚£ä¹ˆç”± WKWebView å‘èµ·çš„æ‰€æœ‰ http(s)è¯·æ±‚éƒ½ä¼šé€šè¿‡ IPC ä¼ ç»™ä¸»è¿›ç¨‹ NSURLProtocol å¤„ç†ï¼Œå¯¼è‡´ post è¯·æ±‚ body è¢«æ¸…ç©º</strong>ã€‚</p>
<p>ï¼ˆå‡ºè‡ª<a href="http://mp.weixin.qq.com/s/rhYKLIbXOsUJC_n6dt9UfA" target="_blank" rel="external">WKWebView é‚£äº›å‘</a>ï¼‰</p>
</blockquote>
<p>å‚è€ƒ <a href="https://github.com/WebKit/webkit/blob/fe39539b83d28751e86077b173abd5b7872ce3f9/Source/WebKit2/Shared/mac/WebCoreArgumentCodersMac.mm#L61-L88" target="_blank" rel="external">Appleæºç </a> åŠ <a href="https://bugs.webkit.org/show_bug.cgi?id=138169" target="_blank" rel="external">bug report</a> ã€‚</p>
<p>å…·ä½“çš„è§£å†³åŠæ³•ï¼Œå°±æ˜¯å¦è¾Ÿè¹Šå¾„ï¼Œ<a href="http://mp.weixin.qq.com/s/rhYKLIbXOsUJC_n6dt9UfA" target="_blank" rel="external">WKWebView é‚£äº›å‘</a>ä¸­æœ‰ä»‹ç»ï¼Œè¿™é‡Œç¬”è€…ä¸å†å±•å¼€ã€‚</p>
<p>å› ä¸º<code>WKWebView</code>è¢«è®¾è®¡çš„ä½¿ç”¨åœºæ™¯ï¼Œæ˜¯ç”¨æ¥å½“åšæµè§ˆå™¨ï¼Œè§£å†³Nativeå¯ä»¥ç›´æ¥åœ¨Appå†…æµè§ˆç½‘é¡µçš„é—®é¢˜ã€‚è€Œæµè§ˆå™¨æµè§ˆä¸€ä¸ªç½‘ç«™ï¼Œæ€ä¹ˆå¯èƒ½æ˜¯POSTè¯·æ±‚å‘¢ï¼Ÿæ‰€ä»¥è¿™ä¸ªé—®é¢˜ï¼Œç¬”è€…ç›®å‰æ„Ÿå—è¾ƒå°ï¼Œæœ‰éœ€è¦çš„å°ä¼™ä¼´å¯ä»¥è‡ªè¡Œè§£å†³ã€‚</p>
<h3 id="NSURLProtocolé—®é¢˜"><a href="#NSURLProtocolé—®é¢˜" class="headerlink" title="NSURLProtocolé—®é¢˜"></a>NSURLProtocolé—®é¢˜</h3><p><code>WKWebView</code>ä¸åŒäº<code>UIWebView</code>ï¼Œå…¶å®å¹¶ä¸æ”¯æŒ<code>NSURLProtocol</code>ã€‚å¦‚æœæƒ³æ‹¦æˆªï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨ç§æœ‰Apiã€‚</p>
<pre><code class="objective-c">+ [WKBrowsingContextController registerSchemeForCustomProtocol:]
</code></pre>
<p>æ­¤æ–¹æ³•ç¼ºç‚¹ä¹Ÿå¾ˆå¤šï¼Œç¬”è€…è¿™é‡Œä¸æ¨èå°ä¼™ä¼´ä½¿ç”¨ï¼Œæ¯•ç«Ÿè°ƒç”¨ç§æœ‰Apiæ˜¯Appleç¦æ­¢çš„ã€‚å†µä¸”ï¼ŒçœŸçš„å¿…é¡»ä½¿ç”¨<code>NSURLProtocol</code>çš„è¯ï¼Œè¿˜æ˜¯ç”¨<code>UIWebView</code>å§ã€‚</p>
<h1 id="æœªå®Œå¾…ç»­"><a href="#æœªå®Œå¾…ç»­" class="headerlink" title="æœªå®Œå¾…ç»­"></a>æœªå®Œå¾…ç»­</h1><p>æœ¬æ–‡ä¸»è¦è®²è¿°äº†<code>WKWebView</code>çš„ä¸€äº›åŸºç¡€ç”¨æ³•ã€OCä¸JSçš„äº¤äº’ï¼ŒCookieçš„ç®¡ç†ï¼Œä»¥åŠä¸€äº›ä½¿ç”¨è¿‡ç¨‹ä¸­çš„å‘ï¼Œæ—¨åœ¨ä¸ºæ²¡ç”¨è¿‡çš„å°ä¼™ä¼´ä»¬è¯¦ç»†ä»‹ç»ä¸‹ã€‚è™½ç„¶å®ƒçš„å‘å¾ˆå¤šï¼Œä½†æ˜¯å®ƒçš„ä¼˜ç‚¹ä¹Ÿæœ‰å¾ˆå¤šï¼Œæˆ‘ä»¬åº”è¯¥æ•¢äºæ‹¥æŠ±æ–°äº‹ç‰©ï¼Œæ‹¥æŠ±æ–°çŸ¥è¯†ã€‚è¿˜åœ¨ç­‰ä»€ä¹ˆï¼Ÿ<code>WKWebView</code>èµ¶å¿«ç”¨èµ·æ¥å§~</p>
<p>ä¸‹ç¯‡æ–‡ç« ï¼Œå°†ä¸»è¦ä¸ºå°ä¼™ä¼´ä»¬ä»‹ç»ä¸‹å¦‚æœç”¨Safariè°ƒè¯•ï¼Œå®é™…åº”ç”¨ä¸­ä¸€äº›éœ€æ±‚å¦‚ä½•å®ç°ï¼Œå¦‚ä½•æ›´å¥½çš„ä¸å‰ç«¯h5å¼€å‘åŒå­¦é…åˆä»¥åŠå¦‚ä½•æ‰¾å‡ºé—®é¢˜æ‰€åœ¨ç­‰ã€‚ä¸‹ç¯‡æ–‡ç« è§~</p>
<p>To be continuedâ€¦</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://ww4.sinaimg.cn/large/006tNc79ly1fff1sa06wrj30sg0iwwi9.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; titl
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>iOSä¸­NSUserDefaultsçš„é»‘ç§‘æŠ€</title>
    <link href="http://blog.darkangel7.com/2017/05/05/iOS%E4%B8%ADNSUserDefaults%E7%9A%84%E9%BB%91%E7%A7%91%E6%8A%80/"/>
    <id>http://blog.darkangel7.com/2017/05/05/iOSä¸­NSUserDefaultsçš„é»‘ç§‘æŠ€/</id>
    <published>2017-05-05T04:18:12.000Z</published>
    <updated>2017-05-05T09:24:15.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>åœ¨iOSå¼€å‘ä¸­ï¼Œæˆ‘ä»¬æ—¶å¸¸éœ€è¦ä¿å­˜ä¸€äº›æ•°æ®ï¼Œæˆ–è€…å¸Œæœ›åœ¨ç”¨æˆ·ä¸‹æ¬¡æ‰“å¼€Appæ—¶ï¼Œä¾ç„¶å¯ä»¥ä¿ç•™ä¸€äº›è®¾ç½®ç­‰ï¼Œæ¯”å¦‚<strong>ä¸»é¢˜è®¾ç½®</strong>ã€<strong>è¯­è¨€è®¾ç½®</strong>ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¸€èˆ¬ä¼šé€‰æ‹©ä½¿ç”¨<code>NSUserDefaults</code>ä½œä¸ºè½»é‡çº§æ•°æ®æŒä¹…åŒ–æ–¹æ¡ˆã€‚è¿™é‡Œä¸å¯¹å…¶ä»–çš„æ•°æ®æŒä¹…åŒ–æ–¹æ¡ˆï¼ˆå¦‚Plistã€å½’æ¡£ã€Sqlite3ã€CoreDataç­‰ï¼‰è¿›è¡Œæ¢è®¨ï¼Œä¸»è¦æ¥ä»‹ç»ä¸€ä¸‹<code>NSUserDefaults</code>ä¸­çš„ä¸€äº›é»‘ç§‘æŠ€ã€‚</p>
<h1 id="NSUserDefaultsç®€ä»‹"><a href="#NSUserDefaultsç®€ä»‹" class="headerlink" title="NSUserDefaultsç®€ä»‹"></a>NSUserDefaultsç®€ä»‹</h1><p><code>NSUserDefaults</code>åœ¨Foundationæ¡†æ¶ä¸­è¢«å®šä¹‰ï¼Œç”¨æ¥å­˜å‚¨å’Œè¯»å–ä¸€äº›è½»é‡çº§æ•°æ®ã€‚å…¶æœ¬è´¨æ˜¯æ“ä½œplistæ–‡ä»¶ã€‚</p>
<p>å®ƒæ¯”å…¶ä»–æ•°æ®æŒä¹…åŒ–æ–¹æ¡ˆçš„ä¼˜ç‚¹åœ¨äºï¼š</p>
<ul>
<li>è½»é‡çº§ã€‚</li>
<li>æ–¹ä¾¿å¿«æ·ç›´æ¥ä½¿ç”¨ã€‚</li>
<li>æ”¯æŒ<code>NSData</code>, <code>NSString</code>, <code>NSNumber</code>, <code>NSDate</code>, <code>NSArray</code> and  <code>NSDictionary</code>ã€‚</li>
</ul>
<p>ç¼ºç‚¹åœ¨äºï¼š</p>
<ul>
<li>ä¸é€‚åˆå¤§é‡æ•°æ®ã€‚</li>
<li>æ— æ³•å­˜å‚¨è‡ªå®šä¹‰<code>model</code>ã€‚</li>
</ul>
<h1 id="é»‘ç§‘æŠ€"><a href="#é»‘ç§‘æŠ€" class="headerlink" title="é»‘ç§‘æŠ€"></a>é»‘ç§‘æŠ€</h1><p>ä¸€äº›<code>NSUserDefaults</code>æœ€åŸºç¡€çš„ç”¨æ³•ï¼Œè¿™é‡Œå°±ä¸èµ˜è¿°äº†ã€‚è¯´åˆ°é»‘ç§‘æŠ€ï¼Œä¸€èˆ¬æŒ‡çš„æ˜¯é²œä¸ºäººçŸ¥è€Œåˆååˆ†å‰å®³çš„æŠ€æœ¯ã€‚è¿™é‡Œä¸»è¦ä»‹ç»ä¸¤ä¸ªé»‘ç§‘æŠ€ã€‚</p>
<h2 id="è¿˜åŸé»˜è®¤å€¼"><a href="#è¿˜åŸé»˜è®¤å€¼" class="headerlink" title="è¿˜åŸé»˜è®¤å€¼"></a>è¿˜åŸé»˜è®¤å€¼</h2><p>ä¸€èˆ¬<code>NSUserDefaults</code>ä½¿ç”¨ï¼Œéƒ½ä¼šä¿å­˜ä¸€äº›è‡ªå®šä¹‰çš„Keyå’ŒValueï¼Œå…¶å®è¿™ä¸ªä¸æ¶‰åŠè¿˜åŸé»˜è®¤å€¼çš„é—®é¢˜ã€‚å…¶å®æœ‰äº›æ—¶å€™ï¼Œæ˜¯éœ€è¦ä¿®æ”¹å…¶ä¸­çš„ç³»ç»Ÿé»˜è®¤å€¼çš„ã€‚æ¯”å¦‚åº”ç”¨å†…åˆ‡æ¢ä¸­è‹±æ–‡ï¼Œå°±éœ€è¦ä¿®æ”¹<code>AppleLanguages</code>çš„valueã€‚æ—¢ç„¶ä¿®æ”¹äº†ç³»ç»Ÿé»˜è®¤å€¼ï¼Œæ€ä¹ˆè¿˜åŸé»˜è®¤å€¼å‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ä¿®æ”¹å‰çš„ï¼š</p>
<pre><code>po [NSUserDefaults standardUserDefaults].dictionaryRepresentation

{
    ...
    AppleLanguages =     (
        en,
        &quot;zh-Hans-US&quot;
    );
    AppleLocale = &quot;en_US&quot;;
    ...
}
</code></pre><p>å¯ä»¥çœ‹åˆ°<code>AppleLanguages</code>å¯¹åº”çš„æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå¦‚æœæˆ‘ä»¬åœ¨Appå†…æƒ³åˆ‡æ¢æˆä¸­æ–‡ï¼Œæ‰§è¡Œ</p>
<pre><code class="objective-c">[[NSUserDefaults standardUserDefaults] setObject:@[@&quot;zh-Hans&quot;] forKey:@&quot;AppleLanguages&quot;];
</code></pre>
<p>å†æ¬¡çœ‹ä¸‹ä¿®æ”¹å</p>
<pre><code>po [NSUserDefaults standardUserDefaults].dictionaryRepresentation

{
    ...
    AppleLanguages =     (
        zh-Hans
    );
    AppleLocale = &quot;en_US&quot;;
    ...
}
</code></pre><p>å¥½å§ï¼Œè¿™ä¸ª<code>AppleLanguages</code>å­—æ®µçš„å€¼å·²ç»è¢«è®°å½•äº†ã€‚è¿™æ—¶å€™ï¼Œkillå®¢æˆ·ç«¯ï¼Œé‡æ–°æ‰“å¼€å®¢æˆ·ç«¯ï¼Œå‘ç°ï¼Œè¿™ä¸ªå€¼è‚¯å®šä¸ä¼šå˜ã€‚é‚£ä¹ˆå¦‚æœè¿™ä¸ªæ—¶å€™ç”¨æˆ·åœ¨ç³»ç»Ÿè®¾ç½®ä¸­åˆ‡æ¢åˆ°äº†æ—¥è¯­ï¼Œé‚£ä¹ˆæˆ‘æƒ³åœ¨å®¢æˆ·ç«¯ä¸­é€šè¿‡<strong>è·Ÿéšæ‰‹æœºç³»ç»Ÿ</strong>çš„è®¾ç½®ï¼Œè¿˜åŸåˆ°æ—¥è¯­ï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p>
<p>æˆ–è®¸ä½ ä¼šæƒ³åˆ°è®°å½•åˆå§‹å€¼ï¼Œåªè¦æå‰è®°å½•ï¼Œåœ¨è¿˜åŸæ—¶å†setå›å»å°±å¯ä»¥äº†ã€‚å—¯~æ²¡æ¯›ç—…ï¼Œå¯æ˜¯åœ¨ä»€ä¹ˆåœ°æ–¹ä»€ä¹ˆæ—¶å€™è®°å½•åˆå§‹å€¼å‘¢ï¼Ÿè¿™ä¸ª<code>AppleLanguages</code>å­—æ®µå…¶å®å°±æ˜¯ç³»ç»Ÿçš„è¯­è¨€é»˜è®¤å€¼ï¼Œä½ å·²ç»æŠŠå®ƒæ”¹è¿‡äº†ï¼Œå¦‚æœåœ¨ä½ æ”¹è¿‡ä¹‹åç”¨æˆ·åˆä¿®æ”¹äº†ç³»ç»Ÿè¯­è¨€ï¼Œé‚£ä½ æ˜¯æ‹¿ä¸åˆ°æ–°é»˜è®¤å€¼çš„ï¼Œæ‰€ä»¥è¿™æ¡è·¯æ˜¯èµ°ä¸é€šçš„ã€‚</p>
<p>é‚£æ€ä¹ˆå®ç°è¿˜åŸé»˜è®¤å€¼å‘¢ï¼Ÿçœ‹ä¸‹è¿™ä¸ªæ–¹æ³•ï¼š</p>
<pre><code>/*!
 -setObject:forKey: immediately stores a value (or removes the value if nil is passed as the value) for the provided key in the search list entry for the receiver&#39;s suite name in the current user and any host, then asynchronously stores the value persistently, where it is made available to other processes.
 */
- (void)setObject:(nullable id)value forKey:(NSString *)defaultName;
</code></pre><p>è¿™ä¸ªæ–¹æ³•Documentä¸­å¹¶æ²¡æœ‰æè¿°è¿‡å¤šï¼ŒåŸºæœ¬éƒ½æ˜¯åœ¨å¼ºè°ƒ<code>value</code>å¿…é¡»æ˜¯<code>NSData</code>, <code>NSString</code>, <code>NSNumber</code>, <code>NSDate</code>, <code>NSArray</code> and  <code>NSDictionary</code>ä¸­çš„ä¸€ç§ï¼Œä¸”<code>NSArray</code> and  <code>NSDictionary</code>ä¸­çš„å€¼ä¹Ÿå¿…é¡»æ˜¯Plistæ”¯æŒçš„ç±»å‹ã€‚åœ¨æ³¨é‡Šä¸­æœ‰å¼ºè°ƒï¼Œ<code>removes the value if nil is passed as the value</code>ï¼Œä¼ nilç­‰åŒäºåˆ é™¤è¿™ä¸ªé”®å€¼å¯¹ã€‚</p>
<pre><code>/// -removeObjectForKey: is equivalent to -[... setObject:nil forKey:defaultName]
- (void)removeObjectForKey:(NSString *)defaultName;
</code></pre><p>å…¶å®è¿™é‡Œæ‰æ˜¯å…³é”®</p>
<pre><code>[[NSUserDefaults standardUserDefaults] setObject:nil forKey:@&quot;AppleLanguages&quot;];
//or
[[NSUserDefaults standardUserDefaults] removeObjectForKey:@&quot;AppleLanguages&quot;];
</code></pre><p>ç„¶åå†æ¬¡</p>
<pre><code>po [NSUserDefaults standardUserDefaults].dictionaryRepresentation

{
    ...
    AppleLanguages =     (
        en,
        &quot;zh-Hans-US&quot;
    );
    AppleLocale = &quot;en_US&quot;;
    ...
}
</code></pre><p>ä½ ä¼šå‘ç°ï¼ŒWTFï¼Œå±…ç„¶è¿™ä¸ªå­—æ®µè¿˜å­˜åœ¨ï¼Œä¸”è¿˜åŸæˆäº†é»˜è®¤å€¼ï¼Œå‰å®³äº†wordå“¥ã€‚æœ¬æ–¹æ³•æ˜¯æœ¬äººå†ç»å„ç§å‘ä¹‹åå‘ç°çš„ï¼Œä¸”å®˜æ–¹æ–‡æ¡£ä¸­æ²¡æœ‰ä»»ä½•æåŠï¼Œåªèƒ½è¯´Appleçˆ¸çˆ¸ä»»æ€§ã€‚</p>
<h2 id="å·§ç”¨SuiteName"><a href="#å·§ç”¨SuiteName" class="headerlink" title="å·§ç”¨SuiteName"></a>å·§ç”¨SuiteName</h2><pre><code>- (nullable instancetype)initWithSuiteName:(nullable NSString *)suitename NS_AVAILABLE(10_9, 7_0) NS_DESIGNATED_INITIALIZER;
</code></pre><p>è¿™ä¸ªæ–¹æ³•ï¼Œæƒ³å¿…å„ä½ä¸ä¼šé™Œç”Ÿï¼Œåœ¨è·¨Appé—´é€šä¿¡æˆ–è€…ä¸»Appä¸Extensionå…±äº«æ•°æ®ï¼Œéƒ½ä¼šç”¨åˆ°ï¼Œä¸€èˆ¬é…åˆä½¿ç”¨çš„æ˜¯<strong>App Groups</strong>ã€‚</p>
<h3 id="App-Groupsæ•°æ®å…±äº«"><a href="#App-Groupsæ•°æ®å…±äº«" class="headerlink" title="App Groupsæ•°æ®å…±äº«"></a>App Groupsæ•°æ®å…±äº«</h3><p>åœ¨App Groupsä¸­ä½¿ç”¨ï¼Œä¸€èˆ¬ä¸¤ä¸ªAppéƒ½éœ€è¦åŠ å…¥åŒä¸€ä¸ªGroupã€‚<img src="http://ww1.sinaimg.cn/large/006tNbRwly1ffajfof2qdj30x00cqjsl.jpg" alt="">ç„¶ååœ¨ä¸¤ä¸ªAppåˆ†åˆ«ä½¿ç”¨</p>
<pre><code class="objective-c">- (NSUserDefaults *)userDefaults
{
    return [[NSUserDefaults alloc] initWithSuiteName:@&quot;group.urwork.autosignin&quot;];    //nameéœ€è¦æ˜¯Groupçš„id
}
</code></pre>
<p>æ¥å­˜å‚¨å’Œè¯»å–æ•°æ®ï¼Œå³å¯å®ç°æ•°æ®å…±äº«ã€‚</p>
<h3 id="è¶…å¾®å‹ç®€å•æ–¹ä¾¿æ˜“ç”¨æ•°æ®åº“"><a href="#è¶…å¾®å‹ç®€å•æ–¹ä¾¿æ˜“ç”¨æ•°æ®åº“" class="headerlink" title="è¶…å¾®å‹ç®€å•æ–¹ä¾¿æ˜“ç”¨æ•°æ®åº“"></a>è¶…å¾®å‹ç®€å•æ–¹ä¾¿æ˜“ç”¨æ•°æ®åº“</h3><p>è¿™é‡Œï¼Œå…¶å®ä¸»è¦ä»‹ç»ä¸€ä¸‹<code>initWithSuiteName:</code>çš„å¦ä¸€ä¸ªç”¨é€”ï¼Œæˆ‘ç§°ä¹‹ä¸º<strong>è¶…å¾®å‹ç®€å•æ–¹ä¾¿æ˜“ç”¨æ•°æ®åº“</strong>ã€‚</p>
<p><strong>éœ€æ±‚</strong>ï¼šåå°åŒå­¦æœ€è¿‘å¤ªå¿™ï¼ˆğŸ˜³è¿™ä¸æ˜¯ç†ç”±ï¼‰ï¼Œéœ€è¦å®¢æˆ·ç«¯åŒå­¦ä¸´æ—¶å¼€å‘ä¸€ä¸ªæœ¬åœ°çš„æµè§ˆå†å²åŠŸèƒ½ã€‚ç®€å•çš„è¯´å°±æ˜¯åœ¨å®¢æˆ·ç«¯æœ¬åœ°ä¿å­˜æ¯ä¸ªç”¨æˆ·æµè§ˆçš„æ–‡ç« è®°å½•ã€‚</p>
<p><strong>åç³Ÿ</strong>ï¼šå¥½å§ï¼Œæ—¶é—´ç´§ï¼Œä»»åŠ¡é‡ï¼ŒåŠŸèƒ½å…ˆä¸Šçº¿ï¼Œåç»­å†ä¼˜åŒ–å·²ç»æ˜¯ä¸€ä¸ªä¹ æƒ¯äº†ğŸ˜³ã€‚</p>
<p><strong>å®ç°æ–¹æ¡ˆ</strong>ï¼šç®€å•ï¼Œæœ¬åœ°å­˜ä¸ªå­—å…¸ï¼ˆæˆ–è€…Plistæ–‡ä»¶ï¼‰ï¼Œæ¯ä¸ªkeyæ˜¯ä¸€ä¸ªç”¨æˆ·idï¼Œvalueæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„é‡Œçš„æ¯ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œè¿™ä¸ªå­—å…¸é‡Œæœ‰<code>articleId</code>ã€<code>title</code>ã€<code>imgUrl</code>ã€<code>...</code>ã€‚ç»“æ„å¤§æ¦‚æ˜¯è¿™æ ·ï¼š</p>
<pre><code>{
  &quot;10086&quot; : [
    {
      &quot;articleId&quot; : 1,
      &quot;imgUrl&quot; : &quot;https://img.xxx.com/abcdefg.png&quot;,
      &quot;title&quot; : &quot;ä¸­å›½å†å²&quot;,
      ...
    },
    {
      &quot;articleId&quot; : 2,
      &quot;imgUrl&quot; : &quot;https://img.xxx.com/abcdefg.png&quot;,
      &quot;title&quot; : &quot;ä¸­å›½æ•™è‚²&quot;,
      ...
    },
    ...
  ],
  &quot;10087&quot; : [
    {
      &quot;articleId&quot; : 2,
      &quot;imgUrl&quot; : &quot;https://img.xxx.com/abcdefg.png&quot;,
      &quot;title&quot; : &quot;ä¸­å›½æ•™è‚²&quot;,
      ...
    },
    ...
  ]
}
</code></pre><p>çœ‹èµ·æ¥OKï¼Œä½†æ˜¯å°ä¼™ä¼´ä»¬ï¼Œæ€§èƒ½é—®é¢˜è¿˜æ˜¯è¦è€ƒè™‘çš„ã€‚æˆ‘æƒ³è·å–æŸä¸ªç”¨æˆ·çš„æµè§ˆå†å²ï¼Œéœ€è¦æŠŠæ–‡ä»¶æ•´ä½“è¯»åˆ°å†…å­˜ä¸­ï¼Œç„¶åç”¨<code>dict[@&quot;10086&quot;]</code>çš„æ–¹æ³•ï¼Œå¾—åˆ°è¿™ä¸ªç”¨æˆ·çš„æµè§ˆå†å²<code>Array</code>ï¼Œç”¨æˆ·å°‘è¿˜å¥½ï¼Œå¤šäº†ï¼Œæ¯æ¬¡è¯»å–çš„IOæ“ä½œä¼šå¾ˆè€—æ—¶ï¼Œå¯¹æ€§èƒ½æœ‰å½±å“ã€‚</p>
<p>å¯èƒ½ä½ ä¼šè¯´ç”¨æ•°æ®åº“å•Šä»€ä¹ˆçš„ï¼Œå½“ç„¶å¯ä»¥ï¼Œä½†æ˜¯åˆæ˜¯éœ€è¦ä¾èµ–ä¸€å †ç¬¬ä¸‰æ–¹ï¼Œè¿˜è¦å†™å¥½å¤šä»£ç ï¼Œåˆ›å»ºå¥½å¤šç±»ã€‚æˆ‘å°±æ˜¯æƒ³ç®€å•å®ç°ä¸€ä¸‹ï¼Œæœ‰æ²¡æœ‰æ›´å¥½çš„æ–¹æ³•å‘¢ï¼Ÿå½“ç„¶æœ‰ï¼Œ<strong>è¶…å¾®å‹ç®€å•æ–¹ä¾¿æ˜“ç”¨æ•°æ®åº“</strong>ã€‚</p>
<p>æ¯ä¸ªç”¨æˆ·éƒ½å¯ä»¥ç”¨ä¸€ä¸ª<code>NSUserDefaults</code>æ¥ä»£æ›¿ï¼Œæ¯ä¸ªç”¨æˆ·çš„æµè§ˆå†å²ï¼Œå¯ä»¥ç›´æ¥ç”¨<code>setObject:forKey:</code>çš„æ–¹å¼æ¥å­˜å‚¨ï¼Œå¦‚ï¼š</p>
<pre><code class="objective-c">//è¿™ä¸ªè·ŸApp Groupsæ²¡æœ‰å…³ç³»
//å·²æœ‰åˆ™è¯»å–ï¼Œæ²¡æœ‰åˆ™åˆ›å»º
NSUserDefaults *userDefaults = [[NSUserDefaults alloc] initWithSuiteName:@&quot;10086&quot;];
//å­˜å‚¨
[userDefaults setObject:history forKey:@&quot;ArticleBrowsingHistory&quot;];
//è¯»å–
NSArray *history = [userDefaults objectForKey:@&quot;ArticleBrowsingHistory&quot;];
</code></pre>
<p>æ‰€æœ‰ç”¨æˆ·ç›¸å¯¹ç‹¬ç«‹ï¼Œæ¯ä¸ªç”¨æˆ·æ˜¯ä¸€ä¸ªplistæ–‡ä»¶ï¼Œåœ¨æ²™ç›’ç›®å½•<code>/Library/Preferences/</code>ä¸­ï¼Œ<img src="http://ww2.sinaimg.cn/large/006tNbRwly1ffalfnmhudj30z007kab7.jpg" alt="">æƒ³åˆ é™¤ä¹Ÿå¾ˆå®¹æ˜“ï¼Œç›´æ¥åˆ é™¤è¿™ä¸ªæ–‡ä»¶å³å¯ã€‚</p>
<p>å…¶å®è¿™ä¸ª<strong>è¶…å¾®å‹ç®€å•æ–¹ä¾¿æ˜“ç”¨æ•°æ®åº“</strong>è¿˜å¯ä»¥å®ç°å¥½å¤šåŠŸèƒ½ï¼Œçœ‹ä½ æ€ä¹ˆæ“ä½œäº†ã€‚å¦‚æœä½ çš„Appæ²¡æœ‰åå°ï¼Œä¸åŒç”¨æˆ·çš„ä¸»é¢˜è®¾ç½®ã€è¯­è¨€è®¾ç½®å¯èƒ½ä¸åŒï¼Œéƒ½å¯ä»¥é€šè¿‡è¿™ä¸ªæ¥å­˜å‚¨ã€‚</p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>å…¶å®å¾ˆå¤šæˆ‘ä»¬å¾ˆå¸¸ç”¨çš„ä¸œè¥¿éƒ½æœ‰å¾ˆå¤šæˆ‘ä»¬æœªå‘æ˜å‡ºçš„ç”¨é€”ï¼Œç”Ÿæ´»ä¹Ÿæ˜¯åŒæ ·ï¼Œå­¦ä¼šå‘ç°ï¼Œä¸€åˆ‡ä¼šæ›´ç¾å¥½ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;åœ¨iOSå¼€å‘ä¸­ï¼Œæˆ‘ä»¬æ—¶å¸¸éœ€è¦ä¿å­˜ä¸€äº›æ•°æ®ï¼Œæˆ–è€…å¸Œæœ›åœ¨ç”¨æˆ·ä¸‹æ¬¡æ‰“å¼€Appæ—¶ï¼Œä¾ç„¶å¯ä»¥ä¿ç•™ä¸€äº›è®¾ç½®ç­‰ï¼Œæ¯”å¦‚&lt;strong&gt;ä¸»é¢˜è®¾ç½®&lt;/stron
    
    </summary>
    
    
      <category term="iOSæŠ€æœ¯åˆ†äº«" scheme="http://blog.darkangel7.com/tags/iOS%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"/>
    
  </entry>
  
  <entry>
    <title>åœ¨iOS Appå†…ä¼˜é›…çš„åŠ¨æ€åˆ‡æ¢è¯­è¨€</title>
    <link href="http://blog.darkangel7.com/2017/05/04/%E5%9C%A8iOSApp%E5%86%85%E4%BC%98%E9%9B%85%E7%9A%84%E5%8A%A8%E6%80%81%E5%88%87%E6%8D%A2%E8%AF%AD%E8%A8%80/"/>
    <id>http://blog.darkangel7.com/2017/05/04/åœ¨iOSAppå†…ä¼˜é›…çš„åŠ¨æ€åˆ‡æ¢è¯­è¨€/</id>
    <published>2017-05-04T03:46:56.000Z</published>
    <updated>2017-05-05T09:28:31.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>éšç€å…¬å¸ä¸šåŠ¡çš„å‘å±•ï¼ŒAppç‰ˆæœ¬çš„è¿­ä»£ï¼Œç›¸ä¿¡ä¸å°‘Appéƒ½éœ€è¦è‹±æ–‡åŒ–ï¼ˆå›½é™…åŒ–ï¼‰ã€‚Appè‹±æ–‡åŒ–ï¼Œä¸å¤–ä¹è¿™ä¸‰ç‚¹ï¼š</p>
<ol>
<li>çº¯ä»£ç ä¸­å¼•ç”¨çš„stringså›½é™…åŒ–ï¼›</li>
<li>Storyboard/Xibå›½é™…åŒ–ï¼›</li>
<li>Info.plistå›½é™…åŒ–ã€‚</li>
</ol>
<p>å…·ä½“è¿™ä¸‰ç§åˆ†åˆ«å¦‚ä½•æ“ä½œï¼Œæ€ä¹ˆå›½é™…åŒ–ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚ä¸€èˆ¬Appåšäº†å›½é™…åŒ–ï¼Œé‚£ä¹ˆåœ¨ç”¨æˆ·åˆ‡æ¢æ‰‹æœºç³»ç»ŸSettingsé‡Œçš„Languageæ—¶ï¼ŒAppå°±ä¼šåˆ‡æ¢æˆå¯¹åº”çš„è¯­è¨€ï¼ˆå‰ææ˜¯åšè¿‡è¯¥è¯­è¨€å›½é™…åŒ–ï¼‰ã€‚é‚£ä¹ˆå¦‚æœæƒ³å®ç°<strong>å¾®åš</strong>å’Œ<strong>å¾®ä¿¡</strong>ç­‰Appï¼Œåœ¨Appå†…éƒ¨å®ç°åˆ‡æ¢è¯­è¨€ï¼Œåº”è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿå¦‚ä½•åšï¼Œæ‰èƒ½æ›´åŠ ä¼˜é›…çš„åŠ¨æ€åˆ‡æ¢è¯­è¨€å‘¢ï¼Ÿ</p>
<p>ä¸‹é¢ï¼Œè®²ä¸€è®²å¦‚ä½•åœ¨iOS Appå†…ä¼˜é›…çš„åŠ¨æ€åˆ‡æ¢è¯­è¨€ã€‚</p>
<h1 id="è°ƒç ”"><a href="#è°ƒç ”" class="headerlink" title="è°ƒç ”"></a>è°ƒç ”</h1><p>å¦‚æœæœ‰ç›¸å…³éœ€æ±‚ï¼Œä¸€èˆ¬æˆç†Ÿçš„Appéƒ½ä¼šæ€ä¹ˆåšå‘¢ï¼Ÿè¿™é‡Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹<strong>å¾®åš</strong>å’Œ<strong>å¾®ä¿¡</strong>ã€‚</p>
<p><strong>å¾®åš</strong>ï¼š</p>
<p><img src="http://ww3.sinaimg.cn/large/006tKfTcly1ff9jfo5a8ig306y0cctz0.gif" alt=""></p>
<p><strong>å¾®ä¿¡</strong>ï¼š</p>
<p><img src="http://ww1.sinaimg.cn/large/006tKfTcly1ff9d5ezj9jg30680b3kif.gif" alt=""></p>
<p>å¯¹æ¯”ä¸€ä¸‹å¯ä»¥çœ‹å‡ºï¼Œå¾®åšæ•´ä½“çš„æ•ˆæœæ¯”å¾®ä¿¡å¥½å¾ˆå¤šï¼Œä¸æ»‘æµç•…ã€‚</p>
<p><strong><em>è¿™é‡Œæ³¨æ„ä¸€ä¸‹ç»†èŠ‚</em></strong>ï¼šæˆ‘åœ¨å¾®åšçš„ä¸ªäººä¸­å¿ƒæ˜¯æ•…æ„ä¸Šæ»‘äº†ä¸€ä¸‹ï¼Œç„¶åç‚¹å‡»è¿›å…¥è®¾ç½®ï¼Œè¿›è¡Œè¯­è¨€åˆ‡æ¢ï¼Œå¯ä»¥çœ‹åˆ°åˆ‡æ¢æ—¶å¾ˆè‡ªç„¶ï¼Œç„¶åè¿”å›ä¸ªäººä¸­å¿ƒæ—¶ï¼Œé¡µé¢<code>scrollView</code>çš„<code>contentOffset</code>å¹¶æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œç”±æ­¤å¯ä»¥æ¨æµ‹ï¼š</p>
<p><strong><u>å¾®åšçš„æ€è·¯æ˜¯ï¼Œåœ¨åˆ‡æ¢è¯­è¨€æ—¶ï¼Œå‘é€é€šçŸ¥<code>NSNotification</code>ï¼Œæ‰€æœ‰çš„UIæ§ä»¶ç›‘å¬é€šçŸ¥ï¼Œç„¶ååœ¨é€‚å½“çš„æ—¶å€™åˆ·æ–°UI</u></strong>ã€‚é‚£ä¹ˆå…¶å®è¿™ä¹ˆå†™ï¼Œéœ€è¦åšçš„ä¸œè¥¿å¾ˆå¤šï¼Œæˆ–æ˜¯é€šè¿‡Baseç±»æ¥å®ç°ï¼Œæˆ–æ˜¯é€šè¿‡<code>runtime</code>å®ç°ï¼Œæ€»ä¹‹<code>Button</code>ã€<code>Label</code>ã€<code>TextField</code>ç­‰ç­‰éƒ½éœ€è¦æœ‰ä¸€å¥—ç»Ÿä¸€çš„æ›´æ–°æœºåˆ¶ï¼Œå¯èƒ½ä¸æ˜¯ä¸€ä¸ªæœ€ç®€å•çš„åŠæ³•ã€‚</p>
<p><strong><u>è€Œå¾®ä¿¡åˆ‡æ¢çš„æ–¹æ¡ˆæ˜¯ï¼Œåˆ·æ–°<code>keyWindow</code>çš„<code>rootViewController</code>ï¼Œç„¶åè·³è½¬åˆ°è®¾ç½®é¡µï¼Œæ‰€ä»¥ä½ ä¼šçœ‹åˆ°åˆ‡æ¢è¯­è¨€çš„ä¸€ç¬é—´ç•Œé¢å‡ºç°åŒªå¤·æ‰€æ€çš„bugï¼Œå¦‚ä¸‹å›¾</u></strong></p>
<p><img src="http://ww1.sinaimg.cn/large/006tKfTcly1ff9iduf60aj306y0cbjrm.jpg" alt=""></p>
<p>å…¶å®å¾®ä¿¡çš„æ–¹æ¡ˆæ˜¯ä¸ªæœ€ç®€å•çš„æ–¹æ¡ˆï¼Œåªä¸è¿‡æ²¡æœ‰å¤„ç†å¥½è¿™ä¸ªå°ç³»ç»Ÿbugã€‚</p>
<h1 id="æ–¹æ¡ˆ"><a href="#æ–¹æ¡ˆ" class="headerlink" title="æ–¹æ¡ˆ"></a>æ–¹æ¡ˆ</h1><h2 id="æ ¸å¿ƒæ–¹æ³•"><a href="#æ ¸å¿ƒæ–¹æ³•" class="headerlink" title="æ ¸å¿ƒæ–¹æ³•"></a>æ ¸å¿ƒæ–¹æ³•</h2><h3 id="NSBundle"><a href="#NSBundle" class="headerlink" title="NSBundle"></a>NSBundle</h3><p>å…¶å®å¤§å®¶åº”è¯¥çŸ¥é“ï¼Œæ— è®ºæ˜¯ä»£ç è¿˜æ˜¯Storyboard/Xibï¼Œæ˜¾ç¤ºçš„å›½é™…åŒ–å­—ç¬¦ä¸²éƒ½ä¼šèµ°è¿™ä¸ªæ–¹æ³•ï¼Œä¼ å…¥ä¸€ä¸ª<code>key</code>ï¼Œè·å–<code>localizedString</code>ã€‚</p>
<p><code>NSBundle</code>çš„æ–¹æ³•ï¼š</p>
<pre><code class="objective-c">- (NSString *)localizedStringForKey:(NSString *)key value:(nullable NSString *)value table:(nullable NSString *)tableName;
</code></pre>
<p>æ¯”å¦‚æˆ‘ä»¬å¸¸ç”¨çš„å®<code>NSLocalizedString(@&quot;done&quot;, nil)</code></p>
<pre><code class="objective-c">#define NSLocalizedString(key, comment) \
        [NSBundle.mainBundle localizedStringForKey:(key) value:@&quot;&quot; table:nil]
</code></pre>
<p>é‚£ä¹ˆä¸ºä½•ï¼Œç³»ç»Ÿåˆ‡æ¢è¯­è¨€çš„æ—¶å€™ï¼Œæ­¤æ–¹æ³•è¿”å›çš„å°±æ˜¯å¯¹åº”è¯­è¨€ï¼ˆå‰æåšäº†è¯¥è¯­è¨€çš„å›½é™…åŒ–ï¼‰çš„å­—ç¬¦ä¸²å‘¢ï¼ŸåŸå› åœ¨æ˜¯å“ªä¸ª<code>bundle</code>è°ƒç”¨äº†è¿™ä¸ªæ–¹æ³•ï¼Œä¸€èˆ¬é»˜è®¤çš„éƒ½æ˜¯<code>NSBundle.mainBundle</code>è¿™ä¸ªå¯¹è±¡ã€‚</p>
<pre><code> po [NSBundle allBundles]

&lt;__NSArrayI 0x608000052f60&gt;(
NSBundle &lt;/Users/DarkAngel/Library/Developer/CoreSimulator/Devices/CF831783-E4A6-4EC2-AB99-E04304331C3A/data/Containers/Bundle/Application/B391ED77-F57B-4B5E-9E53-CFD1245583D8/LanguageSettingsDemo.app/en.lproj&gt; (not yet loaded),
NSBundle &lt;/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator.sdk/System/Library/Frameworks/UIKit.framework/Artwork.bundle&gt; (not yet loaded),
DABundle &lt;/Users/DarkAngel/Library/Developer/CoreSimulator/Devices/CF831783-E4A6-4EC2-AB99-E04304331C3A/data/Containers/Bundle/Application/B391ED77-F57B-4B5E-9E53-CFD1245583D8/LanguageSettingsDemo.app&gt; (loaded)
)
</code></pre><p>å¯ä»¥çœ‹åˆ°æœ‰é»˜è®¤åŠ è½½çš„bundleï¼Œè¿˜æœ‰ä¸ªæ²¡åŠ è½½çš„en bundleã€‚æ‰€ä»¥ï¼Œåˆ‡æ¢è¯­è¨€ï¼Œå…¶å®åªè¦åˆ‡æ¢äº†<code>bundle</code>å¯¹è±¡ï¼Œå°±å¯ä»¥è®©è¿™ä¸ª<code>bundle</code>æ ¹æ®<code>key</code>è¿”å›ä¸åŒçš„<code>localizedString</code>ã€‚</p>
<h3 id="NSUserDefaults"><a href="#NSUserDefaults" class="headerlink" title="NSUserDefaults"></a>NSUserDefaults</h3><p>å…¶å®è¯­è¨€è®¾ç½®ï¼Œåªè¦ä¿®æ”¹<code>AppleLanguages</code>å¯¹åº”çš„å€¼å°±å¥½äº†ã€‚è¿™æ ·æ‰èƒ½åŠ è½½æ­£ç¡®è¯­è¨€çš„<code>Storyboard/Xib</code>ï¼Œä»¥åŠä¸€äº›<code>resources</code>(å›¾ç‰‡ä¹‹ç±»çš„)ã€‚</p>
<h2 id="å®ç°æ€è·¯"><a href="#å®ç°æ€è·¯" class="headerlink" title="å®ç°æ€è·¯"></a>å®ç°æ€è·¯</h2><p>æ–¹æ¡ˆå…¶å®å¾ˆç®€å•ï¼Œæ¯æ¬¡åˆ‡æ¢è¯­è¨€ï¼ŒæŠŠç”¨æˆ·é€‰æ‹©çš„è¯­è¨€ä¿å­˜åœ¨æœ¬åœ°ï¼ŒåŒæ—¶æ›´æ”¹<code>bundle</code>å¯¹è±¡ï¼Œç„¶ååˆ·æ–°é¡µé¢å°±å¯ä»¥äº†ã€‚</p>
<p><img src="http://ww2.sinaimg.cn/large/006tKfTcly1ff9ji4gz3kg306y0cce09.gif" alt=""></p>
<h2 id="æŠ€æœ¯ç»†èŠ‚"><a href="#æŠ€æœ¯ç»†èŠ‚" class="headerlink" title="æŠ€æœ¯ç»†èŠ‚"></a>æŠ€æœ¯ç»†èŠ‚</h2><h3 id="ä¿å­˜ç”¨æˆ·è®¾ç½®"><a href="#ä¿å­˜ç”¨æˆ·è®¾ç½®" class="headerlink" title="ä¿å­˜ç”¨æˆ·è®¾ç½®"></a>ä¿å­˜ç”¨æˆ·è®¾ç½®</h3><p>å¾ˆç®€å•ï¼Œä¿å­˜åœ¨<code>NSUserDefaults</code>é‡Œã€‚</p>
<p>è¿™é‡Œéœ€è¦è¯´æ˜çš„æ˜¯<strong>è·Ÿéšæ‰‹æœºç³»ç»Ÿ</strong>ï¼Œå³æ¸…é™¤ç”¨æˆ·è‡ªå®šä¹‰è®¾ç½®ï¼Œåªéœ€è¦å°†<code>AppleLanguages</code>å­—æ®µè®¾ä¸º<code>nil</code>å³å¯ã€‚</p>
<p>ä½†æ˜¯å½“<code>AppleLanguages</code>å­—æ®µè®¾ä¸ºnilï¼Œä½ å†å»è·å–å®ƒçš„å€¼æ—¶ï¼Œä¼šå‘ç°ä»–å·²ç»å˜æˆäº†ç³»ç»Ÿè¯­è¨€çš„é»˜è®¤å€¼ã€‚è¿™é‡Œå¯ä»¥å‚è€ƒ<a href="http://blog.darkangel7.com/2017/05/05/iOSä¸­NSUserDefaultsçš„é»‘ç§‘æŠ€/">è¿™ç¯‡æ–‡ç« </a>ã€‚</p>
<p>.h</p>
<pre><code class="objective-c">/**
 è®¾ç½®ç±»
 */
@interface UWConfig : NSObject
/**
 ç”¨æˆ·è‡ªå®šä¹‰ä½¿ç”¨çš„è¯­è¨€ï¼Œå½“ä¼ nilæ—¶ï¼Œç­‰åŒäºresetSystemLanguage
 */
@property (class, nonatomic, strong, nullable) NSString *userLanguage;
/**
 é‡ç½®ç³»ç»Ÿè¯­è¨€
 */
+ (void)resetSystemLanguage;
@end
</code></pre>
<p>.m</p>
<pre><code class="objective-c">#import &quot;UWConfig.h&quot;

static NSString *const UWUserLanguageKey = @&quot;UWUserLanguageKey&quot;;
#define STANDARD_USER_DEFAULT  [NSUserDefaults standardUserDefaults]

@implementation UWConfig
+ (void)setUserLanguage:(NSString *)userLanguage
{
    //è·Ÿéšæ‰‹æœºç³»ç»Ÿ
    if (!userLanguage.length) {
        [self resetSystemLanguage];
        return;
    }
    //ç”¨æˆ·è‡ªå®šä¹‰
    [STANDARD_USER_DEFAULT setValue:userLanguage forKey:UWUserLanguageKey];
    [STANDARD_USER_DEFAULT setValue:@[userLanguage] forKey:@&quot;AppleLanguages&quot;];
    [STANDARD_USER_DEFAULT synchronize];
}

+ (NSString *)userLanguage
{
    return [STANDARD_USER_DEFAULT valueForKey:UWUserLanguageKey];
}

/**
 é‡ç½®ç³»ç»Ÿè¯­è¨€
 */
+ (void)resetSystemLanguage
{
    [STANDARD_USER_DEFAULT removeObjectForKey:UWUserLanguageKey];
    [STANDARD_USER_DEFAULT setValue:nil forKey:@&quot;AppleLanguages&quot;];
    [STANDARD_USER_DEFAULT synchronize];
}

@end
</code></pre>
<p>åœ¨éœ€è¦çš„åœ°æ–¹è°ƒç”¨å³å¯ï¼Œå¦‚</p>
<pre><code class="objective-c">   if (indexPath.row == 0) {
        [UWConfig setUserLanguage:nil];
    } else if (indexPath.row == 1) {
        [UWConfig setUserLanguage:@&quot;zh-Hans&quot;];
    } else {
        [UWConfig setUserLanguage:@&quot;en&quot;];
    }
</code></pre>
<h3 id="åˆ‡æ¢Bundle"><a href="#åˆ‡æ¢Bundle" class="headerlink" title="åˆ‡æ¢Bundle"></a>åˆ‡æ¢Bundle</h3><p>å½“éœ€è¦å±•ç¤ºå†…å®¹æ—¶ï¼Œæ‰éœ€è¦ç”¨åˆ°<code>bundle</code>ï¼Œæˆ‘ä»¬è¦æ‰‹åŠ¨åˆ‡æ¢<code>bundle</code>å¯¹è±¡ï¼Œå°±ç”¨åˆ°äº†è¿™å‡ ä¸ªæ–¹æ³•ï¼š</p>
<pre><code class="objective-c">+ (nullable instancetype)bundleWithPath:(NSString *)path;
- (nullable instancetype)initWithPath:(NSString *)path NS_DESIGNATED_INITIALIZER;

+ (nullable instancetype)bundleWithURL:(NSURL *)url NS_AVAILABLE(10_6, 4_0);
- (nullable instancetype)initWithURL:(NSURL *)url NS_AVAILABLE(10_6, 4_0);
</code></pre>
<p>è¿™é‡Œç›´æ¥ä¸Šä»£ç </p>
<p>.h</p>
<pre><code class="objective-c">@interface NSBundle (UWUtils)

+ (BOOL)isChineseLanguage;

+ (NSString *)currentLanguage;

@end
</code></pre>
<p>.m</p>
<pre><code class="objective-c">#import &quot;NSBundle+UWUtils.h&quot;

@interface UWBundle : NSBundle

@end

@implementation NSBundle (UWUtils)

+ (BOOL)isChineseLanguage
{
    NSString *currentLanguage = [self currentLanguage];
    if ([currentLanguage hasPrefix:@&quot;zh-Hans&quot;]) {
        return YES;
    } else {
        return NO;
    }
}

+ (NSString *)currentLanguage
{
    return [UWConfig userLanguage] ? : [NSLocale preferredLanguages].firstObject;
}

+ (void)load
{
    static dispatch_once_t onceToken;
    dispatch_once(&amp;onceToken, ^{
        //åŠ¨æ€ç»§æ‰¿ã€äº¤æ¢ï¼Œæ–¹æ³•ç±»ä¼¼KVOï¼Œé€šè¿‡ä¿®æ”¹[NSBundle mainBundle]å¯¹è±¡çš„isaæŒ‡é’ˆï¼Œä½¿å…¶æŒ‡å‘å®ƒçš„å­ç±»UWBundleï¼Œè¿™æ ·ä¾¿å¯ä»¥è°ƒç”¨å­ç±»çš„æ–¹æ³•ï¼›å…¶å®è¿™é‡Œä¹Ÿå¯ä»¥ä½¿ç”¨method_swizzlingæ¥äº¤æ¢mainBundleçš„å®ç°ï¼Œæ¥åŠ¨æ€åˆ¤æ–­ï¼Œå¯ä»¥åŒæ ·å®ç°ã€‚
        object_setClass([NSBundle mainBundle], [UWBundle class]);
    });
}

@end

@implementation UWBundle

- (NSString *)localizedStringForKey:(NSString *)key value:(NSString *)value table:(NSString *)tableName
{
    if ([UWBundle uw_mainBundle]) {
        return [[UWBundle uw_mainBundle] localizedStringForKey:key value:value table:tableName];
    } else {
        return [super localizedStringForKey:key value:value table:tableName];
    }
}

+ (NSBundle *)uw_mainBundle
{
    if ([NSBundle currentLanguage].length) {
        NSString *path = [[NSBundle mainBundle] pathForResource:[NSBundle currentLanguage] ofType:@&quot;lproj&quot;];
        if (path.length) {
            return [NSBundle bundleWithPath:path];
        }
    }
    return nil;
}

@end
</code></pre>
<p>è¿™é‡Œæ¶‰åŠåˆ°äº†<code>runtime</code>çš„ä½¿ç”¨ï¼Œä»£ç ä¸­æœ‰æ³¨é‡Šï¼Œè¿™é‡Œå°±ä¸å±•å¼€äº†ã€‚</p>
<h3 id="åˆ·æ–°é¡µé¢"><a href="#åˆ·æ–°é¡µé¢" class="headerlink" title="åˆ·æ–°é¡µé¢"></a>åˆ·æ–°é¡µé¢</h3><p>ç”¨å¾®ä¿¡çš„æ€è·¯ï¼Œç®€å•åŒ–ï¼Œä¸å¿…è¦å¤„ç†å¾ˆå¤šï¼Œæˆ‘ä»¬åªè¦æ›¿æ¢<code>keyWindow</code>çš„<code>rootViewController</code>å°±å¥½ï¼ŒåŒæ—¶è§£å†³å¾®ä¿¡çš„bugã€‚</p>
<pre><code class="objective-c">    UITabBarController *tbc = [[UIStoryboard storyboardWithName:@&quot;Main&quot; bundle:[NSBundle mainBundle]] instantiateInitialViewController];
    //æˆ‘è¿™é‡Œçš„storyboardä¸ºäº†ä¾¿äºå¤šäººåˆä½œï¼Œè¿™é‡ŒåªåŒ…å«æ ¹tabBarControllerå’Œå¤šä¸ªnvcï¼Œæ¯ä¸ªnvcåªæœ‰è‡ªå·±çš„rootViewController
    //è·³è½¬åˆ°ä¸ªäººä¸­å¿ƒ
    tbc.selectedIndex = 4;
    //åˆ›å»ºè®¾ç½®é¡µé¢
    UWSettingViewController *vc1 = [[UIStoryboard storyboardWithName:@&quot;Main&quot; bundle:[NSBundle mainBundle]] instantiateViewControllerWithIdentifier:NSStringFromClass([UWSettingViewController class])];
    vc1.hidesBottomBarWhenPushed = YES;
    //åˆ›å»ºè¯­è¨€åˆ‡æ¢é¡µ
    UWLanguageSettingsViewController *vc2 = [[UIStoryboard storyboardWithName:@&quot;Main&quot; bundle:[NSBundle mainBundle]] instantiateViewControllerWithIdentifier:NSStringFromClass([UWLanguageSettingsViewController class])];
    vc2.hidesBottomBarWhenPushed = YES;
    UINavigationController *nvc = tbc.selectedViewController;
    //å¤‡ç”¨
    NSMutableArray *vcs = nvc.viewControllers.mutableCopy;
    [vcs addObjectsFromArray:@[vc1, vc2]];
    //è§£å†³å¥‡æ€ªçš„åŠ¨ç”»bugã€‚å¼‚æ­¥æ‰§è¡Œ
    dispatch_async(dispatch_get_main_queue(), ^{
        //æ³¨æ„åˆ·æ–°rootViewControllerçš„æ—¶æœºï¼Œåœ¨ä¸»çº¿ç¨‹å¼‚æ­¥æ‰§è¡Œ
        //å…ˆåˆ·æ–°rootViewController
        [UIApplication sharedApplication].keyWindow.rootViewController = tbc;
        //ç„¶åå†ç»™ä¸ªäººä¸­å¿ƒçš„nvcè®¾ç½®viewControllers
        nvc.viewControllers = vcs;
        //ä¸€äº›UIæç¤ºï¼Œå¯ä»¥æä¾›æ›´å‹å¥½çš„ç”¨æˆ·äº¤äº’ï¼ˆä¹Ÿå¯ä»¥åˆ æ‰ï¼‰
        [UWProgressHUD showLoadingWithMessage:NSLocalizedString(UWSettingMessage, nil)];
        dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(.5 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^{
            [UWProgressHUD dismiss];
        });
    });
</code></pre>
<p>æ•´ä½“ä¸‹æ¥ï¼Œå°±å¯ä»¥å®ç°åœ¨Appå†…ä¼˜é›…çš„åˆ‡æ¢è¯­è¨€ã€‚</p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>å…¶å®åœ¨å®è·µè¿‡ç¨‹ä¸­ï¼Œå‘è¿˜æ˜¯å¾ˆå¤šçš„ï¼Œæ¬¢è¿æé—®ã€‚</p>
<p>ä¸‹é¢é™„ä¸Šä¸ªç®€å•çš„<a href="https://github.com/DarkAngel7/Demos-LanguageSettingsDemo/" target="_blank" rel="external">Demo</a>ï¼Œæ˜¯ä¸Šé¢è¯´çš„ç®€åŒ–ç‰ˆæœ¬ï¼Œå¤§å®¶æœ‰éœ€è¦å¯ä»¥ä¸‹è½½çœ‹ä¸‹ã€‚é‡Œé¢æœ‰å°ç¦åˆ©å“¦ï¼Œæ…¢æ…¢æ‰¾å§~</p>
<p>æœ€åï¼Œ<a href="https://itunes.apple.com/cn/app/you-ke-gong-chang/id1034170822?mt=8" target="_blank" rel="external">ä¼˜å®¢å·¥åœº</a>æ¬¢è¿æ‚¨ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;éšç€å…¬å¸ä¸šåŠ¡çš„å‘å±•ï¼ŒAppç‰ˆæœ¬çš„è¿­ä»£ï¼Œç›¸ä¿¡ä¸å°‘Appéƒ½éœ€è¦è‹±æ–‡åŒ–ï¼ˆå›½é™…åŒ–ï¼‰ã€‚Appè‹±æ–‡åŒ–ï¼Œä¸å¤–ä¹è¿™ä¸‰ç‚¹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;çº¯ä»£ç ä¸­
    
    </summary>
    
    
      <category term="iOSæŠ€æœ¯åˆ†äº«" scheme="http://blog.darkangel7.com/tags/iOS%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"/>
    
  </entry>
  
  <entry>
    <title>Jenkinséƒ¨ç½²MacOS Slaveå®ç°æŒç»­é›†æˆ(iOS)</title>
    <link href="http://blog.darkangel7.com/2017/04/28/Jenkins%E9%83%A8%E7%BD%B2MacOS%20Slave%E5%AE%9E%E7%8E%B0%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90(iOS)/"/>
    <id>http://blog.darkangel7.com/2017/04/28/Jenkinséƒ¨ç½²MacOS Slaveå®ç°æŒç»­é›†æˆ(iOS)/</id>
    <published>2017-04-28T10:49:16.000Z</published>
    <updated>2017-05-04T04:30:05.000Z</updated>
    
    <content type="html"><![CDATA[<p>è§£å†³LinuxæœåŠ¡å™¨ä¸Šçš„Jenkinsæ— æ³•æ„å»ºXcodeå·¥ç¨‹</p>
<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ç”±äºLinuxæœåŠ¡å™¨æ— æ³•å®‰è£…Xcodeï¼Œæ‰€ä»¥Jenkinsæ— æ³•é€šè¿‡shellæ¥è°ƒç”¨xcodebuildã€xcrunç­‰å‘½ä»¤æ¥æ„å»ºXcodeå·¥ç¨‹ï¼Œå› æ­¤æ— æ³•æŒç»­é›†æˆï¼Œæ•æ·å¼€å‘ã€‚ä¸‹é¢ä»‹ç»ä¸€ç§é…ç½®JenkinsèŠ‚ç‚¹çš„æ–¹å¼ï¼Œæ¥å®ç°Linuxä¸Šçš„Jenkinsæ„å»ºXcodeå·¥ç¨‹ï¼Œå¹¶ä¸Šä¼ ipaåˆ°è’²å…¬è‹±pgyeræ¥è¿›è¡Œæµ‹è¯•ã€‚</p>
<h2 id="ä¸€ã€é…ç½®MacOS-Slave"><a href="#ä¸€ã€é…ç½®MacOS-Slave" class="headerlink" title="ä¸€ã€é…ç½®MacOS Slave"></a>ä¸€ã€é…ç½®MacOS Slave</h2><p>Jenkinsæœ‰ä¸ªå¼ºå¤§çš„åŠŸèƒ½ï¼Œé…ç½®Slave(å¥´éš¶)æœåŠ¡å™¨ï¼Œæ¥å®ç°åˆ†å¸ƒå¼éƒ¨ç½²æ„å»ºã€‚å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<h3 id="1-é…ç½®Macç”µè„‘ã€‚"><a href="#1-é…ç½®Macç”µè„‘ã€‚" class="headerlink" title="1. é…ç½®Macç”µè„‘ã€‚"></a>1. é…ç½®Macç”µè„‘ã€‚</h3><p>åœ¨<strong>ç³»ç»Ÿåå¥½è®¾ç½®</strong> &gt; <strong>å…±äº«</strong> ä¸­å¼€å¯ <strong>è¿œç¨‹ç™»å½•</strong>ï¼Œå¦‚ä¸‹å›¾ï¼š<br><img src="https://ww3.sinaimg.cn/large/006tNc79ly1ff2hls2iauj31140tidjg.jpg" alt=""> </p>
<h3 id="2-åˆ›å»ºèŠ‚ç‚¹ã€‚"><a href="#2-åˆ›å»ºèŠ‚ç‚¹ã€‚" class="headerlink" title="2. åˆ›å»ºèŠ‚ç‚¹ã€‚"></a>2. åˆ›å»ºèŠ‚ç‚¹ã€‚</h3><p>Jenkins &gt; ç³»ç»Ÿç®¡ç† &gt;  ç®¡ç†èŠ‚ç‚¹ &gt; æ–°å»ºèŠ‚ç‚¹ï¼Œè¾“å…¥èŠ‚ç‚¹åç§°ï¼Œè®°å¾—å‹¾é€‰ <code>Permanent Agent</code>ï¼Œç‚¹å‡»OKã€‚</p>
<h3 id="3-é…ç½®èŠ‚ç‚¹ã€‚"><a href="#3-é…ç½®èŠ‚ç‚¹ã€‚" class="headerlink" title="3. é…ç½®èŠ‚ç‚¹ã€‚"></a>3. é…ç½®èŠ‚ç‚¹ã€‚</h3><p><img src="https://ww2.sinaimg.cn/large/006tNc79ly1ff2hfwxx8ej31eg0ts0wt.jpg" alt="">å…¶ä¸­è¦ä¿è¯<code>/User/Shared/Jenkins/</code>ç›®å½•çš„æƒé™ä¸ºsshé“¾æ¥çš„ç”¨æˆ·å¯è¯»å†™ã€‚</p>
<p>Hostæ˜¯Macçš„ipåœ°å€ï¼ŒCredentialsæ˜¯sshç™»å½•Macæ—¶éœ€è¦çš„è´¦æˆ·å’Œå¯†ç ã€‚å¯ä»¥æ·»åŠ ä¸€ä¸ª</p>
<p><img src="https://ww4.sinaimg.cn/large/006tNc79ly1ff2hhcg0f1j31gq0r842o.jpg" alt=""></p>
<p><strong>ä¸‹é¢çš„éƒ¨åˆ†å¾ˆé‡è¦</strong>ï¼š<img src="https://ww2.sinaimg.cn/large/006tNc79ly1ff2hiwj7mpj31gs0p4dj8.jpg" alt=""></p>
<p>PATHç¯å¢ƒå˜é‡ï¼Œéœ€è¦åœ¨Macä¸Šé€šè¿‡</p>
<pre><code>echo $PATH
/opt/iOSOpenDev/bin:/opt/local/bin:/opt/local/sbin:/opt/local/bin:/opt/local/sbin:/opt/local/bin:/opt/local/sbin:/opt/local/bin:/opt/local/sbin:/opt/local/bin:/opt/local/sbin:/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin:/opt/local/bin:/opt/local/sbin/
</code></pre><p>è·å–ï¼Œç„¶åcopyè¿‡å»ã€‚</p>
<p>Keychains and Provisioning Profilesè·¯å¾„è¦å¡«å†™æ­£ç¡®ã€‚æ²¡æœ‰è¿™ä¸ªé€‰é¡¹çš„å®‰è£…<a href="http://wiki.jenkins-ci.org/display/JENKINS/Keychains+and+Provisioning+Profiles+Plugin" target="_blank" rel="external">Keychains and Provisioning Profiles Management</a>æ’ä»¶ã€‚</p>
<h3 id="4-æœ€åä¿å­˜ã€‚"><a href="#4-æœ€åä¿å­˜ã€‚" class="headerlink" title="4. æœ€åä¿å­˜ã€‚"></a>4. æœ€åä¿å­˜ã€‚</h3><p>å¦‚æœçœ‹åˆ°</p>
<p><img src="https://ww2.sinaimg.cn/large/006tNc79ly1ff2hwlrqw8j30e203uglm.jpg" alt=""></p>
<p>å³æ·»åŠ Mac SlaveæˆåŠŸï¼Œä¸”Mac Slaveåœ¨çº¿ã€‚è‹¥è¿ä¸ä¸Šï¼Œè¯·åå¤ç¡®è®¤<strong>è¿œç¨‹å·¥ä½œç›®å½•</strong>çš„æƒé™ã€‚</p>
<h2 id="äºŒã€é…ç½®Jenkinsç³»ç»Ÿè®¾ç½®ã€‚"><a href="#äºŒã€é…ç½®Jenkinsç³»ç»Ÿè®¾ç½®ã€‚" class="headerlink" title="äºŒã€é…ç½®Jenkinsç³»ç»Ÿè®¾ç½®ã€‚"></a>äºŒã€é…ç½®Jenkinsç³»ç»Ÿè®¾ç½®ã€‚</h2><h3 id="1-ä¸Šä¼ è¯ä¹¦å’Œæè¿°æ–‡ä»¶ã€‚"><a href="#1-ä¸Šä¼ è¯ä¹¦å’Œæè¿°æ–‡ä»¶ã€‚" class="headerlink" title="1. ä¸Šä¼ è¯ä¹¦å’Œæè¿°æ–‡ä»¶ã€‚"></a>1. ä¸Šä¼ è¯ä¹¦å’Œæè¿°æ–‡ä»¶ã€‚</h3><p>åœ¨ <strong>Jenkins</strong> &gt; <strong>ç³»ç»Ÿç®¡ç†</strong> &gt; <strong>Keychains and Provisioning Profiles Management</strong>ä¸­ä¸Šä¼ æ‰“åŒ…ç”¨çš„è¯ä¹¦å’Œæè¿°æ–‡ä»¶ã€‚å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="https://ww4.sinaimg.cn/large/006tNc79ly1ff2jcabj18j31kw0tijyh.jpg" alt=""></p>
<p><img src="https://ww2.sinaimg.cn/large/006tNc79ly1ff2jclndwnj31jy0siwic.jpg" alt=""></p>
<p>ä¿å­˜ã€‚</p>
<h3 id="2-åœ¨-Jenkins-gt-ç³»ç»Ÿç®¡ç†-gt-ç³»ç»Ÿè®¾ç½®ï¼ˆå…¨å±€è®¾ç½®ï¼‰ä¸­è®¾ç½®ï¼š"><a href="#2-åœ¨-Jenkins-gt-ç³»ç»Ÿç®¡ç†-gt-ç³»ç»Ÿè®¾ç½®ï¼ˆå…¨å±€è®¾ç½®ï¼‰ä¸­è®¾ç½®ï¼š" class="headerlink" title="2. åœ¨ Jenkins &gt; ç³»ç»Ÿç®¡ç† &gt; ç³»ç»Ÿè®¾ç½®ï¼ˆå…¨å±€è®¾ç½®ï¼‰ä¸­è®¾ç½®ï¼š"></a>2. åœ¨ <strong>Jenkins</strong> &gt; <strong>ç³»ç»Ÿç®¡ç†</strong> &gt; <strong>ç³»ç»Ÿè®¾ç½®</strong>ï¼ˆå…¨å±€è®¾ç½®ï¼‰ä¸­è®¾ç½®ï¼š</h3><p><img src="https://ww1.sinaimg.cn/large/006tNc79ly1ff2j6764qgj31ei0t6adx.jpg" alt=""></p>
<p>å¾ˆå…³é”®ã€‚<strong>Keychain</strong>çš„è·¯å¾„å’Œå¯†ç éœ€è¦å¡«å†™Macä¸­ç™»å½•ç”¨æˆ·çš„å¯†ç ã€‚</p>
<h3 id="3-åœ¨-Jenkins-gt-ç³»ç»Ÿç®¡ç†-gt-Configure-Global-Security-ä¸­é…ç½®ï¼š"><a href="#3-åœ¨-Jenkins-gt-ç³»ç»Ÿç®¡ç†-gt-Configure-Global-Security-ä¸­é…ç½®ï¼š" class="headerlink" title="3. åœ¨ Jenkins &gt; ç³»ç»Ÿç®¡ç† &gt; Configure Global Security ä¸­é…ç½®ï¼š"></a>3. åœ¨ <strong>Jenkins</strong> &gt; <strong>ç³»ç»Ÿç®¡ç†</strong> &gt; <strong>Configure Global Security</strong> ä¸­é…ç½®ï¼š</h3><p><img src="https://ww2.sinaimg.cn/large/006tNc79ly1ff2j8ffcsrj31jw0ckjt4.jpg" alt=""></p>
<p>å¼€å¯Safe HTMLã€‚</p>
<h2 id="ä¸‰ã€é…ç½®iOSé¡¹ç›®ã€‚"><a href="#ä¸‰ã€é…ç½®iOSé¡¹ç›®ã€‚" class="headerlink" title="ä¸‰ã€é…ç½®iOSé¡¹ç›®ã€‚"></a>ä¸‰ã€é…ç½®iOSé¡¹ç›®ã€‚</h2><h3 id="1-å®‰è£…æ’ä»¶ã€‚"><a href="#1-å®‰è£…æ’ä»¶ã€‚" class="headerlink" title="1. å®‰è£…æ’ä»¶ã€‚"></a>1. å®‰è£…æ’ä»¶ã€‚</h3><p>å®‰è£… <code>build-name-setter</code>ã€<code>description setter plugin</code>æ’ä»¶ã€‚</p>
<h3 id="2-Jenkins-gt-æ–°å»ºã€‚"><a href="#2-Jenkins-gt-æ–°å»ºã€‚" class="headerlink" title="2. Jenkins &gt; æ–°å»ºã€‚"></a>2. <strong>Jenkins</strong> &gt; <strong>æ–°å»º</strong>ã€‚</h3><p><img src="https://ww2.sinaimg.cn/large/006tNc79ly1ff2iw797sjj318q0vidm6.jpg" alt=""></p>
<h3 id="3-General"><a href="#3-General" class="headerlink" title="3. General."></a>3. <strong>General</strong>.</h3><p><img src="https://ww3.sinaimg.cn/large/006tNc79ly1ff2jedt21qj31kw0u2afo.jpg" alt=""></p>
<p>è¿™é‡Œæ·»åŠ äº†å‚æ•°åŒ–æ„å»ºè¿‡ç¨‹ï¼Œä¸ºäº†åœ¨æ¯æ¬¡Buildæ—¶ï¼Œå¯ä»¥å¡«å†™æ›´æ–°è¯´æ˜ï¼Œæ‰€ä»¥è¿™é‡Œå¤©æ·»åŠ äº†åä¸º<code>News</code>çš„å‚æ•°ï¼Œå½“ç”¨æˆ·æ„å»ºæ—¶å¡«å†™äº†å†…å®¹ï¼Œå¯ä»¥åœ¨ä¹‹åçš„è„šæœ¬ä¸­é€šè¿‡<code>${News}</code>æ¥è·å–<code>News</code>çš„å€¼ã€‚</p>
<p><img src="https://ww1.sinaimg.cn/large/006tNc79ly1ff2jf005ogj31kw0o1q5k.jpg" alt=""></p>
<p>è¿™é‡ŒæŒ‡å®šMac SlaveæœåŠ¡å™¨ä½œä¸ºæ„å»ºXcodeå·¥ç¨‹çš„SlaveæœåŠ¡å™¨ï¼ŒXcodeæ‰“åŒ…æ„å»ºå…¨éƒ¨äº¤ç»™è¿™ä¸ªèŠ‚ç‚¹ï¼ˆSlaveæœåŠ¡å™¨ï¼‰æ¥å®Œæˆã€‚</p>
<p><img src="https://ww1.sinaimg.cn/large/006tNc79ly1ff2jfc0bfij31kw0d2jsv.jpg" alt=""></p>
<h3 id="4-æºç ç®¡ç†ã€‚"><a href="#4-æºç ç®¡ç†ã€‚" class="headerlink" title="4. æºç ç®¡ç†ã€‚"></a>4. æºç ç®¡ç†ã€‚</h3><p><img src="https://ww4.sinaimg.cn/large/006tNc79ly1ff2jh0iaijj31jk0uk41x.jpg" alt=""></p>
<p>è¿™é‡Œå¡«å†™æœ¬åœ°æˆ–è€…è¿œç¨‹çš„ä»£ç ä»“åº“ï¼ˆå¦‚gitlabæˆ–è€…gitï¼‰ã€‚ä¸‹é¢çš„Branchå¡«å†™æŒ‡å®šåˆ†æ”¯ã€‚</p>
<h3 id="5-æ„å»ºè§¦å‘å™¨ã€‚"><a href="#5-æ„å»ºè§¦å‘å™¨ã€‚" class="headerlink" title="5. æ„å»ºè§¦å‘å™¨ã€‚"></a>5. æ„å»ºè§¦å‘å™¨ã€‚</h3><p>è¿™é‡Œæš‚æ—¶ä¸è®¾ç½®ï¼Œè®¾ç½®äº†å¯ä»¥è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œå’Œå…¶ä»–è„šæœ¬é…åˆä½¿ç”¨ã€‚</p>
<h3 id="6-æ„å»ºç¯å¢ƒã€‚"><a href="#6-æ„å»ºç¯å¢ƒã€‚" class="headerlink" title="6. æ„å»ºç¯å¢ƒã€‚"></a>6. æ„å»ºç¯å¢ƒã€‚</h3><p><img src="https://ww1.sinaimg.cn/large/006tNc79ly1ff2jqxdzccj31kw0txq9d.jpg" alt=""></p>
<p><img src="https://ww3.sinaimg.cn/large/006tNc79ly1ff2jssknawj31kw0pnn2s.jpg" alt=""></p>
<p>æŠŠä¹‹å‰ä¸Šä¼ çš„è¯ä¹¦å’Œæè¿°æ–‡ä»¶æ·»åŠ ä¸Šã€‚</p>
<p>è®¾ç½®Buildåç§°ï¼Œè¿™é‡Œæ·»åŠ äº†è‡ªå®šä¹‰åç§°ã€‚æ³¨æ„ï¼Œé«˜çº§é‡Œé¢åªå‹¾é€‰ç¬¬ä¸€ä¸ªï¼Œä¸è¦å‹¾é€‰ <code>Set build name after build ends</code>ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚</p>
<h3 id="7-æ„å»º"><a href="#7-æ„å»º" class="headerlink" title="7. æ„å»º"></a>7. æ„å»º</h3><p><img src="https://ww2.sinaimg.cn/large/006tNc79ly1ff2jwre537j31kw0pygr0.jpg" alt=""></p>
<p>è¿™é‡Œä½¿ç”¨çš„è„šæœ¬ã€‚</p>
<pre><code>export LANG=&quot;en_US.UTF-8&quot;

security -v unlock-keychain -p &quot;yourpassword&quot;

ipa_name=&quot;URWork_iOS_beta&quot;
build_path=&quot;${WORKSPACE}/build/&quot;
fastlane gym --workspace URWorkClient.xcworkspace --scheme URWorkClient --clean --configuration Beta --export_method ad-hoc --output_name ${ipa_name} --output_directory ${build_path}

curl -F &quot;file=@${build_path}${ipa_name}.ipa&quot; \
-F &quot;uKey=yourUKey&quot; \
-F &quot;_api_key=yourApiKey&quot; \
-F &quot;updateDescription=${News}&quot; \
https://www.pgyer.com/apiv1/app/upload
</code></pre><h4 id="æœ€é‡è¦ã€æœ€é‡è¦ã€æœ€é‡è¦ï¼š"><a href="#æœ€é‡è¦ã€æœ€é‡è¦ã€æœ€é‡è¦ï¼š" class="headerlink" title="æœ€é‡è¦ã€æœ€é‡è¦ã€æœ€é‡è¦ï¼š"></a><strong>æœ€é‡è¦ã€æœ€é‡è¦ã€æœ€é‡è¦ï¼š</strong></h4><p>LinuxæœåŠ¡å™¨ä¸Šçš„Jenkinsè°ƒç”¨Mac Slaveæ—¶ï¼Œæ˜¯é€šè¿‡ä¹‹å‰è®¾ç½®çš„<strong>SSH</strong>ç™»å½•çš„æ–¹å¼ï¼Œè€ŒAppleä¸ºäº†å®‰å…¨ï¼Œåœ¨sshç™»å½•æ—¶ï¼Œæ˜¯ä¸å…è®¸è¯»å–<strong>Keychains</strong>ï¼ˆé’¥åŒ™ä¸²ï¼‰çš„ï¼Œæ‰€ä»¥ <code>security -v unlock-keychain -p &quot;yourpassword&quot;</code>è¿™è¡Œå‘½ä»¤å°±å¾ˆé‡è¦äº†ã€‚åœ¨æ„å»ºæ‰“åŒ…å‰ï¼Œå…ˆè§£é”Keychainsã€‚</p>
<p>å½“ç„¶è¿™é‡Œ <strong>fastlane</strong> å·²ç»æå‰é€šè¿‡<strong>Homebrew</strong>å®‰è£…å¥½äº†ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚</p>
<blockquote>
<p><em>æ•´ä½“è„šæœ¬çš„æµç¨‹æ˜¯ï¼Œå…ˆè§£é”Keychainï¼Œç„¶åç”¨fastlaneå¿«é€Ÿæ‰“åŒ…ï¼Œæœ€åä¸Šä¼ åˆ°è’²å…¬è‹±å¹³å°ï¼Œç­‰å¾…æµ‹è¯•ã€‚</em></p>
</blockquote>
<h3 id="8-æ„å»ºåæ“ä½œã€‚"><a href="#8-æ„å»ºåæ“ä½œã€‚" class="headerlink" title="8. æ„å»ºåæ“ä½œã€‚"></a>8. æ„å»ºåæ“ä½œã€‚</h3><p><img src="https://ww2.sinaimg.cn/large/006tNc79ly1ff2k7cb7ptj31kw0ktjue.jpg" alt=""></p>
<p>é™„ä»£ç ï¼š</p>
<pre><code>&lt;h3&gt;æ›´æ–°è¯´æ˜:&lt;/h3&gt;&lt;p&gt;${News}&lt;/p&gt;&lt;a href=&quot;http://www.pgyer.com/urwork_ios&quot; style=&quot;display:block;margin:10px 0px;&quot; target=&quot;_blank&quot;&gt;ç‚¹å‡»è·³è½¬åˆ°ä¸‹è½½é¡µ&lt;/a&gt;&lt;/br&gt;&lt;img src=&quot;http://www.pgyer.com/app/qrcode/urwork_ios&quot;&gt;
</code></pre><p>æ„å»ºå®Œæˆåï¼ŒæŠŠä¹‹å‰ç”¨æˆ·è¾“å…¥çš„<strong>æ›´æ–°è¯´æ˜</strong>ä»¥åŠ<strong>è’²å…¬è‹±ä¸‹è½½åœ°å€</strong>å’Œ<strong>äºŒç»´ç </strong>é€šé€šæ˜¾ç¤ºåœ¨Build Descriptionä¸­ã€‚</p>
<h2 id="å››ã€æ•´ä½“æµ‹è¯•"><a href="#å››ã€æ•´ä½“æµ‹è¯•" class="headerlink" title="å››ã€æ•´ä½“æµ‹è¯•"></a>å››ã€æ•´ä½“æµ‹è¯•</h2><h3 id="1-æ‰“å¼€Jenkinsã€‚"><a href="#1-æ‰“å¼€Jenkinsã€‚" class="headerlink" title="1. æ‰“å¼€Jenkinsã€‚"></a>1. æ‰“å¼€Jenkinsã€‚</h3><p><img src="https://ww1.sinaimg.cn/large/006tNc79ly1ff2kbajk7cj31kw0u6jxm.jpg" alt=""></p>
<h3 id="2-ç‚¹å‡»develop-iOSã€‚"><a href="#2-ç‚¹å‡»develop-iOSã€‚" class="headerlink" title="2. ç‚¹å‡»develop_iOSã€‚"></a>2. ç‚¹å‡»develop_iOSã€‚</h3><p><img src="https://ww1.sinaimg.cn/large/006tNc79ly1ff2kang8dkj31kw0tf7c5.jpg" alt=""></p>
<h3 id="3-ç‚¹å‡»Build-with-Parameters"><a href="#3-ç‚¹å‡»Build-with-Parameters" class="headerlink" title="3. ç‚¹å‡»Build with Parameters."></a>3. ç‚¹å‡»Build with Parameters.</h3><p><img src="https://ww2.sinaimg.cn/large/006tNc79ly1ff2kdk1zdfj31kw0tktds.jpg" alt=""></p>
<h3 id="4-å¼€å§‹æ„å»ºã€‚"><a href="#4-å¼€å§‹æ„å»ºã€‚" class="headerlink" title="4. å¼€å§‹æ„å»ºã€‚"></a>4. å¼€å§‹æ„å»ºã€‚</h3><p><img src="https://ww4.sinaimg.cn/large/006tNc79ly1ff2keezip1j31kw0tf10n.jpg" alt=""></p>
<h3 id="5-ç­‰å¾…æ„å»ºå®Œæˆå³å¯ã€‚"><a href="#5-ç­‰å¾…æ„å»ºå®Œæˆå³å¯ã€‚" class="headerlink" title="5. ç­‰å¾…æ„å»ºå®Œæˆå³å¯ã€‚"></a>5. ç­‰å¾…æ„å»ºå®Œæˆå³å¯ã€‚</h3><p>è¿™é‡Œä¹Ÿå¯ä»¥æŸ¥çœ‹æ„å»ºè¿›åº¦ï¼šç‚¹å‡»æœ€æ–°çš„ä¸€æ¬¡æ„å»º</p>
<p><img src="https://ww3.sinaimg.cn/large/006tNc79ly1ff2kg18untj31kw0s1tdq.jpg" alt=""></p>
<p>ç‚¹å‡»Console Output<br><img src="https://ww4.sinaimg.cn/large/006tNc79ly1ff2kgpirr9j31kw0sj13w.jpg" alt=""></p>
<p>åœ¨è¿™é‡Œå¯ä»¥æŸ¥çœ‹ä¸€äº›æ—¥å¿—ï¼Œå¦‚æœå‡ºé”™äº†ï¼Œä¹Ÿå¯ä»¥åœ¨è¿™é‡ŒæŸ¥è¯¢ã€‚</p>
<h2 id="äº”ã€æ€»ç»“ã€‚"><a href="#äº”ã€æ€»ç»“ã€‚" class="headerlink" title="äº”ã€æ€»ç»“ã€‚"></a>äº”ã€æ€»ç»“ã€‚</h2><p>ä½¿ç”¨Jenkinsæ‰“åŒ…Xcodeå·¥ç¨‹æ•´ä½“è¿‡ç¨‹å¾ˆæ›²æŠ˜ï¼Œå‘å¾ˆå¤šï¼ŒæŒ‰ç…§è¿™äº›æ¥ï¼Œå¯èƒ½è¿˜ä¼šé‡åˆ°ä¸€äº›é—®é¢˜ï¼Œé™„ä¸Šä¸€äº›é“¾æ¥ï¼Œä»¥ä¾›å‚è€ƒã€‚</p>
<h2 id="é™„"><a href="#é™„" class="headerlink" title="é™„"></a>é™„</h2><ul>
<li><a href="http://www.jianshu.com/p/371595ef08fe" target="_blank" rel="external">Jenkins+ Xcode+ è’²å…¬è‹± å®ç°IOSè‡ªåŠ¨åŒ–æ‰“åŒ…å’Œåˆ†å‘</a></li>
<li><a href="http://www.jianshu.com/p/41ecb06ae95f" target="_blank" rel="external">æ‰‹æŠŠæ‰‹æ•™ä½ åˆ©ç”¨JenkinsæŒç»­é›†æˆiOSé¡¹ç›®</a></li>
<li><a href="http://www.jianshu.com/p/62fa8083b45c" target="_blank" rel="external">Jenkinsç­¾åé—®é¢˜</a></li>
<li><a href="https://www.pgyer.com/doc/view/jenkins_ios" target="_blank" rel="external">ä½¿ç”¨ Jenkins å®ç°æŒç»­é›†æˆ (iOS)</a></li>
<li><a href="https://www.pgyer.com/doc/view/jenkins" target="_blank" rel="external">ä½¿ç”¨ Jenkins å®ç°æŒç»­é›†æˆ (Android)</a></li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;è§£å†³LinuxæœåŠ¡å™¨ä¸Šçš„Jenkinsæ— æ³•æ„å»ºXcodeå·¥ç¨‹&lt;/p&gt;
&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;ç”±äºLinuxæœåŠ¡å™¨æ— æ³•å®‰è£…Xcodeï¼Œæ‰€ä»¥Jenkinsæ— æ³•é€š
    
    </summary>
    
    
      <category term="iOSæŠ€æœ¯åˆ†äº«" scheme="http://blog.darkangel7.com/tags/iOS%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"/>
    
  </entry>
  
  <entry>
    <title>iOSä¸­UIWebViewä¸WKWebViewã€JavaScriptä¸OCäº¤äº’ã€Cookieç®¡ç†çœ‹æˆ‘å°±å¤Ÿï¼ˆä¸Šï¼‰</title>
    <link href="http://blog.darkangel7.com/2016/09/01/iOS%E4%B8%ADUIWebView%E4%B8%8EWKWebView%E3%80%81JavaScript%E4%B8%8EOC%E4%BA%A4%E4%BA%92%E3%80%81Cookie%E7%AE%A1%E7%90%86%E7%9C%8B%E6%88%91%E5%B0%B1%E5%A4%9F%EF%BC%88%E4%B8%8A%EF%BC%89/"/>
    <id>http://blog.darkangel7.com/2016/09/01/iOSä¸­UIWebViewä¸WKWebViewã€JavaScriptä¸OCäº¤äº’ã€Cookieç®¡ç†çœ‹æˆ‘å°±å¤Ÿï¼ˆä¸Šï¼‰/</id>
    <published>2016-09-01T07:37:29.000Z</published>
    <updated>2017-05-10T12:16:39.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://ww4.sinaimg.cn/large/006tNc79ly1fff1sa06wrj30sg0iwwi9.jpg" alt=""></p>
<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>iOSå¼€å‘ä¸­ï¼Œç”¨æ¥æ˜¾ç¤ºä¸€ä¸ªhtmlé¡µã€H5é¡µï¼Œç»å¸¸ä¼šç”¨çš„ä¸€ä¸ªæ§ä»¶æ˜¯WebViewã€‚è¯´åˆ°WebViewï¼Œä½ çŸ¥é“å¤šå°‘å‘¢ï¼Ÿæ˜¯ç®€å•çš„å±•ç¤ºï¼Œè¿˜æ˜¯è¦å’ŒOCäº¤äº’å®ç°æ¯”è¾ƒå¤æ‚çš„åŠŸèƒ½å‘¢ï¼Ÿæœ¬æ–‡å°†ä¸ºæ‚¨ä»‹ç»iOSä¸­çš„WebViewï¼Œå¹¶ä¸”ç”±æµ…åˆ°æ·±ï¼Œä¸€æ­¥æ­¥å¸¦ä½ äº†è§£å¹¶æŒæ¡WebViewçš„ç”¨æ³•ï¼ŒJavaScriptä¸Objectiveçš„äº¤äº’ï¼Œä»¥åŠCookieçš„ç®¡ç†ã€jsçš„è°ƒè¯•ç­‰ã€‚</p>
<p>æ–‡ç« å› æ¶‰åŠåˆ°çš„å†…å®¹è¾ƒå¤šï¼Œå› æ­¤æ‹†åˆ†æˆä»¥ä¸‹å‡ éƒ¨åˆ†ï¼š</p>
<ul>
<li>iOSä¸­UIWebViewä¸WKWebViewã€JavaScriptä¸OCäº¤äº’ã€Cookieç®¡ç†çœ‹æˆ‘å°±å¤Ÿï¼ˆä¸Šï¼‰</li>
<li><a href="http://blog.darkangel7.com/2017/05/10/iOSä¸­UIWebViewä¸WKWebViewã€JavaScriptä¸OCäº¤äº’ã€Cookieç®¡ç†çœ‹æˆ‘å°±å¤Ÿï¼ˆä¸­ï¼‰/">iOSä¸­UIWebViewä¸WKWebViewã€JavaScriptä¸OCäº¤äº’ã€Cookieç®¡ç†çœ‹æˆ‘å°±å¤Ÿï¼ˆä¸­ï¼‰</a></li>
<li><a href="">iOSä¸­UIWebViewä¸WKWebViewã€JavaScriptä¸OCäº¤äº’ã€Cookieç®¡ç†çœ‹æˆ‘å°±å¤Ÿï¼ˆä¸‹ï¼‰</a>ï¼ˆå¾…å¡«å‘â€¦ï¼‰</li>
</ul>
<p>å…³äºæ–‡ä¸­æåˆ°çš„ä¸€äº›å†…å®¹ï¼Œè¿™é‡Œæˆ‘å‡†å¤‡äº†ä¸ª<a href="https://github.com/DarkAngel7/Demos-WebViewDemo" target="_blank" rel="external">Demo</a>ï¼Œæœ‰éœ€è¦çš„å°ä¼™ä¼´å¯ä»¥ä¸‹è½½ã€‚</p>
<h1 id="UIWebView"><a href="#UIWebView" class="headerlink" title="UIWebView"></a>UIWebView</h1><h2 id="UIWebViewåŸºæœ¬ç”¨æ³•"><a href="#UIWebViewåŸºæœ¬ç”¨æ³•" class="headerlink" title="UIWebViewåŸºæœ¬ç”¨æ³•"></a>UIWebViewåŸºæœ¬ç”¨æ³•</h2><p>é¦–å…ˆè¦ä»‹ç»çš„å°±æ˜¯æˆ‘ä»¬çš„è€æœ‹å‹<code>UIWebView</code>ã€‚ç›¸ä¿¡å¯¹å¤§å¤šæ•°å°ä¼™ä¼´å„¿è€Œè¨€ï¼Œ<code>UIWebView</code>å’Œ<code>UILabel</code>ä¸€æ ·ï¼Œéƒ½æ˜¯æœ€æ—©æ¥è§¦çš„æ§ä»¶äº†ï¼Œå…¶å®<code>UIWebView</code>ç”¨æ³•æ¯”è¾ƒç®€å•ï¼ˆåŠŸèƒ½åŸºæœ¬èƒ½æ»¡è¶³éœ€æ±‚ï¼‰ï¼Œç®€å•çš„åˆ›å»ºï¼Œå¹¶ä¸”è°ƒç”¨</p>
<pre><code class="objective-c">- (void)loadRequest:(NSURLRequest *)request;
- (void)loadHTMLString:(NSString *)string baseURL:(nullable NSURL *)baseURL;
- (void)loadData:(NSData *)data MIMEType:(NSString *)MIMEType textEncodingName:(NSString *)textEncodingName baseURL:(NSURL *)baseURL;
</code></pre>
<p>è¿™äº›æ–¹æ³•ï¼ŒåŠ è½½å°±å¯ä»¥äº†ã€‚<br>å½“ç„¶ï¼Œå¦‚æœéœ€è¦ç›‘å¬é¡µé¢åŠ è½½çš„ç»“æœï¼Œæˆ–è€…éœ€è¦åˆ¤æ–­æ˜¯å¦å…è®¸æ‰“å¼€æŸä¸ªURLï¼Œé‚£éœ€è¦è®¾ç½®<code>UIWebView</code>çš„<code>delegate</code>ï¼Œä»£ç†åªéœ€è¦éµå¾ª<code>&lt;UIWebViewDelegate&gt;</code>åè®®ï¼Œå¹¶ä¸”åœ¨ä»£ç†ä¸­å®ç°ä¸‹é¢çš„è¿™äº›å¯é€‰æ–¹æ³•å°±å¯ä»¥ï¼š</p>
<pre><code class="objective-c">__TVOS_PROHIBITED @protocol UIWebViewDelegate &lt;NSObject&gt;

@optional
- (BOOL)webView:(UIWebView *)webView shouldStartLoadWithRequest:(NSURLRequest *)request navigationType:(UIWebViewNavigationType)navigationType;
- (void)webViewDidStartLoad:(UIWebView *)webView;
- (void)webViewDidFinishLoad:(UIWebView *)webView;
- (void)webView:(UIWebView *)webView didFailLoadWithError:(nullable NSError *)error;

@end
</code></pre>
<h2 id="UIWebViewä¸­JavaScriptä¸Objectiveçš„äº¤äº’"><a href="#UIWebViewä¸­JavaScriptä¸Objectiveçš„äº¤äº’" class="headerlink" title="UIWebViewä¸­JavaScriptä¸Objectiveçš„äº¤äº’"></a>UIWebViewä¸­JavaScriptä¸Objectiveçš„äº¤äº’</h2><p>è¿™é‡Œä¸è¯¦ç»†è®¨è®ºä¸€äº›å¾ˆå¥½çš„ç¬¬ä¸‰æ–¹å®ç°ï¼Œæ¯”å¦‚<a href="https://github.com/marcuswestin/WebViewJavascriptBridge" target="_blank" rel="external">WebViewJavascriptBridge</a>ï¼Œå•çº¯çš„è®²è®²nativeç«¯JSä¸OCçš„äº¤äº’å®ç°æ–¹å¼ï¼Œè¯»å®Œäº†ä¸‹é¢çš„éƒ¨åˆ†ï¼Œç›¸ä¿¡ä½ ä¹Ÿä¼šå®ç°ä¸€ä¸ªç®€å•çš„<code>bridge</code>äº†ã€‚</p>
<h3 id="UIWebView-OCè°ƒç”¨JS"><a href="#UIWebView-OCè°ƒç”¨JS" class="headerlink" title="UIWebView OCè°ƒç”¨JS"></a>UIWebView OCè°ƒç”¨JS</h3><h4 id="1-stringByEvaluatingJavaScriptFromString"><a href="#1-stringByEvaluatingJavaScriptFromString" class="headerlink" title="1. stringByEvaluatingJavaScriptFromString:"></a>1. stringByEvaluatingJavaScriptFromString:</h4><p>æœ€å¸¸ç”¨çš„æ–¹æ³•ï¼Œå¾ˆç®€å•ï¼Œåªè¦è°ƒç”¨<code>- (nullable NSString *)stringByEvaluatingJavaScriptFromString:(NSString *)script;</code>å°±å¯ä»¥äº†ï¼Œå¦‚ï¼š</p>
<pre><code class="objective-c">    self.navigationItem.title = [webView stringByEvaluatingJavaScriptFromString:@&quot;document.title&quot;];
</code></pre>
<p>è™½ç„¶æ¯”è¾ƒæ–¹ä¾¿ï¼Œä½†æ˜¯ç¼ºç‚¹ä¹Ÿæœ‰ï¼š</p>
<ol>
<li>è¯¥æ–¹æ³•ä¸èƒ½åˆ¤æ–­è°ƒç”¨äº†ä¸€ä¸ªjsæ–¹æ³•ä¹‹åï¼Œæ˜¯å¦å‘ç”Ÿäº†é”™è¯¯ã€‚å½“é”™è¯¯å‘ç”Ÿæ—¶ï¼Œè¿”å›å€¼ä¸ºnilï¼Œè€Œå½“è°ƒç”¨ä¸€ä¸ªæ–¹æ³•æœ¬èº«æ²¡æœ‰è¿”å›å€¼æ—¶ï¼Œè¿”å›å€¼ä¹Ÿä¸ºnilï¼Œæ‰€ä»¥æ— æ³•åˆ¤æ–­æ˜¯å¦è°ƒç”¨æˆåŠŸäº†ã€‚</li>
<li>è¿”å›å€¼ç±»å‹ä¸º<code>nullable NSString *</code>ï¼Œå°±æ„å‘³ç€å½“è°ƒç”¨çš„jsæ–¹æ³•æœ‰è¿”å›å€¼æ—¶ï¼Œéƒ½ä»¥å­—ç¬¦ä¸²è¿”å›ï¼Œä¸å¤Ÿçµæ´»ã€‚å½“è¿”å›å€¼æ˜¯ä¸€ä¸ªjsçš„Arrayæ—¶ï¼Œè¿˜éœ€è¦è§£æå­—ç¬¦ä¸²ï¼Œæ¯”è¾ƒéº»çƒ¦ã€‚</li>
</ol>
<p>å¯¹äºä¸Šè¿°ç¼ºç‚¹ï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨JavaScriptCoreï¼ˆiOS 7.0 +ï¼‰æ¥è§£å†³ã€‚</p>
<h4 id="2-JavaScriptCoreï¼ˆiOS-7-0-ï¼‰"><a href="#2-JavaScriptCoreï¼ˆiOS-7-0-ï¼‰" class="headerlink" title="2. JavaScriptCoreï¼ˆiOS 7.0 +ï¼‰"></a>2. JavaScriptCoreï¼ˆiOS 7.0 +ï¼‰</h4><p>æƒ³å¿…å¤§å®¶ä¸ä¼šé™Œç”Ÿå§ï¼Œå‰äº›æ—¥å­å¼„çš„æ²¸æ²¸æ‰¬æ‰¬çš„<code>JSPatch</code>è¢«ç¦äº‹ä»¶ä¸­ï¼Œæœ€æ ¸å¿ƒçš„å°±æ˜¯å®ƒäº†ã€‚å› ä¸º<code>JavaScriptCore</code>çš„JSåˆ°OCçš„æ˜ å°„ï¼Œå¯ä»¥æ›¿æ¢å„ç§jsæ–¹æ³•æˆocæ–¹æ³•ï¼Œæ‰€ä»¥å…¶<strong>åŠ¨æ€æ€§ï¼ˆé…åˆruntimeçš„ä¸å®‰å…¨æ€§ï¼‰</strong>ä¹Ÿå°±æˆä¸ºäº†<code>JSPatch</code>è¢«<strong>Apple</strong>ç¦æ‰çš„æœ€ä¸»è¦åŸå› ã€‚è¿™é‡Œè®²ä¸‹<code>UIWebView</code>é€šè¿‡<code>JavaScriptCore</code>æ¥å®ç°OC-&gt;JSã€‚</p>
<p>å…¶å®WebKitéƒ½æœ‰ä¸€ä¸ªå†…åµŒçš„jsç¯å¢ƒï¼Œä¸€èˆ¬æˆ‘ä»¬åœ¨é¡µé¢åŠ è½½å®Œæˆä¹‹åï¼Œè·å–jsä¸Šä¸‹æ–‡ï¼Œç„¶åé€šè¿‡<code>JSContext</code>çš„<code>evaluateScript:</code>æ–¹æ³•æ¥è·å–è¿”å›å€¼ã€‚å› ä¸ºè¯¥æ–¹æ³•å¾—åˆ°çš„æ˜¯ä¸€ä¸ª<code>JSValue</code>å¯¹è±¡ï¼Œæ‰€ä»¥æ”¯æŒJavaScriptçš„Arrayã€Numberã€Stringã€å¯¹è±¡ç­‰æ•°æ®ç±»å‹ã€‚</p>
<pre><code class="objective-c">- (void)webViewDidFinishLoad:(UIWebView *)webView
{
    //æ›´æ–°æ ‡é¢˜ï¼Œè¿™æ˜¯ä¸Šé¢çš„è®²è¿‡çš„æ–¹æ³•
    //self.navigationItem.title = [webView stringByEvaluatingJavaScriptFromString:@&quot;document.title&quot;];

    //è·å–è¯¥UIWebViewçš„javascriptä¸Šä¸‹æ–‡
    JSContext *jsContext = [self.webView valueForKeyPath:@&quot;documentView.webView.mainFrame.javaScriptContext&quot;];

    //è¿™ä¹Ÿæ˜¯ä¸€ç§è·å–æ ‡é¢˜çš„æ–¹æ³•ã€‚
    JSValue *value = [self.jsContext evaluateScript:@&quot;document.title&quot;];
    //æ›´æ–°æ ‡é¢˜
    self.navigationItem.title = value.toString;
}
</code></pre>
<p>è¯¥æ–¹æ³•è§£å†³äº†<code>stringByEvaluatingJavaScriptFromString:</code>è¿”å›å€¼åªæ˜¯<code>NSString</code>çš„é—®é¢˜ã€‚</p>
<p>é‚£ä¹ˆå¦‚æœæˆ‘æ‰§è¡Œäº†ä¸€ä¸ªä¸å­˜åœ¨çš„æ–¹æ³•ï¼Œæ¯”å¦‚</p>
<pre><code class="objective-c">[self.jsContext evaluateScript:@&quot;document.titlexxxx&quot;];
</code></pre>
<p>é‚£ä¹ˆå¿…ç„¶ä¼šæŠ¥é”™ï¼ŒæŠ¥é”™äº†ï¼Œå¯ä»¥é€šè¿‡<code>@property (copy) void(^exceptionHandler)(JSContext *context, JSValue *exception);</code>ï¼Œè®¾ç½®è¯¥blockæ¥è·å–å¼‚å¸¸ã€‚</p>
<pre><code class="objective-c">//åœ¨è°ƒç”¨å‰ï¼Œè®¾ç½®å¼‚å¸¸å›è°ƒ
[self.jsContext setExceptionHandler:^(JSContext *context, JSValue *exception){
        NSLog(@&quot;%@&quot;, exception);
}];
//æ‰§è¡Œæ–¹æ³•
JSValue *value = [self.jsContext evaluateScript:@&quot;document.titlexxxx&quot;];
</code></pre>
<p>è¯¥æ–¹æ³•ï¼Œä¹Ÿå¾ˆå¥½çš„è§£å†³äº†<code>stringByEvaluatingJavaScriptFromString:</code>è°ƒç”¨jsæ–¹æ³•åï¼Œå‡ºç°é”™è¯¯å´æ•è·ä¸åˆ°çš„ç¼ºç‚¹ã€‚</p>
<h3 id="UIWebView-JSè°ƒç”¨OC"><a href="#UIWebView-JSè°ƒç”¨OC" class="headerlink" title="UIWebView JSè°ƒç”¨OC"></a>UIWebView JSè°ƒç”¨OC</h3><h4 id="1-Custom-URL-Schemeï¼ˆæ‹¦æˆªURLï¼‰"><a href="#1-Custom-URL-Schemeï¼ˆæ‹¦æˆªURLï¼‰" class="headerlink" title="1. Custom URL Schemeï¼ˆæ‹¦æˆªURLï¼‰"></a>1. Custom URL Schemeï¼ˆæ‹¦æˆªURLï¼‰</h4><p>æ¯”å¦‚<code>darkangel://</code>ã€‚æ–¹æ³•æ˜¯åœ¨htmlæˆ–è€…jsä¸­ï¼Œç‚¹å‡»æŸä¸ªæŒ‰é’®è§¦å‘äº‹ä»¶æ—¶ï¼Œè·³è½¬åˆ°è‡ªå®šä¹‰URL Schemeæ„æˆçš„é“¾æ¥ï¼Œè€ŒObjective-Cä¸­æ•è·è¯¥é“¾æ¥ï¼Œä»ä¸­è§£æå¿…è¦çš„å‚æ•°ï¼Œå®ç°JSåˆ°OCçš„ä¸€æ¬¡äº¤äº’ã€‚æ¯”å¦‚é¡µé¢ä¸­ä¸€ä¸ªaæ ‡ç­¾ï¼Œé“¾æ¥å¦‚ä¸‹ï¼š</p>
<pre><code class="html">&lt;a href=&quot;darkangel://smsLogin?username=12323123&amp;code=892845&quot;&gt;çŸ­ä¿¡éªŒè¯ç™»å½•&lt;/a&gt;
</code></pre>
<p>è€Œåœ¨Objective-Cä¸­ï¼Œåªè¦éµå¾ªäº†<code>UIWebViewDelegate</code>åè®®ï¼Œé‚£ä¹ˆæ¯æ¬¡æ‰“å¼€ä¸€ä¸ªé“¾æ¥ä¹‹å‰ï¼Œéƒ½ä¼šè§¦å‘æ–¹æ³•</p>
<pre><code class="objective-c">- (BOOL)webView:(UIWebView *)webView shouldStartLoadWithRequest:(NSURLRequest *)request navigationType:(UIWebViewNavigationType)navigationTypeï¼›
</code></pre>
<p>åœ¨è¯¥æ–¹æ³•ä¸­ï¼Œæ•è·è¯¥é“¾æ¥ï¼Œå¹¶ä¸”è¿”å›NOï¼ˆ<strong>é˜»æ­¢æœ¬æ¬¡è·³è½¬</strong>ï¼‰ï¼Œä»è€Œæ‰§è¡Œå¯¹åº”çš„OCæ–¹æ³•ã€‚</p>
<pre><code class="objective-c">- (BOOL)webView:(UIWebView *)webView shouldStartLoadWithRequest:(NSURLRequest *)request navigationType:(UIWebViewNavigationType)navigationType
{
    //æ ‡å‡†çš„URLåŒ…å«schemeã€hostã€portã€pathã€queryã€fragmentç­‰
    NSURL *URL = request.URL;    
    if ([URL.scheme isEqualToString:@&quot;darkangel&quot;]) {
        if ([URL.host isEqualToString:@&quot;smsLogin&quot;]) {
            NSLog(@&quot;çŸ­ä¿¡éªŒè¯ç ç™»å½•ï¼Œå‚æ•°ä¸º %@&quot;, URL.query);
            return NO;
        }
    }
    return YES;
}
</code></pre>
<p>å½“ç”¨æˆ·ç‚¹å‡»<strong>çŸ­ä¿¡éªŒè¯ç™»å½•</strong>æ—¶ï¼Œæ§åˆ¶å°ä¼šè¾“å‡º<code>çŸ­ä¿¡éªŒè¯ç ç™»å½•ï¼Œå‚æ•°ä¸º username=12323123&amp;code=892845</code>ã€‚å‚æ•°å¯ä»¥æ˜¯ä¸€ä¸ªjsonæ ¼å¼å¹¶ä¸”URLEncodeè¿‡çš„å­—ç¬¦ä¸²ï¼Œè¿™æ ·å°±å¯ä»¥å®ç°å¤æ‚å‚æ•°çš„ä¼ é€’ï¼ˆæ¯”å¦‚<a href="https://github.com/marcuswestin/WebViewJavascriptBridge" target="_blank" rel="external">WebViewJavascriptBridge</a>ï¼‰ã€‚</p>
<p><strong>ä¼˜ç‚¹</strong>ï¼šæ³›ç”¨æ€§å¼ºï¼Œå¯ä»¥é…åˆh5å®ç°é¡µé¢åŠ¨æ€åŒ–ã€‚æ¯”å¦‚é¡µé¢ä¸­ä¸€ä¸ªæ´»åŠ¨é“¾æ¥åˆ°æ´»åŠ¨è¯¦æƒ…é¡µï¼Œå½“nativeå°šæœªå¼€å‘å®Œæ¯•æ—¶ï¼Œé“¾æ¥å¯ä»¥æ˜¯ä¸€ä¸ªh5é“¾æ¥ï¼Œç­‰åˆ°nativeå¼€å‘å®Œæ¯•æ—¶ï¼Œå¯ä»¥é€šè¿‡è¯¥æ–¹æ³•è·³è½¬åˆ°nativeé¡µé¢ï¼Œå®ç°é¡µé¢åŠ¨æ€åŒ–ã€‚ä¸”è¯¥æ–¹æ¡ˆé€‚ç”¨äºAndroidå’ŒiOSï¼Œæ³›ç”¨æ€§å¾ˆå¼ºã€‚</p>
<p><strong>ç¼ºç‚¹</strong>ï¼šæ— æ³•ç›´æ¥è·å–æœ¬æ¬¡äº¤äº’çš„è¿”å›å€¼ï¼Œæ¯”è¾ƒé€‚åˆå•å‘ä¼ å‚ï¼Œä¸”ä¸å…³å¿ƒå›è°ƒçš„æƒ…æ™¯ï¼Œæ¯”å¦‚h5é¡µé¢è·³è½¬åˆ°nativeé¡µé¢ç­‰ã€‚</p>
<p>å…¶å®ï¼Œ<a href="https://github.com/marcuswestin/WebViewJavascriptBridge" target="_blank" rel="external">WebViewJavascriptBridge</a>ä½¿ç”¨çš„æ–¹æ¡ˆå°±æ˜¯<strong>æ‹¦æˆªURL</strong>ï¼Œä¸ºäº†è§£å†³æ— æ³•ç›´æ¥è·å–è¿”å›å€¼çš„ç¼ºç‚¹ï¼Œå®ƒé‡‡ç”¨äº†å°†ä¸€ä¸ªåä¸º<code>callback</code>çš„<code>function</code>ä½œä¸ºå‚æ•°ï¼Œé€šè¿‡ä¸€äº›å°è£…ï¼Œä¼ é€’åˆ°OCï¼ˆ<strong>js-&gt;oc</strong> ä¼ é€’å‚æ•°å’ŒcallbackIdï¼‰ï¼Œç„¶ååœ¨OCç«¯æ‰§è¡Œå®Œæ¯•ï¼Œå†é€šè¿‡<code>block</code>æ¥å›è°ƒcallbackï¼ˆ<strong>oc-&gt;js</strong>ï¼Œä¼ é€’è¿”å›å€¼å‚æ•°ï¼‰ï¼Œå®ç°å¼‚æ­¥è·å–è¿”å›å€¼ï¼Œæ¯”å¦‚åœ¨jsç«¯è°ƒç”¨</p>
<pre><code class="javascript">//JSè°ƒç”¨OCçš„åˆ†äº«æ–¹æ³•ï¼ˆå½“ç„¶éœ€è¦OCæå‰æ³¨å†Œï¼‰shareä¸ºæ–¹æ³•åï¼ŒshareDataä¸ºå‚æ•°ï¼Œåé¢çš„ä¸ºå›è°ƒfunction
WebViewJavascriptBridge.callHandler(&#39;share&#39;, shareData, function(response) {
   //OCç«¯é€šè¿‡blockå›è°ƒåˆ†äº«æˆåŠŸæˆ–è€…å¤±è´¥çš„ç»“æœ
   alert(response);   
});
</code></pre>
<p>å…·ä½“çš„å¯ä»¥çœ‹ä¸‹å®ƒçš„æºç ï¼Œè¿˜æ˜¯å¾ˆå€¼å¾—å­¦ä¹ çš„ã€‚</p>
<h4 id="2-JavaScriptCoreï¼ˆiOS-7-0-ï¼‰-1"><a href="#2-JavaScriptCoreï¼ˆiOS-7-0-ï¼‰-1" class="headerlink" title="2. JavaScriptCoreï¼ˆiOS 7.0 +ï¼‰"></a>2. JavaScriptCoreï¼ˆiOS 7.0 +ï¼‰</h4><p>é™¤äº†<strong>æ‹¦æˆªURL</strong>çš„æ–¹æ³•ï¼Œè¿˜å¯ä»¥åˆ©ç”¨ä¸Šé¢æåˆ°çš„<code>JavaScriptCore</code>ã€‚å®ƒååˆ†å¼ºå¤§ï¼Œå¼ºå¤§åœ¨å“ªé‡Œå‘¢ï¼Ÿä¸‹é¢æˆ‘ä»¬æ¥ä¸€æ¢ç©¶ç«Ÿã€‚</p>
<p>å½“ç„¶ï¼Œè¿˜æ˜¯éœ€è¦åœ¨é¡µé¢åŠ è½½å®Œæˆæ—¶ï¼Œå…ˆè·å–jsä¸Šä¸‹æ–‡ã€‚è·å–åˆ°ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿›è¡Œå¼ºå¤§çš„æ–¹æ³•æ˜ å°„äº†ã€‚</p>
<p>æ¯”å¦‚jsä¸­æˆ‘å®šä¹‰äº†ä¸€ä¸ªåˆ†äº«çš„æ–¹æ³•</p>
<pre><code class="javascript">function share(title, imgUrl, link) {
     //è¿™é‡Œéœ€è¦OCå®ç°
}
</code></pre>
<p>åœ¨OCä¸­å®ç°å¦‚ä¸‹</p>
<pre><code class="objective-c">- (void)webViewDidFinishLoad:(UIWebView *)webView
{
    //å°†jsçš„functionæ˜ å°„åˆ°OCçš„æ–¹æ³•
    [self convertJSFunctionsToOCMethods];
}

- (void)convertJSFunctionsToOCMethods
{
    //è·å–è¯¥UIWebviewçš„javascriptä¸Šä¸‹æ–‡
    //selfæŒæœ‰jsContext
    //@property (nonatomic, strong) JSContext *jsContext;
    self.jsContext = [self.webView valueForKeyPath:@&quot;documentView.webView.mainFrame.javaScriptContext&quot;];

    //jsè°ƒç”¨oc
    //å…¶ä¸­shareå°±æ˜¯jsçš„æ–¹æ³•åç§°ï¼Œèµ‹ç»™æ˜¯ä¸€ä¸ªblock é‡Œé¢æ˜¯ocä»£ç 
    //æ­¤æ–¹æ³•æœ€ç»ˆå°†æ‰“å°å‡ºæ‰€æœ‰æ¥æ”¶åˆ°çš„å‚æ•°ï¼Œjså‚æ•°æ˜¯ä¸å›ºå®šçš„
    self.jsContext[@&quot;share&quot;] = ^() {
        NSArray *args = [JSContext currentArguments];//è·å–åˆ°shareé‡Œçš„æ‰€æœ‰å‚æ•°
        //argsä¸­çš„å…ƒç´ æ˜¯JSValueï¼Œéœ€è¦è½¬æˆOCçš„å¯¹è±¡
        NSMutableArray *messages = [NSMutableArray array];
        for (JSValue *obj in args) {
            [messages addObject:[obj toObject]];
        }
        NSLog(@&quot;ç‚¹å‡»åˆ†äº«jsä¼ å›çš„å‚æ•°ï¼š\n%@&quot;, messages);
    };
}
</code></pre>
<p>åœ¨htmlæˆ–è€…jsçš„æŸå¤„ï¼Œç‚¹å‡»aæ ‡ç­¾è°ƒç”¨è¿™ä¸ªshareæ–¹æ³•ï¼Œå¹¶ä¼ å‚ï¼Œå¦‚</p>
<pre><code class="html">&lt;a href=&quot;javascript:void(0);&quot; class=&quot;sharebtn&quot; onClick=&quot;share(&#39;åˆ†äº«æ ‡é¢˜&#39;, &#39;http://cc.cocimg.com/api/uploads/170425/b2d6e7ea5b3172e6c39120b7bfd662fb.jpg&#39;, location.href)&quot;&gt;åˆ†äº«æ´»åŠ¨ï¼Œé¢†30å…ƒçº¢åŒ…&lt;/a&gt;
</code></pre>
<p>æ­¤æ—¶ï¼Œå¦‚æœç”¨æˆ·ç‚¹å‡»äº†<strong><u>åˆ†äº«æ´»åŠ¨ï¼Œé¢†30å…ƒçº¢åŒ…</u></strong>è¿™ä¸ªæ ‡ç­¾ï¼Œé‚£ä¹ˆåœ¨æ§åˆ¶å°ä¼šæ‰“å°å‡ºæ‰€æœ‰å‚æ•°<img src="http://ww2.sinaimg.cn/large/006tNc79ly1fff18hle74j31ak0hiah2.jpg" alt=""></p>
<p>ä¸Šé¢çš„ä»£ç å®ç°äº†OCæ–¹æ³•æ›¿æ¢JSå®ç°ã€‚å®ƒååˆ†çµæ´»ï¼Œä¸»è¦ä¾èµ–è¿™äº›Apiã€‚</p>
<pre><code class="objective-c">@interface JSContext (SubscriptSupport)
/*!
@method
@abstract Get a particular property on the global object.
@result The JSValue for the global object&#39;s property.
*/
- (JSValue *)objectForKeyedSubscript:(id)key;
/*!
@method
@abstract Set a particular property on the global object.
*/
- (void)setObject:(id)object forKeyedSubscript:(NSObject &lt;NSCopying&gt; *)key;
</code></pre>
<p><code>self.jsContext[@&quot;yourMethodName&quot;] = your block;</code>è¿™æ ·å†™ä¸ä»…å¯ä»¥åœ¨æœ‰<code>yourMethodName</code>æ–¹æ³•æ—¶æ›¿æ¢è¯¥JSæ–¹æ³•ä¸ºOCå®ç°ï¼Œè¿˜ä¼šåœ¨gè¯¥æ–¹æ³•æ²¡æœ‰æ—¶ï¼Œæ·»åŠ æ–¹æ³•ã€‚ç®€è€Œè¨€ä¹‹ï¼Œ<strong>æœ‰åˆ™æ›¿æ¢ï¼Œæ— åˆ™æ·»åŠ </strong>ã€‚</p>
<p>é‚£å¦‚æœæˆ‘æƒ³å†™ä¸€ä¸ªæœ‰ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªè¿”å›å€¼çš„jsæ–¹æ³•ï¼Œocåº”è¯¥æ€ä¹ˆæ›¿æ¢å‘¢ï¼Ÿ</p>
<p>jsä¸­</p>
<pre><code class="javascript">//è¯¥æ–¹æ³•ä¼ å…¥ä¸¤ä¸ªæ•´æ•°ï¼Œæ±‚å’Œï¼Œå¹¶è¿”å›ç»“æœ
function testAddMethod(a, b) {
     //éœ€è¦OCå®ç°a+bï¼Œå¹¶è¿”å›
      return a + b;
}
//jsè°ƒç”¨
console.log(testAddMethod(1, 5));    //output  6
</code></pre>
<p>ocç›´æ¥æ›¿æ¢è¯¥æ–¹æ³•</p>
<pre><code class="objective-c">self.jsContext[@&quot;testAddMethod&quot;] = ^NSInteger(NSInteger a, NSInteger b) {
      return a + b;
};
</code></pre>
<p>é‚£ä¹ˆå½“åœ¨jsè°ƒç”¨</p>
<pre><code class="javascript">//jsè°ƒç”¨
console.log(testAddMethod(1, 5));    //output  6ï¼Œ æ–¹æ³•ä¸º a + b
</code></pre>
<p>å¦‚æœocæ›¿æ¢è¯¥æ–¹æ³•ä¸ºä¸¤æ•°ç›¸ä¹˜</p>
<pre><code class="objective-c">self.jsContext[@&quot;testAddMethod&quot;] = ^NSInteger(NSInteger a, NSInteger b) {
      return a * b;
};
</code></pre>
<p>å†æ¬¡è°ƒç”¨js</p>
<pre><code class="javascript">console.log(testAddMethod(1, 5));    //output  5ï¼Œè¯¥æ–¹æ³•å˜ä¸ºäº† a * bã€‚
</code></pre>
<p>ä¸¾ä¸€åä¸‰ï¼Œè°ƒç”¨æ–¹æ³•åŸå®ç°ï¼Œå¹¶ä¸”åœ¨åŸç»“æœä¸Šä¹˜ä»¥10ã€‚</p>
<pre><code class="objective-c">//è°ƒç”¨æ–¹æ³•çš„æœ¬æ¥å®ç°ï¼Œç»™åŸç»“æœä¹˜ä»¥10
JSValue *value = self.jsContext[@&quot;testAddMethod&quot;];
self.jsContext[@&quot;testAddMethod&quot;] = ^NSInteger(NSInteger a, NSInteger b) {
    JSValue *resultValue = [value callWithArguments:[JSContext currentArguments]];
    return resultValue.toInt32 * 10;
};
</code></pre>
<p>å†æ¬¡è°ƒç”¨js</p>
<pre><code class="javascript">console.log(testAddMethod(1, 5));    //output  60ï¼Œè¯¥æ–¹æ³•å˜ä¸ºäº†(a + b) * 10
</code></pre>
<p>ä¸Šé¢çš„æ–¹æ³•ï¼Œéƒ½æ˜¯åŒæ­¥å‡½æ•°ï¼Œå¦‚æœæˆ‘æƒ³å®ç°JSè°ƒç”¨OCçš„æ–¹æ³•ï¼Œå¹¶ä¸”å¼‚æ­¥æ¥æ”¶å›è°ƒï¼Œé‚£ä¹ˆè¯¥æ€ä¹ˆåšå‘¢ï¼Ÿæ¯”å¦‚h5ä¸­æœ‰ä¸€ä¸ªåˆ†äº«æŒ‰é’®ï¼Œç”¨æˆ·ç‚¹å‡»ä¹‹åï¼Œè°ƒç”¨nativeåˆ†äº«ï¼ˆå¾®ä¿¡åˆ†äº«ã€å¾®åšåˆ†äº«ç­‰ï¼‰ï¼Œåœ¨nativeåˆ†äº«æˆåŠŸæˆ–è€…å¤±è´¥æ—¶ï¼Œå›è°ƒh5é¡µé¢ï¼Œå‘Šè¯‰å…¶åˆ†äº«ç»“æœï¼Œh5é¡µé¢åˆ·æ–°å¯¹åº”çš„UIï¼Œæ˜¾ç¤ºåˆ†äº«æˆåŠŸæˆ–è€…å¤±è´¥ã€‚</p>
<p>è¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦å¯¹jsæœ‰ä¸€å®šäº†è§£ã€‚ä¸‹é¢ä¸Šjsä»£ç ã€‚</p>
<pre><code class="javascript">//å£°æ˜
function share(shareData) {
    var title = shareData.title;
    var imgUrl = shareData.imgUrl;
    var link = shareData.link;
    var result = shareData.result;
      //do something
    //è¿™é‡Œæ¨¡æ‹Ÿå¼‚æ­¥æ“ä½œ
    setTimeout(function(){
          //2sä¹‹åï¼Œå›è°ƒtrueåˆ†äº«æˆåŠŸ
       result(true);
    }, 2000);
}

//è°ƒç”¨çš„æ—¶å€™éœ€è¦è¿™ä¹ˆå†™
share({
      title: &quot;title&quot;, 
     imgUrl: &quot;http://img.dd.com/xxx.png&quot;, 
     link: location.href, 
     result: function(res) {    //å‡½æ•°ä½œä¸ºå‚æ•°
         console.log(res ? &quot;success&quot; : &quot;failure&quot;);
    }
});
</code></pre>
<p>ä»å°è£…çš„è§’åº¦ä¸Šè®²ï¼Œjsçš„<code>share</code>æ–¹æ³•çš„å‚æ•°æ˜¯ä¸€ä¸ª<code>å¯¹è±¡</code>ï¼Œè¯¥å¯¹è±¡åŒ…å«äº†å‡ ä¸ªå¿…è¦çš„å­—æ®µï¼Œä»¥åŠä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œè¿™ä¸ªå›è°ƒå‡½æ•°æœ‰ç‚¹åƒocçš„<code>block</code>ï¼Œ<strong>è°ƒç”¨è€…</strong>æŠŠä¸€ä¸ª<code>function</code>ä¼ å…¥ä¸€ä¸ª<code>function</code>å½“ä½œå‚æ•°ï¼Œåœ¨é€‚å½“æ—¶å€™ï¼Œæ–¹æ³•å†…<strong>å®ç°è€…</strong>è°ƒç”¨è¯¥<code>function</code>ï¼Œå®ç°å¯¹<strong>è°ƒç”¨è€…</strong>çš„å¼‚æ­¥å›è°ƒã€‚é‚£ä¹ˆå¦‚æœæ­¤æ—¶OCæ¥å®ç°<code>share</code>æ–¹æ³•ï¼Œè¯¥æ€ä¹ˆåšå‘¢ï¼Ÿå…¶å®å¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š</p>
<pre><code class="objective-c">//å¼‚æ­¥å›è°ƒ
self.jsContext[@&quot;share&quot;] = ^(JSValue *shareData) {    //é¦–å…ˆè¿™é‡Œè¦æ³¨æ„ï¼Œå›è°ƒçš„å‚æ•°ä¸èƒ½ç›´æ¥å†™NSDictionaryç±»å‹ï¼Œä¸ºä½•å‘¢ï¼Ÿ
    //ä»”ç»†çœ‹ï¼Œæ‰“å°å‡ºçš„ç¡®å®æ˜¯ä¸€ä¸ªNSDictionaryï¼Œä½†æ˜¯resultå­—æ®µå¯¹åº”çš„ä¸æ˜¯blockè€Œæ˜¯ä¸€ä¸ªNSDictionary  
      NSLog(@&quot;%@&quot;, [shareData toObject]);     
    //è·å–shareDataå¯¹è±¡çš„resultå±æ€§ï¼Œè¿™ä¸ªJSValueå¯¹åº”çš„å…¶å®æ˜¯ä¸€ä¸ªjavascriptçš„functionã€‚
    JSValue *resultFunction = [shareData valueForProperty:@&quot;result&quot;];
    //å›è°ƒblockï¼Œå°†jsçš„functionè½¬æ¢ä¸ºOCçš„block
    void (^result)(BOOL) = ^(BOOL isSuccess) {
        [resultFunction callWithArguments:@[@(isSuccess)]];
    };
    //æ¨¡æ‹Ÿå¼‚æ­¥å›è°ƒ
    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(3 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^{
        NSLog(@&quot;å›è°ƒåˆ†äº«æˆåŠŸ&quot;);
        result(YES);
    });
};
</code></pre>
<p>å…¶ä¸­ä¸€äº›å‘ï¼Œå·²ç»åœ¨ä»£ç çš„æ³¨é‡Šå†™çš„æ¯”è¾ƒæ¸…æ¥šäº†ï¼Œè¿™é‡Œè¦æ³¨æ„<code>JavaScript</code>çš„<code>function</code>å’Œ<code>Objective-C</code>çš„<code>block</code>çš„è½¬æ¢ã€‚</p>
<p>ä»ä¸Šé¢çš„ä¸€äº›æ¢è®¨å’Œå°è¯•æ¥çœ‹ï¼Œè¶³ä»¥è¯æ˜<code>JavaScriptCore</code>çš„å¼ºå¤§ï¼Œè¿™é‡Œä¸å†å±•å¼€ï¼Œå°ä¼™ä¼´ä»¬å¯ä»¥è‡ªè¡Œæ¢ç´¢ã€‚</p>
<h2 id="UIWebViewçš„Cookieç®¡ç†"><a href="#UIWebViewçš„Cookieç®¡ç†" class="headerlink" title="UIWebViewçš„Cookieç®¡ç†"></a>UIWebViewçš„Cookieç®¡ç†</h2><h3 id="Cookieç®€ä»‹"><a href="#Cookieç®€ä»‹" class="headerlink" title="Cookieç®€ä»‹"></a>Cookieç®€ä»‹</h3><p>è¯´åˆ°<code>Cookie</code>ï¼Œæˆ–è®¸æœ‰äº›å°ä¼™ä¼´ä¼šæ¯”è¾ƒé™Œç”Ÿï¼Œæœ‰äº›å°ä¼™ä¼´ä¼šæ¯”è¾ƒç†Ÿæ‚‰ã€‚å¦‚æœé¡¹ç›®ä¸­ï¼Œæ‰€æœ‰é¡µé¢éƒ½æ˜¯çº¯åŸç”Ÿæ¥å®ç°çš„è¯ï¼Œä¸€èˆ¬<code>Cookie</code>è¿™ä¸ªä¸œè¥¿æˆ–è®¸æˆ‘ä»¬æ°¸è¿œä¹Ÿä¸ä¼šæ¥è§¦åˆ°ã€‚ä½†æ˜¯ï¼Œè¿™é‡Œè¿˜æ˜¯è¦è¯´ä¸€ä¸‹<code>Cookie</code>ï¼Œå› ä¸ºå®ƒçœŸçš„å¾ˆé‡è¦ï¼Œç”±å®ƒäº§ç”Ÿçš„ä¸€äº›å‘ä¹Ÿå¾ˆå¤šã€‚</p>
<p><code>Cookie</code>åœ¨Webåˆ©ç”¨çš„æœ€å¤šçš„åœ°æ–¹ï¼Œæ˜¯ç”¨æ¥è®°å½•å„ç§çŠ¶æ€ã€‚æ¯”å¦‚ä½ åœ¨<code>Safari</code>ä¸­æ‰“å¼€ç™¾åº¦ï¼Œç„¶åç™»é™†è‡ªå·±çš„è´¦å·ï¼Œä¹‹åæ‰“å¼€æ‰€æœ‰ç™¾åº¦ç›¸å…³çš„é¡µé¢ï¼Œéƒ½ä¼šæ˜¯ç™»é™†çŠ¶æ€ï¼Œè€Œä¸”å½“ä½ å…³äº†ç”µè„‘ï¼Œä¸‹æ¬¡å¼€æœºå†æ¬¡æ‰“å¼€<code>Safari</code>æ‰“å¼€ç™¾åº¦ï¼Œä¼šå‘ç°è¿˜æ˜¯ç™»é™†çŠ¶æ€ï¼Œå…¶å®è¿™ä¸ªå°±åˆ©ç”¨äº†<code>Cookie</code>ã€‚<code>Cookie</code>ä¸­è®°å½•äº†ä½ ç™¾åº¦è´¦å·çš„ä¸€äº›ä¿¡æ¯ã€æœ‰æ•ˆæœŸç­‰ï¼Œä¹Ÿç»´æŒäº†è·¨åŸŸè¯·æ±‚æ—¶ç™»å½•çŠ¶æ€çš„ç»Ÿè®¡æ€§ã€‚<img src="http://ww3.sinaimg.cn/large/006tNc79ly1fff5jbzd4cj31kw0jk11w.jpg" alt="">å¯ä»¥çœ‹åˆ°<code>Cookie</code>çš„åŸŸå„ä¸ç›¸åŒï¼Œæœ‰æ•ˆæœŸä¹Ÿå„ä¸ç›¸åŒï¼Œä¸€èˆ¬<code>.baidu.com</code>è¿™æ ·çš„åŸŸçš„<code>Cookie</code>å°±æ˜¯ä¸ºäº†è·¨åŸŸæ—¶ï¼Œå¯ä»¥ç»´æŒä¸€äº›çŠ¶æ€ã€‚</p>
<p>é‚£ä¹ˆåœ¨Appä¸­ï¼ŒCookieæœ€å¸¸ç”¨çš„å°±æ˜¯ç»´æŒç™»å½•çŠ¶æ€äº†ã€‚ä¸€èˆ¬Nativeç«¯éƒ½æœ‰è‡ªå·±çš„ä¸€å¥—å®Œæ•´ç™»å½•æ³¨å†Œé€»è¾‘ï¼Œä¸€èˆ¬å¤§éƒ¨åˆ†é¡µé¢éƒ½æ˜¯åŸç”Ÿå®ç°çš„ã€‚å½“ç„¶ï¼Œä¹Ÿä¼šæœ‰ä¸€äº›é¡µé¢æ˜¯h5æ¥å®ç°çš„ï¼Œè™½ç„¶h5é¡µé¢åœ¨Appä¸­é€šè¿‡<code>WebView</code>åŠ è½½æˆ–å¤šæˆ–å°‘éƒ½ä¼šæœ‰ç‚¹æ€§èƒ½é—®é¢˜ï¼Œæ„Ÿè§‰ä¸æµç•…æˆ–è€…ä½“éªŒä¸å¥½ï¼Œä½†æ˜¯å®ƒçš„çµæ´»æ€§æ˜¯Native Appæ— æ³•æ¯”æ‹Ÿçš„ã€‚é‚£ä¹ˆç”±æ­¤ï¼Œä¾¿äº§ç”Ÿäº†ä¸€ç§éœ€æ±‚ï¼Œå½“Nativeç«¯ç”¨æˆ·æ˜¯ç™»å½•çŠ¶æ€çš„ï¼Œæ‰“å¼€ä¸€ä¸ªh5é¡µé¢ï¼Œh5ä¹Ÿè¦ç»´æŒç”¨æˆ·çš„ç™»å½•çŠ¶æ€ã€‚</p>
<p>è¿™ä¸ªéœ€æ±‚çœ‹ä¼¼ç®€å•ï¼Œå¦‚ä½•å®ç°å‘¢ï¼Ÿä¸€èˆ¬çš„è§£å†³æ–¹æ¡ˆæ˜¯Nativeä¿å­˜ç™»å½•çŠ¶æ€çš„Cookieï¼Œåœ¨æ‰“å¼€h5é¡µé¢ä¸­ï¼ŒæŠŠCookieæ·»åŠ ä¸Šï¼Œä»¥æ­¤æ¥ç»´æŒç™»å½•çŠ¶æ€ã€‚å…¶å®å‘è¿˜æ˜¯æœ‰å¾ˆå¤šçš„ï¼Œæ¯”å¦‚ç”¨æˆ·ç™»å½•æˆ–è€…é€€å‡ºäº†ï¼Œh5é¡µé¢çš„ç™»å½•çŠ¶æ€ä¹Ÿå˜äº†ï¼Œéœ€è¦åˆ·æ–°ï¼Œä»€ä¹ˆæ—¶å€™åˆ·æ–°ï¼Ÿ<code>WKWebView</code>ä¸­<code>Cookie</code>ä¸¢å¤±é—®é¢˜ï¼Ÿè¿™é‡Œç®€å•è¯´ä¸‹<code>UIWebView</code>çš„<code>Cookie</code>ç®¡ç†ï¼Œåé¢çš„ç« èŠ‚å†ä»‹ç»<code>WKWebView</code>ã€‚</p>
<h3 id="Cookieç®¡ç†"><a href="#Cookieç®¡ç†" class="headerlink" title="Cookieç®¡ç†"></a>Cookieç®¡ç†</h3><p><code>UIWebView</code>çš„<code>Cookie</code>ç®¡ç†å¾ˆç®€å•ï¼Œä¸€èˆ¬ä¸éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨æ“ä½œ<code>Cookie</code>ï¼Œå› ä¸ºæ‰€æœ‰<code>Cookie</code>éƒ½ä¼šè¢«<code>[NSHTTPCookieStorage sharedHTTPCookieStorage]</code>è¿™ä¸ªå•ä¾‹ç®¡ç†ï¼Œè€Œä¸”<code>UIWebView</code>ä¼šè‡ªåŠ¨åŒæ­¥<code>CookieStorage</code>ä¸­çš„Cookieï¼Œæ‰€ä»¥åªè¦æˆ‘ä»¬åœ¨Nativeç«¯ï¼Œæ­£å¸¸ç™»é™†é€€å‡ºï¼Œh5åœ¨é€‚å½“æ—¶å€™åˆ·æ–°ï¼Œå°±å¯ä»¥æ­£ç¡®çš„ç»´æŒç™»å½•çŠ¶æ€ï¼Œä¸éœ€è¦åšå¤šä½™çš„æ“ä½œã€‚</p>
<p>å¯èƒ½æœ‰ä¸€äº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦åœ¨è®¿é—®æŸä¸ªé“¾æ¥æ—¶ï¼Œæ·»åŠ ä¸€ä¸ªå›ºå®š<code>Cookie</code>ç”¨æ¥åšåŒºåˆ†ï¼Œé‚£ä¹ˆå°±å¯ä»¥é€šè¿‡<code>header</code>æ¥å®ç°</p>
<pre><code class="objective-c">NSMutableURLRequest *request = [NSMutableURLRequest requestWithURL:[NSURL URLWithString:@&quot;http://www.baidu.com&quot;]];
[request addValue:@&quot;customCookieName=1314521;&quot; forHTTPHeaderField:@&quot;Set-Cookie&quot;];
[self.webView loadRequest:request];
</code></pre>
<p>ä¹Ÿå¯ä»¥ä¸»åŠ¨æ“ä½œ<code>NSHTTPCookieStorage</code>ï¼Œæ·»åŠ ä¸€ä¸ªè‡ªå®šä¹‰<code>Cookie</code></p>
<pre><code class="objective-c">NSHTTPCookie *cookie = [NSHTTPCookie cookieWithProperties:@{
    NSHTTPCookieName: @&quot;customCookieName&quot;, 
    NSHTTPCookieValue: @&quot;1314521&quot;, 
    NSHTTPCookieDomain: @&quot;.baidu.com&quot;,
    NSHTTPCookiePath: @&quot;/&quot;
}];
[[NSHTTPCookieStorage sharedHTTPCookieStorage] setCookie:cookie];    //Cookieå­˜åœ¨åˆ™è¦†ç›–ï¼Œä¸å­˜åœ¨æ·»åŠ 
</code></pre>
<p>è¿˜æœ‰ä¸€äº›å¸¸ç”¨çš„æ–¹æ³•ï¼Œå¦‚è¯»å–æ‰€æœ‰<code>Cookie</code></p>
<pre><code class="objective-c">NSArray *cookies = [NSHTTPCookieStorage sharedHTTPCookieStorage].cookies;
</code></pre>
<p><code>Cookie</code>è½¬æ¢æˆ<code>HTTPHeaderFields</code>ï¼Œå¹¶æ·»åŠ åˆ°<code>request</code>çš„<code>header</code>ä¸­</p>
<pre><code class="objective-c">//Cookiesæ•°ç»„è½¬æ¢ä¸ºrequestHeaderFields
NSDictionary *requestHeaderFields = [NSHTTPCookie requestHeaderFieldsWithCookies:cookies];
//è®¾ç½®è¯·æ±‚å¤´
request.allHTTPHeaderFields = requestHeaderFields;
</code></pre>
<p>æ•´ä½“æ¥è¯´<code>UIWebView</code>çš„<code>Cookie</code>ç®¡ç†æ¯”è¾ƒç®€å•ï¼Œå°ä¼™ä¼´ä»¬å¯ä»¥è‡ªå·±å†™ä¸ªdemoæµ‹è¯•ä¸€ä¸‹ï¼Œå‘æŒ¥ä½ ä»¬çš„æƒ³è±¡ã€‚</p>
<h1 id="æœªå®Œå¾…ç»­"><a href="#æœªå®Œå¾…ç»­" class="headerlink" title="æœªå®Œå¾…ç»­"></a>æœªå®Œå¾…ç»­</h1><p>å…³äº<code>UIWebView</code>çš„ä»‹ç»ï¼Œä»¥åŠä½¿ç”¨<code>UIWebView</code>è¿›è¡ŒJSä¸OCçš„äº¤äº’ï¼Œ<code>Cookie</code>çš„ç®¡ç†ï¼Œå°±å…ˆç®€å•ä»‹ç»åˆ°è¿™é‡Œã€‚å¦‚æœæœ‰å°ä¼™ä¼´å¯¹äº<a href="https://github.com/marcuswestin/WebViewJavascriptBridge" target="_blank" rel="external">WebViewJavascriptBridge</a>æ¯”è¾ƒæ„Ÿå…´è¶£ï¼Œå¯ä»¥ç•™è¨€ï¼Œæ ¹æ®ç•™è¨€æˆ‘è€ƒè™‘ä¸€ä¸‹å†™ä¸€ç¯‡æ–‡ç« ï¼Œåˆ†æå®ƒçš„è¯¦ç»†å®ç°ã€‚</p>
<p>å¦å¤–ï¼Œåç»­å°†ä¸ºæ‚¨ä»‹ç»<code>WKWebView</code>çš„ç”¨æ³•ï¼Œä¸€äº›OCä¸JSäº¤äº’ï¼ŒCookieç®¡ç†ã€å¦‚ä½•åœ¨<code>Safari</code>ä¸­è°ƒè¯•ä»¥åŠä¸€äº›ä¸ä¸ºäººçŸ¥çš„å‘ç­‰ï¼Œæ•¬è¯·æœŸå¾…~</p>
<p>ä¸‹ç¯‡æ–‡ç« å·²å‘å¸ƒï¼š<a href="http://blog.darkangel7.com/2017/05/10/iOSä¸­UIWebViewä¸WKWebViewã€JavaScriptä¸OCäº¤äº’ã€Cookieç®¡ç†çœ‹æˆ‘å°±å¤Ÿï¼ˆä¸­ï¼‰/">iOSä¸­UIWebViewä¸WKWebViewã€JavaScriptä¸OCäº¤äº’ã€Cookieç®¡ç†çœ‹æˆ‘å°±å¤Ÿï¼ˆä¸­ï¼‰</a>ã€‚</p>
<p>To be continuedâ€¦</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://ww4.sinaimg.cn/large/006tNc79ly1fff1sa06wrj30sg0iwwi9.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; titl
    
    </summary>
    
    
      <category term="iOSæŠ€æœ¯åˆ†äº«" scheme="http://blog.darkangel7.com/tags/iOS%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"/>
    
  </entry>
  
  <entry>
    <title>Hexo+Githubçš„Blogæ­å»º</title>
    <link href="http://blog.darkangel7.com/2016/08/19/Hexo+Github%E7%9A%84Blog%E6%90%AD%E5%BB%BA/"/>
    <id>http://blog.darkangel7.com/2016/08/19/Hexo+Githubçš„Blogæ­å»º/</id>
    <published>2016-08-19T04:40:16.000Z</published>
    <updated>2017-05-08T02:38:09.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å®‰è£…ï¼š"><a href="#å®‰è£…ï¼š" class="headerlink" title="å®‰è£…ï¼š"></a>å®‰è£…ï¼š</h1><h2 id="ä¸€ã€å®‰è£…Homebrew"><a href="#ä¸€ã€å®‰è£…Homebrew" class="headerlink" title="ä¸€ã€å®‰è£…Homebrew"></a>ä¸€ã€å®‰è£…Homebrew</h2><p>Macä¸Šå·²ç»å®‰è£…äº†rubyç¯å¢ƒï¼Œåªéœ€è¦è¾“å…¥</p>
<pre><code>ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot;
</code></pre><h2 id="äºŒã€å®‰è£…node-js"><a href="#äºŒã€å®‰è£…node-js" class="headerlink" title="äºŒã€å®‰è£…node.js"></a>äºŒã€å®‰è£…node.js</h2><pre><code>sudo brew install node
</code></pre><h2 id="ä¸‰ã€å®‰è£…Hexo"><a href="#ä¸‰ã€å®‰è£…Hexo" class="headerlink" title="ä¸‰ã€å®‰è£…Hexo"></a>ä¸‰ã€å®‰è£…Hexo</h2><p>Hexoæ˜¯åŸºäºnode.jsçš„åšå®¢ç³»ç»Ÿï¼Œè¿™é‡Œå®‰è£…å°±å¯ä»¥äº†ã€‚</p>
<pre><code>sudo npm install -g hexo 
npm install hexo-renderer-ejs --save
npm install hexo-renderer-stylus --save
npm install hexo-renderer-marked --save
</code></pre><p>å®‰è£…å®Œæˆåï¼Œæ‰¾ä¸€ä¸ªæ”¾blogçš„ç›®å½•</p>
<pre><code>cd ~/Blog
</code></pre><p>ç„¶åæ‰§è¡Œåˆå§‹åŒ–</p>
<pre><code>hexo init
</code></pre><p>ç„¶åå¯ä»¥ç›´æ¥é¢„è§ˆhello word.md</p>
<pre><code>hexo g
hexo s
=&gt; [info] Hexo is running at localhost:4000/. Press Ctrl+C to stop.
</code></pre><p>gæ˜¯generate, sæ˜¯serverï¼Œè¿˜æœ‰dæ˜¯deployï¼ˆéƒ¨ç½²ï¼‰æ¨èç”¨é¦–å­—æ¯ï¼Œæ–¹ä¾¿å¿«æ·ã€‚</p>
<h2 id="å››ã€åˆ›å»ºBlog-Repository"><a href="#å››ã€åˆ›å»ºBlog-Repository" class="headerlink" title="å››ã€åˆ›å»ºBlog Repository"></a>å››ã€åˆ›å»ºBlog Repository</h2><p>åœ¨è‡ªå·±çš„Githubåˆ›å»ºBlogçš„ä»“åº“ï¼Œå¦‚Blog-Hexoï¼Œå‘½åæ— æ‰€è°“ã€‚è®°ä½å‹¾é€‰READMEã€‚</p>
<p><img src="http://ww4.sinaimg.cn/large/65e4f1e6jw1f72qarsjd9j20va0aydh0.jpg" alt="repository1"></p>
<p><img src="http://ww2.sinaimg.cn/large/65e4f1e6jw1f72qbhppqfj214a0sqq6q.jpg" alt="repository2"><br>åˆ›å»ºå®Œæ¯•ï¼Œç›´æ¥è¿›è¡Œåˆ°ä¸‹ä¸€æ­¥ã€‚</p>
<h2 id="äº”ã€è´­ä¹°åŸŸå"><a href="#äº”ã€è´­ä¹°åŸŸå" class="headerlink" title="äº”ã€è´­ä¹°åŸŸå"></a>äº”ã€è´­ä¹°åŸŸå</h2><p>æ¨èåœ¨ä¸‡ç½‘è´­ä¹°ï¼Œå›½å¤–çš„Godaddyä¹Ÿå¯ä»¥ã€‚ä»¥ä¸‡ç½‘ä¸ºä¾‹ï¼š<br>ä¹°å¥½åŸŸåå®åè®¤è¯äº†ä¹‹åï¼Œåˆ°<code>æ§åˆ¶å°</code> - <code>äº‘è§£æDNS</code>ä¸­æ·»åŠ ä¸€ä¸ªè§£æï¼Œå¦‚ï¼š</p>
<p><img src="http://ww4.sinaimg.cn/large/65e4f1e6jw1f72qblgcswj21kw01qglt.jpg" alt=""></p>
<p>CNAMEæ˜ å°„åˆ°è‡ªå·±çš„xxx.github.ioã€‚è¿™é‡Œçš„xxxæ˜¯ä½ çš„åœ¨githubçš„åç§°ï¼Œæˆ‘çš„æ˜¯<code>DarkAngel7</code>ã€‚<br>åœ¨ç»ˆç«¯ä¸­è¾“å…¥</p>
<pre><code>dig blog.darkangel7.com +nostats +nocomments +nocmd
</code></pre><p>å¦‚æœå‡ºç°ä¸‹é¢çš„ç»“æœï¼Œè¯æ˜è§£ææˆåŠŸã€‚</p>
<pre><code>DarkAngel-MacBook-Pro-2:Blog DarkAngel$ dig blog.darkangel7.com +nostats +nocomments +nocmd

; &lt;&lt;&gt;&gt; DiG 9.8.3-P1 &lt;&lt;&gt;&gt; blog.darkangel7.com +nostats +nocomments +nocmd
;; global options: +cmd
;blog.darkangel7.com.        IN    A
blog.darkangel7.com.    30    IN    CNAME    darkangel7.github.io.
darkangel7.github.io.    2516    IN    CNAME    github.map.fastly.net.
github.map.fastly.net.    30    IN    CNAME    prod.github.map.fastlylb.net.
prod.github.map.fastlylb.net. 30 IN    A    151.101.100.133
</code></pre><h2 id="å…­ã€Deploy"><a href="#å…­ã€Deploy" class="headerlink" title="å…­ã€Deploy"></a>å…­ã€Deploy</h2><p>ä¸Šä¸€æ­¥å®ŒæˆåŸŸååˆ°github pagesçš„å•å‘æ˜ å°„ã€‚æœ¬æ­¥å®Œæˆgithubåˆ°åŸŸåçš„æ˜ å°„ï¼Œå®Œæˆè¾“å…¥åŸŸåè§£æåˆ°å¯¹åº”çš„å†…å®¹ã€‚</p>
<p>é¦–å…ˆåœ¨Blog/sourceé‡Œåˆ›å»ºCNAME</p>
<pre><code>cd source
touch CNAME
vi CNAME
</code></pre><p>è¾“å…¥ä½ åœ¨ä¸Šä¸€æ­¥CNAMEçš„åŸŸåï¼Œå»ºç«‹æ˜ å°„å…³ç³»ã€‚</p>
<pre><code>blog.darkangel7.com
</code></pre><p>ä¿®æ”¹<code>_config.yml</code>æ–‡ä»¶ï¼Œé…ç½®ä¸€äº›ä¸œè¥¿ã€‚</p>
<pre><code># Deployment
## Docs: https://hexo.io/docs/deployment.html
deploy:
      type: git
      repository: git@github.com:DarkAngel7/Blog-Hexo.git
</code></pre><p>å®‰è£…gitæ’ä»¶</p>
<pre><code>npm install hexo-deployer-git --save
</code></pre><p>è¿™é‡Œrepositoryçš„åœ°å€å¯ä»¥æ˜¯httpsçš„ï¼Œä¹Ÿå¯ä»¥æ˜¯gitçš„ï¼Œåªä¸è¿‡gitéœ€è¦SSHè¯ä¹¦ï¼Œä¸€èˆ¬ç”¨httpså°±å¯ä»¥äº†ï¼Œå¦‚æœå‡ºç°443é”™è¯¯ï¼Œæ›¿æ¢æˆgitã€‚</p>
<p>ç„¶ååœ¨Blogç›®å½•ä¸‹</p>
<pre><code>hexo g -d
</code></pre><p>ç”Ÿæˆé™æ€æ–‡ä»¶å¹¶ä¸”éƒ¨ç½²å‡ºå»ï¼Œä¸å‡ºæ„å¤–ï¼Œå·²ç»å¯ä»¥å¤–ç½‘è®¿é—®äº†ã€‚</p>
<h1 id="ä¼˜åŒ–"><a href="#ä¼˜åŒ–" class="headerlink" title="ä¼˜åŒ–"></a>ä¼˜åŒ–</h1><h2 id="ä¸€ã€è®¿é—®é€Ÿåº¦"><a href="#ä¸€ã€è®¿é—®é€Ÿåº¦" class="headerlink" title="ä¸€ã€è®¿é—®é€Ÿåº¦"></a>ä¸€ã€è®¿é—®é€Ÿåº¦</h2><p>ç”±äºGoogleè¢«å¢™ï¼Œå¤§éƒ¨åˆ†ä¸»é¢˜ä¸­å¼•ç”¨çš„jqueryéƒ½ä¼šå› ä¸ºè¶…æ—¶ï¼ˆå¯ä»¥Blogç›®å½•ä¸‹æœç´¢googleï¼‰ï¼Œè€Œé€ æˆé¡µé¢è®¿é—®å¾ˆæ…¢ï¼Œè¿™é‡Œéœ€è¦å°†jqueryæ”¹ä¸ºç™¾åº¦çš„<br>â€‹    </p>
<pre><code>&lt;script src=&quot;//apps.bdimg.com/libs/jquery/2.0.3/jquery.min.js&quot;&gt;&lt;/script&gt;
</code></pre><h2 id="äºŒã€RSSè®¢é˜…"><a href="#äºŒã€RSSè®¢é˜…" class="headerlink" title="äºŒã€RSSè®¢é˜…"></a>äºŒã€RSSè®¢é˜…</h2><p>è¾“å…¥å‘½ä»¤</p>
<pre><code>$ npm install hexo-generator-feed --save
</code></pre><p>ç„¶ååœ¨_config.ymlä¸­ï¼Œæ·»åŠ <br>â€‹    </p>
<pre><code>rss: /atom.xml
feed:
     type: atom
    path: atom.xml
     limit: 20
</code></pre><h2 id="ä¸‰ã€æœç´¢æ”¯æŒ"><a href="#ä¸‰ã€æœç´¢æ”¯æŒ" class="headerlink" title="ä¸‰ã€æœç´¢æ”¯æŒ"></a>ä¸‰ã€æœç´¢æ”¯æŒ</h2><p>ç°åœ¨åœ¨ç™¾åº¦å’ŒGoogleæ˜¯æœä¸åˆ°ä½ çš„ç½‘ç«™çš„ï¼Œä¸ºäº†è®©æœç´¢å¼•æ“æœç´¢åˆ°ï¼Œéœ€è¦åšä¸€äº›å·¥ä½œã€‚</p>
<p>æœç´¢å¼•æ“å…¥å£</p>
<ul>
<li><a href="https://www.google.com/webmasters/tools/home?hl=zh-CN" target="_blank" rel="external">Googleæœç´¢å¼•æ“æäº¤å…¥å£</a></li>
<li><a href="http://www.baidu.com/search/url_submit.htm" target="_blank" rel="external">ç™¾åº¦æœç´¢å¼•æ“å…¥å£</a></li>
</ul>
<p>æ·»åŠ sitemap.xmlï¼š</p>
<p>é¦–å…ˆè¾“å…¥ï¼š</p>
<pre><code>npm install hexo-generator-sitemap --save
npm install hexo-generator-baidu-sitemap --save    
npm install hexo-baidu-url-submit --save
</code></pre><p>å‰ä¸¤ä¸ªæ’ä»¶ç”¨äºç”Ÿæˆsitemapï¼Œåä¸€ä¸ªæ’ä»¶ç”¨äºä¸»åŠ¨æ¨é€é“¾æ¥åˆ°ç™¾åº¦ï¼ˆ<strong>é˜²æ­¢ç™¾åº¦çˆ¬è™«æŠ“å–å¤±è´¥ï¼Œå¯¼è‡´ç™¾åº¦æœä¸åˆ°æ‚¨çš„åšå®¢</strong>ï¼Œè¿™é‡Œæœ‰ä¸€ç¯‡<a href="http://guochenglai.com/2016/09/26/baidu-crow-github-page/" target="_blank" rel="external">å…³äºç™¾åº¦æ— æ³•çˆ¬å–Github Pagesé™æ€ç½‘ç«™è§£å†³æ–¹æ¡ˆ</a>ï¼‰ã€‚</p>
<p>ç„¶ååœ¨<code>_config.yml</code>æ–‡ä»¶ä¸­æ·»åŠ </p>
<pre><code>sitemap:
         path: sitemap.xml
baidusitemap:
         path: baidusitemap.xml

## BaiduUrlSubmit: http://hui-wang.info/2016/10/23/Hexoæ’ä»¶ä¹‹ç™¾åº¦ä¸»åŠ¨æäº¤é“¾æ¥/    
baidu_url_submit:        ##ä¸»åŠ¨æ¨é€æ–°æ–‡ç« åˆ°ç™¾åº¦
  count: 3 ## æ¯”å¦‚3ï¼Œä»£è¡¨æäº¤æœ€æ–°çš„ä¸‰ä¸ªé“¾æ¥
  host: blog.darkangel7.com ## åœ¨ç™¾åº¦ç«™é•¿å¹³å°ä¸­æ³¨å†Œçš„åŸŸå
  token: your_token ## è¯·æ³¨æ„è¿™æ˜¯æ‚¨çš„ç§˜é’¥ï¼Œ è¯·ä¸è¦å‘å¸ƒåœ¨å…¬ä¼—ä»“åº“é‡Œ!
  path: baidu_urls.txt ## æ–‡æœ¬æ–‡æ¡£çš„åœ°å€ï¼Œ æ–°é“¾æ¥ä¼šä¿å­˜åœ¨æ­¤æ–‡æœ¬æ–‡æ¡£é‡Œ

##åŒæ—¶è¦æ£€æŸ¥è¿™é‡Œæœ‰æ²¡æœ‰URLå€¼ï¼Œå¿…é¡»åŒ…å«æ˜¯ç™¾åº¦ç«™é•¿å¹³å°æ³¨å†Œçš„åŸŸåï¼Œæ¯”å¦‚ 
# URL
url: http://blog.darkangel7.com
root: /
permalink: :year/:month/:day/:title/

##æœ€åï¼ŒåŠ å…¥æ–°çš„deployerï¼Œå¦‚
deploy:
- type: git
  repository: git@github.com:DarkAngel7/Blog-Hexo.git
- type: baidu_url_submitter  ## ç™¾åº¦é“¾æ¥ä¸»åŠ¨æ¨é€
</code></pre><p>å…ˆéªŒè¯ç½‘ç«™æ‰€æœ‰æƒï¼Œä¸‹è½½htmlï¼Œmvåˆ°Blog/themes/yourtheme/sourceç›®å½•ä¸‹ï¼Œæ‰§è¡Œ</p>
<pre><code>hexo g -d
</code></pre><p>éªŒè¯æˆåŠŸåï¼Œæ·»åŠ ç™¾åº¦è‡ªåŠ¨æ¨é€è„šæœ¬ï¼Œæœ€å¥½åœ¨<code>head.ejs</code>ä¸­æ·»åŠ ç™¾åº¦è‡ªåŠ¨æ¨é€çš„ä»£ç ï¼Œè‡³äº<code>head.ejs</code>æ–‡ä»¶ä½ç½®ï¼Œåœ¨ä½ ä½¿ç”¨çš„themeæ–‡ä»¶å¤¹ä¸‹æœç´¢å§ã€‚<br>è°·æ­Œçš„è¯ï¼Œåœ¨<code>æŠ“å–</code>-<code>ç«™ç‚¹åœ°å›¾</code>é‡Œé¢æ·»åŠ å°±å¥½ã€‚</p>
<p>è¿™æ ·ä¸»åŠ¨æ¨é€ä¸è‡ªåŠ¨æ¨é€ç»“åˆï¼Œèƒ½å¾ˆå¥½çš„æé«˜æ‚¨æ–‡ç« çš„æ›å…‰ç‡ã€‚    </p>
<h2 id="å››ã€è¯„è®ºåŠŸèƒ½"><a href="#å››ã€è¯„è®ºåŠŸèƒ½" class="headerlink" title="å››ã€è¯„è®ºåŠŸèƒ½"></a>å››ã€è¯„è®ºåŠŸèƒ½</h2><p>å¯ä»¥ä½¿ç”¨<a href="http://duoshuo.com" target="_blank" rel="external">å¤šè¯´</a>æ¥æä¾›è¯„è®ºåŠŸèƒ½ã€‚é¦–å…ˆï¼Œåœ¨<code>_config.yml</code>æ–‡ä»¶ä¸­æ·»åŠ </p>
<pre><code># Duoshuo
duoshuo_shortname: yoursite.doushuo.com
</code></pre><p>  ç„¶åï¼Œæœç´¢themesæ–‡ä»¶å¤¹ä¸‹ï¼Œä½ ä½¿ç”¨çš„themeæ–‡ä»¶ç›®å½•ä¸‹çš„<code>commemt.ejs</code>ï¼ˆä¸åŒçš„themeå¯èƒ½ä½ç½®ä¸åŒï¼Œè¯·è‡ªè¡Œå¯»æ‰¾ï¼‰ã€‚ä¿®æ”¹å¦‚ä¸‹ï¼š</p>
<pre><code> &lt;div id=&quot;comment&quot; class=&quot;comments-area&quot;&gt;
     &lt;% if(config.duoshuo_shortname) { %&gt;
     &lt;! -- å¤šè¯´çš„ä»£ç  --&gt; 
     &lt;% } %&gt; 
&lt;/div&gt;    

 å¦‚æœæŠ¥å…³äºdata-thread-keyçš„é”™è¯¯ï¼Œåˆ™æ”¹æˆä¸‹é¢è¿™æ ·ï¼š
 &lt;div class=&quot;ds-thread&quot; data-thread-key=&quot;&lt;%= page.path %&gt;&quot; data-title=&quot;&lt;%= page.title %&gt;&quot; data-url=&quot;&lt;%= page.permalink %&gt;&quot;&gt;&lt;/div    &gt;
</code></pre><h2 id="äº”ã€åˆ†äº«åŠŸèƒ½"><a href="#äº”ã€åˆ†äº«åŠŸèƒ½" class="headerlink" title="äº”ã€åˆ†äº«åŠŸèƒ½"></a>äº”ã€åˆ†äº«åŠŸèƒ½</h2><p>å¯ä»¥åœ¨Blogç›®å½•ä¸‹æœç´¢<code>post/share</code>ï¼Œä¸€èˆ¬åœ¨<code>article.ejs</code>æ–‡ä»¶ä¸­ï¼Œæˆ–è€…<code>post.ejs</code>æ–‡ä»¶ä¸­ï¼Œç„¶åæ›¿æ¢</p>
<pre><code>&lt;%- partial(&#39;post/author&#39;) %&gt;
</code></pre><p>ä¸º<a href="http://share.baidu.com/code" target="_blank" rel="external">ç™¾åº¦åˆ†äº«</a>æä¾›çš„ä»£ç ã€‚</p>
<h2 id="å…­ã€ä¸ªäººä¿¡æ¯å®Œå–„"><a href="#å…­ã€ä¸ªäººä¿¡æ¯å®Œå–„" class="headerlink" title="å…­ã€ä¸ªäººä¿¡æ¯å®Œå–„"></a>å…­ã€ä¸ªäººä¿¡æ¯å®Œå–„</h2><p>ç½‘ç«™çš„ä¿¡æ¯ä¸€èˆ¬éƒ½åœ¨<code>Blog/_config.yml</code>ä¸­ä¿®æ”¹ã€‚</p>
<p>å…³äºThemeï¼Œå»å®˜æ–¹æä¾›çš„<a href="https://github.com/tommy351/hexo/wiki/Themes" target="_blank" rel="external">ä¸»é¢˜åˆ—è¡¨</a>ä¸­é€‰ä¸ªç°æˆçš„ï¼ŒæŒ‰ç…§é‡Œé¢çš„æ–¹æ³•pullä¸‹æ¥ï¼Œå¦‚lightä¸»é¢˜</p>
<pre><code>$ git clone git://github.com/tommy351/hexo-theme-light.git themes/light
</code></pre><p>ç„¶ååœ¨<code>_config.yml</code>é…ç½®æ–‡ä»¶ä¸­è®¾ç½®ï¼š</p>
<pre><code>theme: light
</code></pre><p>å…³äºä¸»é¢˜çš„ä¼˜åŒ–ï¼Œä¸€èˆ¬åœ¨<code>themes/yourtheme/_config.yml</code>ä¸­é…ç½®ã€‚</p>
<h1 id="å†™æ–‡ç« "><a href="#å†™æ–‡ç« " class="headerlink" title="å†™æ–‡ç« "></a>å†™æ–‡ç« </h1><p>åœ¨Blogç›®å½•ä¸‹ï¼Œåˆ›å»º</p>
<pre><code>hexo new æ–‡ç« é¢˜ç›®
</code></pre><p>ç„¶åç”¨Markdownç¼–å†™ï¼Œå†™å¥½åsaveã€‚</p>
<pre><code>hexo g
hexo s
</code></pre><p>ç”Ÿæˆï¼Œç„¶ååœ¨æœ¬åœ°localhost:4000é¢„è§ˆä¸€ä¸‹ï¼Œå¦‚æœæ²¡æœ‰é—®é¢˜ï¼Œå°±å¯ä»¥å‘å¸ƒäº†ã€‚</p>
<pre><code>hexo d
</code></pre><p>æ‰€æœ‰çš„æ–‡ç« éƒ½æ˜¯æ”¾åœ¨<code>Blog/source/_posts/</code>ç›®å½•ä¸‹çš„ï¼Œå¯ä»¥éšæ—¶ç¼–è¾‘ä¿®æ”¹ã€‚</p>
<h1 id="å†™åœ¨æœ€å"><a href="#å†™åœ¨æœ€å" class="headerlink" title="å†™åœ¨æœ€å"></a>å†™åœ¨æœ€å</h1><p>è¿˜æœ‰ä¸€äº›å…¶ä»–çš„ä¿®æ”¹ï¼Œè¿™é‡Œå°±ä¸ä¸€ä¸€æäº†ï¼Œç­‰å¾…ä½ æ…¢æ…¢å‘ç°ã€‚ç°åœ¨å¿«å¼€å§‹å†™ä½œå§~~</p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;å®‰è£…ï¼š&quot;&gt;&lt;a href=&quot;#å®‰è£…ï¼š&quot; class=&quot;headerlink&quot; title=&quot;å®‰è£…ï¼š&quot;&gt;&lt;/a&gt;å®‰è£…ï¼š&lt;/h1&gt;&lt;h2 id=&quot;ä¸€ã€å®‰è£…Homebrew&quot;&gt;&lt;a href=&quot;#ä¸€ã€å®‰è£…Homebrew&quot; class=&quot;headerlink&quot; titl
    
    </summary>
    
    
  </entry>
  
</feed>
